Krÿÿk: Serious Vulnerability Affected Encryption of Billion+ Wi-Fi Devices
Robert Lipovsky | Stefan Svorencik

IoT research

Consumer IoT Devices Are Expanding The Enterprise Attack Surface
Forrester: Managing the Security Risks Posed by Your Employees' IoT Devices, by Chris Sherman, February, 2020

Most Consumer IoT Devices Can Be Exploited
Forrester: Managing the Security Risks Posed by Your Employees' IoT Devices, by Chris Sherman, February, 2020

Robert Lipovsky
Senior Malware Researcher

Stefan Svorencik
Head of Experimental Research & Detection

Milos Cerm·k
Malware Researcher Experimental Research & Detection

Martin KaluznÌk
Malware Researcher Experimental Research & Detection

Agenda
1 Quick intro to WPA2 2 The Kr00k vulnerability 3 Impact 4 What does this have to do with KRACK
and Amazon devices? 5 Latest research / related vulnerabilities 6 Conclusion

Wi-Fi Security Primer

Association stage

Authentication request Authentication response (Re)Association request (Re)Association response
...

Association stage

4-way handshake

Construct PTK

Authentication request Authentication response (Re)Association request (Re)Association response
Message 1
Message 2
Message 3 Message 4
...

Construct PTK

Temporal (Session)
Key

Encryption in WPA2-CCMP
Nonce AES

Plaintext Data

Keystream
=
Header
Encrypted Data

Krÿÿk
CVE-2019-15126

WPA2

WPA2

WPA2

Rewind

Source: https://www.cypress.com/file/298796/download

Source: https://www.cypress.com/file/298796/download

Disassociation

Temporal (Session)
Key

Decryption in WPA2-CCMP
AES

Plaintext Data
=
Keystream


Header

Nonce Encrypted Data

Impact
What can an attacker do with this vulnerability?

Eavesdropping ≠ Passive
WPA2

Eavesdropping ≠ Passive
WPA2

Eavesdropping ≠ Active
WPA2

DEMO

Vulnerable Access Point vs. Secure Devices

What devices are affected?

ß Devices with Broadcom and Cypress FullMAC Wi-Fi chips
ß We positively tested:
ß Apple iPhones ß Apple MacBooks ß Samsung Galaxy phones ß Google Nexus phones ß Raspberry Pi 3

ß Amazon Echo 2 ß Amazon Kindle 8
ß ASUS Wi-Fi routers ß Huawei Wi-Fi routers

What was done about this?
ß ESET responsibly disclosed to Broadcom and Cypress
ß Granted 16200 day grace period
ß Broadcom and Cypress pushed patches to individual device manufacturers
ß ESET worked with ICASI to ensure all possibly affected parties were aware of the bug

KRACKing Amazon Echo
How it all started...

AMAZON ECHO 1ST GEN
Vulnerable to KRACK attack

AMAZON ECHO 2ND GEN
Vulnerable to... Kr00k

KRACK vs. KR00K

KRACK
Attack / exploit Nonce reused to acquire keystream Triggered during the 4-way handshake Affects most Wi-Fi capable devices

KR00K
Vulnerability / bug Data encrypted with all-zero session key Triggered after a disassociation Affects the most widespread Wi-Fi chips (Broadcom & Cypress)

Follow-up research

Qualcomm WLAN chips
ß CVE-2020-3702 ß Affected chip: QCA9531
ß Mitigation: ß Proprietary driver patched July 2020 ß Open source drivers?!

Mediatek WLAN chips
ß Affected tested devices: ß ASUS RT-AC52U router ß Azure Sphere MT3620 (OS ver.20.05)
ß Mitigation: ß SW patches issued March - April 2020 ß Azure Sphere ≠ patch in latest/upcoming OS update

Wrapping up...

Kudos to

What should you do?
ß Update all your devices with Broadcom & Cypress chips
Even APs / Wi-Fi routers! Not just Personal ≠ but Enterprise too!
ß As a manufacturer of Wi-Fi capable devices:
ß Contact the Wi-Fi Alliance and check with your Wi-Fi chip manufacturer that your devices have been patched

www.ESET.com/int/Kr00k

Thanks for watching!
@ESETResearch | WeLiveSecurity.com

