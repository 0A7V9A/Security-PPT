SESSION ID: BR-W03

Watt, Me Worry? Analyzing AC Power to Find Malware

Ben Ransford, Ph.D.
Chief Technical Officer Virta Laboratories, Inc. @virtalabs

VirtaLabs
Denis Foo Kune, Ph.D.
Chief Executive Officer Virta Laboratories, Inc. @virtalabs

#RSAC

#RSAC
Your Speakers
u Ben Ransford, Ph.D., CTO Virta Labs u Medical device attacks & "zero-power" defenses u Power analysis attacks and defenses
u Denis Foo Kune, Ph.D., CEO Virta Labs u EMI injection attacks on medical devices u Privacy attacks on GSM phones
u Co-founded Virta Labs in 2013 to find malware via the power line
VirtaLabs
2

#RSAC
#question
u How can we monitor machines that we can't modify at all?
VirtaLabs
3
Image: nihonkohden.com, madmonkeyhostels.com

#RSAC
Legacy Systems Challenges
u Systems stay in service long past operating system EoL u Often performing critical roles u Hard or impossible or forbidden to upgrade/patch u Clear high-ROI entry point for attackers!
VirtaLabs
4

#RSAC
Legacy Systems Challenges
u Systems stay in service long past operating system EoL u Often performing critical roles u Hard or impossible or forbidden to upgrade/patch u Clear high-ROI entry point for attackers!
u Are we doomed to repeat the same problems with IoT?
VirtaLabs
4

#RSAC
Legacy Systems Challenges
u Systems stay in service long past operating system EoL u Often performing critical roles u Hard or impossible or forbidden to upgrade/patch u Clear high-ROI entry point for attackers!
u Are we doomed to repeat the same problems with IoT?
VirtaLabs
4

#RSAC
Today: Analyzing AC Power to Find Malware
u Side channels 101 u AC power side channels
u Demo! u Using side channels to attack privacy u Demo!
VirtaLabs
5

#RSAC
What are Side Channels?
u Information flows in channels by design
u e.g., video signals u e.g., encrypted Wi-Fi frames
u Side channels are accidental channels of information flow
u Example: timing differences that reveal plaintext
VirtaLabs
6

#RSAC
Side Channels in Context
u Adversary can observer side channels to compromise security
u Generally a passive adversary, e.g., eavesdropper
u Long history of side-channel attacks. Examples:
u WWI: signals intelligence on buried TX lines u Differential power analysis (Kocher et al., CRYPTO '99) u Tromer lab's work with acoustic (Tel Aviv)
VirtaLabs
7

#RSAC
Timing Side Channels in SSH
u SSHv1 sent a packet every time you pressed a key...
u Eavesdropper can infer typed text from inter-keystroke timings! u "Timing Analysis of Keystrokes and SSH Timing Attacks," USENIX
Security 2001
VirtaLabs
8

#RSAC
Optical Eavesdropping
u Raster scan of a CRT's electron beam = time-varying light intensity

OH HELLO THERE

OH HELLO THERE

(artist's rendition)

u "Optical Time-Domain Eavesdropping Risks of CRT Displays," IEEE S&P 2002

VirtaLabs
9

#RSAC
TEMPEST
u NSA program since `60s (?) u Super-sensitive RX gear u Electromagnetic emanations
betray plaintext! u Remediations: shielding,
spacing, separation
u $$$$$
VirtaLabs
10
Image: atomictoasters.net

#RSAC
TEMPEST Shielding
VirtaLabs
11
Image: ramayes.com

#RSAC
TEMPEST Shielding
u E.g.: KG-13 crypto machine (1960s) u AC power filter to prevent secrets
leaking onto power lines!
VirtaLabs
12
Image: jproc.ca

#RSAC
AC Power Side Channels
u Main idea: power consumption contains information
u Which computer is this? u What is the computer doing?
u What makes AC power analysis possible? u What makes AC power analysis challenging? u What makes AC power analysis work in practice?
VirtaLabs
13

#RSAC
Side Channel Analyst's Toolbox
u Physical side channels: scope, scope, scope, store!
Oscilloscope
Data Acquisition Unit (DAQ)
u Sensors that output voltage proportional to signal
 u Sense resistor: voltage current through the sensor
u Measure voltage across the sense resistor to measure current (V=IR)
VirtaLabs
14
Image: BK Precision

#RSAC
Side Channel Measurement Points
VirtaLabs
15
Image: refurbished-pc.com; sterenshopusa.com

#RSAC
Side Channel Measurement Points
VirtaLabs
15
Image: refurbished-pc.com; sterenshopusa.com

#RSAC
AC Power Analysis: Enabling Factors
u Probe points are easily accessible (hot, neutral, ground)
u No need to open the box! u No need to hunt for signal wires!
u Changes in DC current consumption readily visible to probes
u What do we see on the wire?
VirtaLabs
16

#RSAC
Signals on the Wire
VirtaLabs
17

#RSAC
Signals on the Wire
VirtaLabs
18

#RSAC
Current Consumption Varies
u Today's CPUs and software are careful to use power management!
u Modern systems exhibit high dynamic range
u Workloads  patterns of high/low
u CPU busy  more current u Peripherals busy  more current u Idle time  less current
VirtaLabs
19
Image: Apple

#RSAC
AC Power Analysis: Challenges
u Signals to analyze are noisy; where's the information? u Power supply aggregates signals
u CPU's power consumption + u Hard drive's power consumption + u Memory's power consumption + ...
u Difficult to disentangle signals
u Our approach: machine learning
What's all this?
VirtaLabs
20

#RSAC
AC Power Analysis Example: Private Browsing
u Threat model: you can access my AC outlet
u ~15 seconds to swap a faceplate...
u Q: Which webpage am I visiting? u Analyze power during webpage loading
u Train a classifier to recognize webpages' power-line signatures u Test new signals against the trained classifier
VirtaLabs
21

#RSAC
Task: Webpage Identification
u Intuition: pages exercise computing resources differently
vs.
VirtaLabs
22

#RSAC
Demo: Page Loads on the Wire

#RSAC
Page Loads on the Wire

0.2

0.1

-0.2 -0.1 0.0

Current (Amps)

VirtaLabs

0.5

1.0

1.5

2.0

2.5

Time (s)

24

#RSAC
Training a Binary Classifier

u Supervised learning: assemble and label a training set

u Labels for the X-classifier: {X, not-X}

Google

Power trace of Google (30 sec)
Yahoo!
VirtaLabs

Chunk
(10s)
Chunk
(10s)
Chunk
(10s)
Chunk Chunk
25

Features
Features
Features
Features Features

Google Google
Not-Google Not-Google

#RSAC
Instrumenting an Outlet
Measurement points
Sense resistor (behind outlet)

VirtaLabs

Storage & analysis
26

#RSAC
Building a Training Set
u Instrumented outlet u Scripted page loads + power traces u 9,240 traces (~72 hours of traces)
VirtaLabs
27

#RSAC
Webpage Classification Results
u > 99% accuracy, 99% precision, 99% recall
u > 98% accuracy excluding samples of 441 unknown webpages
u More details: Current Events: Identifying Webpages by Tapping the Electrical Outlet, ESORICS '13
VirtaLabs
28

#RSAC
Robustness of Classification To Changes In...

Virtual private network encryption Browser cache Network interface
Background activities Passage of time

Content distribution network

Physical location

Operating system Hardware

Tor

Browser

VirtaLabs
29

Classifier still works Classifier sort of works Classifier doesn't work

#RSAC
AC Power Analysis for Other Domains
u Webpage identification is an attack
u Spy on people by watching web traffic
u Defensive applications!
u Turning traditional side channel analysis on its head u Spy on malware instead
VirtaLabs
30

AC Power Analysis to Find Malware
u Motivation: Legacy devices without AV or patching u Root causes:
u COTS OS means short development cycle, but... u Many manufacturers lack upgrade path! u Zombie pseudo-embedded machines!
u Often can't get inside the box
u ... or install software

#RSAC
Braiiins!

VirtaLabs
31

#RSAC
Medical Device Example

u "information systems department together with the pharmacy has requested that [X] provide a microsoft security patch to prevent this infection from occurring again. [X] is unwilling to allow these patches to be applied to the [X] [compounder]. Instead [X] has recommend that we place a router with the functionality for a firewall between the compounder and the network (b) (4) as protection." --FDA MAUDE report #1621627

VirtaLabs

Figure 1: Running on Windows XP Embedded SP2, our
Baxa ExactaMix 2400 pharmaceutical compounder is an 32automated embedded system that mixes liquids to indi-

#RSAC
Medical Device Example

u "information systems department together with the pharmacy has requested that [X] provide a microsoft security patch to prevent this infection from occurring again. [X] is unwilling to allow these patches to be applied to the [X] [compounder]. Instead [X] has recommend that we place a router with the functionality for a firewall between the compounder and the network (b) (4) as protection." --FDA MAUDE report #1621627

VirtaLabs

Figure 1: Running on Windows XP Embedded SP2, our
Baxa ExactaMix 2400 pharmaceutical compounder is an 32automated embedded system that mixes liquids to indi-

#RSAC
Medical Device Example

u "information systems department together with the pharmacy has requested that [X] provide a microsoft security patch to prevent this infection from occurring again. [X] is unwilling to allow these patches to be applied to the [X] [compounder]. Instead [X] has recommend that we place a router with the functionality for a firewall between the compounder and the network (b) (4) as protection." --FDA MAUDE report #1621627

VirtaLabs

Figure 1: Running on Windows XP Embedded SP2, our
Baxa ExactaMix 2400 pharmaceutical compounder is an 32automated embedded system that mixes liquids to indi-

#RSAC
Other High-Assurance Examples
u Medical: infusion pumps, bedside monitors, fetal monitors... u Industrial: SCADA systems u Point-of-sale terminals
u RAM scrapers steal payment card data!
u ATMs
u Common element: lagging software, difficult change management!
VirtaLabs
33
Image: APRO, Mongolia Tourism

#RSAC
IT Administrators' Crucial Dilemma
u Cannot patch or install AV u Device serves a critical role u Take device offline or leave it unprotected?

u Partial solution #1: NIDS for network traffic Figure 1: Running on Windows XP Embedded SP2, our

u Won't find malware that doesn't use network

Baxa ExactaMix 2400 pharmaceutical compounder is an automated embedded system that mixes liquids to indi-

vidual specifications for intravenous parenteral nutrition.

u Partial solution #2: Power analysis to find malware

Device

Configuration

Baxa ExactaMix WinXP Embedded, Via 2400 compounder 664 MHz , 512 MB RAM

Schweitzer SEL3354 WinXP Embedded, Athlon substation computer 2600+, 2 GB RAM

VirtaLabs

Table 1: Devices against which we tested WattsUpDoc. 34

#RSAC
Power Analysis to Find Malware

u Like webpages, many software operations induce distinct powerconsumption patterns
u Learn normal activity for a given machine
u Learn patterns of malware execution
u Spy on execution to look for unusual or alarming patterns suggesting malware

u Good visibility into patterns of operations u Limited visibility into individual operations

Measurement points
Sense resistor (behind outlet)

VirtaLabs
35

#RSAC
Power Analysis Workflow: Anomaly Detection

Training traces (representative
executions)

a.exe

c.exe

b.exe

5 sec

5 sec

Ongoing monitoring

5 sec

5 sec

5 sec

OK!

OK!

Classifier

OK!

??? ???

VirtaLabs
36

#RSAC
Power Analysis Workflow: Malware Detection

Malware training library

bad.exe

awful.exe

worse.exe

5 sec

5 sec

Ongoing monitoring

5 sec

5 sec

5 sec

Classifier

OK! OK! OK! ?b?a?d.exe ?b?a?d.exe

VirtaLabs
37

#RSAC
u On a pharmaceutical compounder:
u 88.5% accuracy; 93.5% precision; 92.1% recall
u On a SCADA substation computer (XP):
u 84.9% accuracy; 98.3% precision; 80.8% recall
u Simple technique already compares well to state-of-the-art malware detection (behavioral & signature-based)
u More: WattsUpDoc: Power Side Channels to Nonintrusively Discover Untargeted Malware on Embedded Medical Devices, HealthTech `13
VirtaLabs
38

Demo:

#RSAC

Detecting Malware on the Wire

#RSAC
Example: RAM Scrapers
u This is what a clean system looks like u Normal software activity shown on left side
VirtaLabs
40

#RSAC
Example: RAM Scrapers
u This is the same system infected with BackOff v1.56 u Check out these horizontal lines
VirtaLabs
41

#RSAC
Example: RAM Scrapers
u This is the same system with 0-day variant of BackOff u The features are recognizable!
VirtaLabs
42

#RSAC
GoPro Motocross vs Bill Gates

GoPro Motocross

Bill Gates TED talk

VirtaLabs
43

#RSAC
MIM vs BackOff

VirtaLabs

MIM Viewer

BackOff Malware

44

#RSAC
Autodesk vs BackOff
Active User Interaction

VirtaLabs

BackOff Malware Autodesk 123D Design
45

#RSAC
BackOff on top of Autodesk
BackOff infection Autodesk
VirtaLabs
46

#RSAC
Conclusion
u We need to think outside the box for endpoint security
u Legacy devices: no good solutions for visibility/monitoring u Side channels can tell us information u Sometimes that information is useful u Sometimes it's just argyle
VirtaLabs
47

#RSAC
Apply: Find Unpatchable Systems
u High-assurance systems that don't go out of service
u Systems that have undergone extensive regulatory testing
u Systems that are simply old
u If you work in a medical environment: get MDS2 forms and keep bothering manufacturers!
VirtaLabs
48
Image: Crashspotting

{ben, denis}@virtalabs.com

#RSAC

https://www.virtalabs.com/

