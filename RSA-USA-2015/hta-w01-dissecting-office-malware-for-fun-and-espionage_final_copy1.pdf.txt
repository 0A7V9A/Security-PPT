SESSION ID: HTA-W01
Dissecting Office Malware for Fun and Espionage

Jonathan Grier
Principal Grier Forensics jdgrier@ grierforensics.com
nospam

#RSAC

#RSAC
2

#RSAC
3

#RSAC
4

#RSAC
5

#RSAC
6

#RSAC
Why Office?
7

#RSAC
· Ubiquitous
8

#RSAC
9

#RSAC
· Ubiquitous · Platform (almost an OS)
10

#RSAC
11

#RSAC
· Ubiquitous · Platform (almost an OS) · VM (to an APT)
12

#RSAC
· Ubiquitous · Platform (almost an OS) · VM (to an APT) · Universal container
13

Deep Dive:

#RSAC

Office Internals

#RSAC
· DOC · DOCX
15

#RSAC
16

#RSAC
17

#RSAC
18

#RSAC
19

#RSAC
Office Internals in Two Lines
· Content-Types · Relationships
20

Parts (Examples)

#RSAC

Part Name
ppt/slides/slide4.xml
ppt/media/image9.png

Content-Type
application/vnd.ope nxmlformatsofficedocument.pres entationml.slide+xml
image/png

Part Data ("Stream")
<?xml version="1.0" encoding="UTF-8" standalone="yes"?> <p:sld xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relati onships" xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main" ><p:cSld><p:spTree><p:nvGrpSpPr>...

[Content_Types].xml application/xml

<?xml version="1.0" encoding="UTF-8" standalone="yes"?> <Types xmlns="http://schemas.openxmlformats.org/package/2006/cont ent-types"><Default Extension="png" ContentType="image/png"/><Default Extension="emf" Con2t1entType="image/x-emf"/>...

#RSAC
22

Relationships (Examples)

#RSAC

ppt/presentation.xml
Type: slide
ppt/slides/slide4.xml

ppt/media/image16.png
Type: image
ppt/media/image15.png
Type: image

Type: slideLayout
ppt/slideLayours/slideLayout2.xml

23

#RSAC
24

#RSAC
25

#RSAC
1. Wrapper 2. Obfuscator 3. Vector in its own
26

Live

#RSAC

Dissection

#RSAC
28

#RSAC
29

#RSAC
30

#RSAC
31

#RSAC
32

#RSAC
33

#RSAC
34

#RSAC
VM (to an APT)
35

#RSAC
Platform (almost an OS)
36

#RSAC
For more information
 www.OfficeDissector.com ­ Open Source tool to dissect Office documents
 http://www.officedissector.com/doc/rst/ANALYZING_OOXM L.html is a walk-thru including an example tutorial using OfficeDissector
 Feel free to contact me with questions (please be patient if I can't respond immediately)
 And, if you have a lot of time on your hands, http://standards.iso.org/ittf/PubliclyAvailableStandards/index.html has the ISO/IEC 29500 Office spec (all 6500+ pages)
37

#RSAC
Questions? Feedback?
Please share them with me here Or jdgrier@grierforensics.com
nospam
38

#RSAC
Apply Slide
 Next week you should:  Install OfficeDissector (Open Source at www.officedissector.com)  Work through the tutorial of Office analysis
 Within one month you should:  Take a benevolent office document from your organization and dissect it. It will be a great way to concretize what you've learned about Office internals.
 Within three months you should:  Find a suspicious Office document (perhaps emailed to someone in your organization) and dissect it  Catalog the threat vectors that Office docs constitute for your organization
39

