Building instantly exploitable protection for yourself and your partners against targeted cyber
threats using MISP
by Andras Iklody

What is MISP?
MISP is:
a repository of malware, IOCs and cyber threat related technical information a sharing platform that enables partners to instantly share the above mentioned data A collaboration system, that converts your and your partners' information into protection for its entire user community that helps you identify links between your incidents and the collective threat intelligence of all your interconnected partners

History of MISP
Originally developed by Christophe Vandeplas in his free time Adopted by the Belgian Defense and later on by NATO NATO started investing into the development of MISP since summer 2012 Since then it has gone open source CIRCL started developing tools and APIs around MISP with a rapidly growing user community, improvements and new features are being added by various 3rd parties, such as FIRST

So what issues does MISP try to tackle?

The situation without MISP
There has always been some level of information sharing But most of the time it happened ad hoc: ­Phone call ­e-mail with a CSV with malicious IP addresses ­Or for people we don't like: PDFs with indicators in the text

The situation without MISP
Data doesn't reach target audience recipients end up with something they can't really use or even worse, something that they already have ­ meaning they could have maybe prevented an incident, had they shared the information a lot of duplication of effort Information sharing in this old fashioned way happens at the expense of interrupting your analyst's workflow You end up with a lot of information that you cannot really exploit which, again, leads to attacks being successful that could have been prevented

How does MISP work?
Various ways to interact with the data in MISP: ­Web interface ­API ­Indirectly through systems ingesting MISP's exports / producing data for MISP will provide the same benefits either way

Inter-connectivity
supporting a wide range of connectivity options

The data structure at a glance
Simplistic data structure that can easily be converted to other formats Designed not to overwhelm users The main design concept: Capture what is actually important Community driven evolution

The data structure at a glance
Each package of information is called an "Event" Events are made up of "Attributes" Attributes can describe several things (IOCs, Context, CVEs external resources, malware samples) ­Attributes have a category and a type ­They can be marked to be included in the IDS exports ­They can have contextual comments

Sharing and collaboration
Share your data with other users of the same instance Share your data with users of interconnected instances ­Distribution settings ­Sharing groups in upcoming version MISP topology example (CIRCL)

Sharing and collaboration
Collaborate using Proposals ­Create a proposal to an event that you do not own ­The creating organization will get notified ­They can accept / discard your proposal

Sharing and collaboration
Discuss ongoing events using the forums ­Add comments to events (keeping the releasability) ­Create threads not related to specific events

Sharing and collaboration
Receive alerts of other users publishing events ­Encrypted e-mails each time an event is published ­Or when event is pushed to your instance / pulled by your instance ­The e-mail alerts are an opt-in feature

Sharing and collaboration
Contact reporter of an event ­Choose to only contact the person that has created the event or his entire organisation ­All e-mailing can be enforced to be encrypted

Feeding MISP with data
Overview Manual input ­Enter data via the interface ­Use the free-text import tool ­Use a template Feed MISP via the APIs / upload tools ­Import from sandbox (GFI) ­Use the REST API ­Upload MISP XML / OpenIOC / Threatconnect export

Entering data via the interface
Simple interface to create attributes

Using the freetext import
Simply paste text from any document and let MISP find the indicators for you.

Using templates
Create templates to make life easier for your users Less experienced users will get a simple form to fill out that caters to your expectations

Using the REST API
MISP has a REST interface that allows you to interact with events and attributes Build scripts that modify data to MISP in a simple XML/JSON format using the REST API MISP will take care of the rest (access control, synchronisation, notifications, correlation, etc)

Importing data into MISP

Exploiting the data in MISP and supporting the analysis
Overview Finding data in MISP Correlation and pivoting Giving data context by tagging Visualisation and building tools that leverage MISP data

Finding data in MISP
Various tools for finding data in MISP

Correlation and pivoting
Detecting similarities between events can be crucial ­Helps analysts find similarities between attacks ­Discover an ongoing campaign ­Same threat actors behind a series of attacks ­See trends in ongoing attacks Correlation happens each time you enter data into MISP

Correlating data example
Let's assume the following situation: ­You are user of a MISP populated with data by yourself and your partners ­You receive an e-mail that has an executable as attachment ­The attachment has a name that is obviously meant to fool someone in your organization ­You run it through your sandbox and put the resulting indicators into MISP

Correlating data example
We create an event and add our indicators as attributes: ­The attachment itself (something-relatable.jpg.exe) ­An executable downloaded and run by the attachment (malicious.exe) ­Network activity to facebookhello.h1x.com MISP will automatically get the MD5/Sha1/Sha256 hashes of any uploaded sample So we end up with a total of 7 attributes

Correlating data example

Correlating data example

Correlating data example
So we found 2 correlated events, both of which are OSINT reports about Operation Ke3chang
While pivoting through the relations, MISP built a chart showing the relations as we traversed them:

Tagging data
Tagging allows us to group events together based on arbitrary commonalities ­Source (Privint, OSINT, etc) ­TLP ­Campaigns or Threat actors ­Type of event (for example malicious attachment) Local to the instance Search-able, usable as a filter in the API Upcoming version: tags can be filters on the synchronization (similar to subscribing to feeds / restricting outgoing data based on tags)

Tagging example
So in this case, we found an event that should be tagged Ke3chang too Using Ke3chang as a filter option we get the following result now:

Visualisation of the data
Pivoting graph as shown before Using Maltego (tool developed by Andrzej Dereszowski) Using MISP-Graph (tool developed by Alexandre Dulaunoy from CIRCL) Upcoming graphing tool in the MISP UI

Building automated protection Feed your defenses
Overview Various export formats of MISP Feed a wide range of systems using MISP A flexible API Build and use tools that use the MISP APIs

Exporting data from MISP

Feed a wide range of systems using MISP
NIDS (Suricata, Snort, STIX/CyBox) HIDS (OpenIOC, STIX/CyBox, CSV) SIEMs DNS level firewalls (DNS Responce Policy Zones) Forensic scanners Throw values obtained from CSV exports against your packet capture ...

A flexible API
Use the APIs to continuously retrieve the data that you are actually interested in Flexible filter parameters Build complex queries ­Return all hostnames and domain names from events tagged Ke3chang that got published within the past 14 days ­Return a snort rule set for all events not tagged OSINT from the past 24 hours

A flexible API

Build and use tools that use the MISP API
Tools ingesting the exports of MISP Built by the community and shared on the MISP github repository A modular import/export feature is planned that will make development for MISP easier We always welcome more additions!

Why adopt MISP?
Allows you to create, ingest and share IOCs and threat intelligence without a hassle Building defenses out of the efforts of your partners has never been this easy MISP is constantly evolving It is widely adopted and chances are your partners are already exchanging information using MISP It is completely open-source and you can join the evergrowing community of organizations that share their improvements It is commercially supported Is free and developed by a non-profit

Questions and practical information
To get in touch with me: andras.iklody@gmail.com Contact the MISP Project: info@misp-project.org Website: http://www.misp-project.org Users list: https://groups.google.com/forum/#!forum/misp-users Developers list: https://groups.google.com/forum/#!forum/misp-devel Github: http://github.com/MISP/MISP Information and access request for the CIRCL MISP communities: https://www.circl.lu/services/misp-malware-information-sharing-platform
Do you want to support the non-profit MISP project? Contact us for partnership !

