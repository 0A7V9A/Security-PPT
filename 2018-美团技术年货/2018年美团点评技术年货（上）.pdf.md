
   200 2800   2200  3600  2017  10 300     7000  WebiOS  Android     ---- ...... 

iv>2017 
" " 2013  12  200 
 2014  9 "" 8  
" " 2015  33   15   1 
  
 ""
  58  759 
   AI 8  

<v
 bug 
 
    
 2018 





1



1



6



18

 doT.js 

33

WebView 

45

 SDK 

64



76



88

Shield

96



103

iPhone X 

118

 KIF  iOS UI 

132

Android 

145

 Android  Walle

157



165

Android 

177



192

 App  Spider

204





   OS 
   
   

2>2017 

   CDN  MVVM  Vue   KNBNative
Bridge AWP  NodeServer   AngularJS/Vue.js  NGUIAngularJS  Node  Express OPS   H5    SEO 
 SDK  Node   30%  Top90  9ms Node  

<3  Yeoman   Gulp  Webpack  NPM Sass  CSS  CSS  Babel  ES6  ES6  ESLint  Sonar  Sentry Perf  Web  Falcon  Server  PM25  Node   NodeServer  Node    


   

4>2017 
     

 Node 
  
  

 H5    H5 

 Vue  React
  MVVM  
 Vue2.x  SSRPC  
      Weex   VueVue-Native       Hybrid    
  IE8 PC  
  Vue  AWP  
  2.x 

<5  React  Licence  Vue 


 100    IM    PC   
  

6>2017 



  
 2016  6   C  "  " 
  
  UI  
   

 Java  FTL   CSS  JS  Cortex 
 FTL    

<7                                  AJAX   CI  CDN

  ES6 Module  
   
   
 Bundle 

8>2017 
 Split JS  SPA
 Tree Shaking ES6   bundle  JS Bundle  
 Scope HoistingES6   Bundle 

   API  ReactVue  Angular  Vue.js  APIW3C  Web Component  

 19kBmin+gzip  API 
         webpack Loader Vue Dev Toolsvue-clivue-test-utils  

<9
 Virtual DOM  DOM   DOM 
       
   webpack 
Vue.js   webpack loader   Vue.js 
 Vue.js dora-ui 
 20  Vue.js 2.0  
  Readmemarkdown  
   
  webpack plugin
JSON    JSON 

10>2017 
      

<11

 


 

 demo   webpack  require.context API  components   demo  Demo 
var demoRequire = require.context('@component', true, /demo\/.*\.vue$/); //  demo  const demos = demoRequire.keys().map(demoKey => {
var [componentName, demoName] = demoKey.split('/demo/'); componentName = componentName.substring(2); demoName = demoName.substring(0, demoName.lastIndexOf('.')); return {
componentName: componentName, demoName: demoName,

12>2017 
component: demoRequire(demoKey) } });
//  key + value  demo  const demosByComponent = _.groupBy(demos, demo => {
return demo.componentName; });
//  const routesByComponent = Object.keys(demosByComponent).map(componentName => {
return { path: '/' + componentName, component: require('./component.vue'), meta: { componentName: componentName, demoComponents: demosByComponent[componentName] }
} }); //  demo  const routesByDemo = demos.map(demo => {
return { path: '/' + demo.componentName + '/' + demo.demoName, component: demo.component, meta: { componentName: demo.componentName, }
} });
 Mock 
                         web-
pack-dev-server Mock  API

 Mock 


<13

 


  3 
   

14>2017  

 CDN   
 
 AJAX  SLB SLB  

                               CDN  30   10 
 CDN  

<15
 & 
   CDN 
    

  
 HTML Application Cache API 

16>2017 
 manifest  manifest 
 manifest   manifest  applicationCache  updateready      updateready  

 +   Vue  +  
AppCache  Service Worker  SW  SW  

<17

Web                 WebGLWebVRHTTP/2 Service WorkerWeb AssemblyWebRTC   Web 
   

2016  

18>2017 

  
1. 
  ""
    
  
   
2. 
 
2.1 2.1.1


<19
     
    "" 
  3.2.1  Model   
   
        QPS 

20>2017 

2.1.2      UI 
 UI   3.2.1 
 Script 

2.1.3          FreeMarker   EJS     HTML       

<21  Mock  ModelView 
 JSON  Mock  

2.2
 

   

22>2017 
  
  ""  0.username 
2.3
 Java  Node.js  SDK 
2.3.1Java  JAR  SDK   HTML  FreeMarker 
/** *  * @param pageId  id  vurl,  pageIdType  * @param pageIdTypeLegoService.PageIdType.IDLegoService. PageIdType.NAME  id  vurl  * @return OK(200,"  "), FAILED(500,"  "); * */
public static final LegoStatus getPageWithoutData(HttpServletResponse servletResponse, String pageId, PageIdType pageIdType)
/** *  * @param model  * */
public static final LegoStatus getPage(HttpServletResponse servletResponse, String pageId, PageIdType pageIdType, ModelMap model)
2.3.2Node.js 
'use strict';
var lego = require('lego');

<23
/** *  id  , * @param data, json  * @param rootId  * @param callback,  callback(err, body),  err body  html  err  * */
lego.renderById(vid, data, rootId, callback) /**
*  * */ lego.renderByUrl(vurl, data, rootId, callback)
3. 
3.1
 AMDCMDCommonJS  
 JavaScript   Web App  
 DOM   


24>2017  

3.2
  
3.2.1  /  UI   HTML   HTML   CSS  Hack  CSS  8 
/** *  8 name, pyname, desc, leaf,
uilib, model, script, render */
'use strict';

<25

/** *  *  * [  name  RD  ] */
exports.name = 'Sample';

/** *  * [  pyname  PM  hmtl 
 ]
*/ exports.pyname = '  ';

/** *  */
exports.desc = '';

/** *  * 1.  id : exports.leaf = [12,23,34] * 2.  leaf  null : exports.leaf = null * 3.  leaf  : exports.leaf = [] */
exports.leaf = [];

/** *  */
exports.uilib = 'kui';

/**

*  / 

*

* type:  : * text: 

*

textEx: {

*

name: '  1',

*

type: 'text',

*

def : '  ',

*

desc: '  '

* }

* select: 

*

selectEx: {

*

name: '  1', //  9 

*

type: 'select',

*

options:{

26>2017 

*

value1: '  1',

*

value2: '  2',

*

},

*

def : 'defValue',

*

desc: '  '

* }

* textarea:  (  text) * radio:  (  select)

* checkbox:  (  select value1,value2  )

*/

exports.model = {

}

/** *  html  * @param mvId  mvId * @param evtMgr  bind(evt, handler) unbind(evt, handler)  trigger(evt, data, context)  * @param modelData  encode  decodeURI  json  */
exports.script = function (mvid, evtMgr, modelData) { modelData = JSON.parse(decodeURI(modelData));
}

/** *  * @param {Object} node node  {_children:[], _parent:'', _innerHtml:'', _modelData:{}, _mid:'', _mvid:'', _mname:''},  */
exports.render = function (node) { var _modelData = node._modelData; var _children = node._children; var content = ''; _children.map(function (child) { content += child._innerHtml; });

return ``; }

3.2.2  

<27

  Script mvidevtMgr modalDataevtMgr  

//  evtMgr.trigger('tata', {a: 1});

//  evtMgr.bind('tata', (params) => {

// TODO Here. console.log(params) })

// {a: 1}

  

    AJAX 

28>2017 
   Render 
exports.render = function (node) { var _modelData = node._modelData; var _children = node._children; var content = ''; _children.map(function (child) { content += child._innerHtml; });
return `${data_from_datasource}`; //  }
 "3.2.1 " 8 
     
    HTML   freemarker.jar   freemarker.jar 

<29
  HTML  
3.3
 Node.js Express   

30>2017 

3.4
 
 _children_parent  

{ 1_0: { _children: [101_1], _mvid: '1_0', _parent: '#', _mid: '1', _version: '1.0.0' _mname: 'Page', _xxx: '' }, 101_1: { _children: [5_2], _mvid: '101_1', _parent: '1_0, _mid: '101', _version: '1.0.0' _mname: 'Body', _xxx: '' }, 5_2: { _xxx: '' }
}

// children in current page // unique id in current page // parent in current page // id // version // name // other properties

 

4. 
4.1
 55  77  132   6  108  

<31   
4.2
  UI  ---- UI  
 UI 
4.3
  
   


32>2017 
  
 


  Web 2013   10  900   to Bto C   2010   MTKIBM2016   2012   Web 2015  

 doT.js 


<33


 MVC-->MVP-- >MVVM  ReactVueAngular   MVVM   
 
doT.js Laura Doktorova   doT.js 

 doT.js mustache Handlebars artTemplate(  ) BaiduTemplate(  ) jQuery-tmpl

 6KB

 4KB

18.9 KB 9.3 KB

512KB 62.3KB

-

5.2KB

9.45KB 6KB

18.6KB 5.98KB

 

 







×



























doT.js  Mac Pro   Chrome 56.0.2924.87 100  10000  

34>2017 
 doT.js 
1. 6KB  4KB 2.  3.  4. 
 doT.js 

 doT.jsdoT.js 
<script type="text/html" id="tpl"> <div> <a>name:{{= it.name}}</a> <p>age:{{= it.age}}</p> <p>hello:{{= it.sayHello() }}</p> <select> {{~ it.arr:item}} <option {{?item.id == it.stringParams2}}selected{{?}}
value="{{=item.id}}"> {{=item.text}}
</option> {{~}} </select> </div> </script> <script> $("#app").html(doT.template($("#tpl").html())({ name:'stringParams1', stringParams1:'stringParams1_value',

<35

stringParams2:1, arr:[{id:0,text:'val1'},{id:1,text:'val2'}], sayHello:function () {
return this[this.name] } })); </script>

    doT.js                        HTML 




JavaScript

 =

 if

 else/else if

 for

 funcName()

 {{=  }} {{?  }} {{??}}/{{??  }} {{~  }} {{= funcName() }}

 {{=it.name }} {{? i > 3}} {{?? i ==2}} {{~ it.arr:item}}...{{~}} {{= it.sayHello() }}


doT.js 
1.  
2. View  JavaScript  3. 
doT.js 
... //  str = ("var out='" + (c.strip ? str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ")
.replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""): str) .replace(/'|\\/g, "\\$&")

36>2017 
.replace(c.interpolate || skip, function(m, code) { return cse.start + unescape(code,c.canReturnNull) + cse.end;
}) .replace(c.encode || skip, function(m, code) {
needhtmlencode = true; return cse.startencode + unescape(code,c.canReturnNull) + cse.end; }) //  if  else  .replace(c.conditional || skip, function(m, elsecase, code) { return elsecase ?
(code ? "';}else if(" + unescape(code,c.canReturnNull) + ") {out+='" : "';}else{out+='") :
(code ? "';if(" + unescape(code,c.canReturnNull) + "){out+='" : "';}out+='");
}) //  .replace(c.iterate || skip, function(m, iterate, vname, iname) {
if (!iterate) return "';} } out+='"; sid+=1; indv=iname || "i"+sid; iterate=unescape(iterate); return "';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+"," +indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"
+vname+"=arr"+sid+"["+indv+"+=1];out+='"; }) //  .replace(c.evaluate || skip, function(m, code) {
return "';" + unescape(code,c.canReturnNull) + "out+='"; }) + "';return out;") ...
try { return new Function(c.varname, str);//c.varname  new Function
 } catch (e) { /* istanbul ignore else */ if (typeof console !== "undefined") console.log("Could not create a
template function: " + str); throw e;
} ...

 HTML  new Function() 


<37

 1
 doT.js  doT.js  doT.js 

templateSettings: {

evaluate: /\{\{([\s\S]+?(\}?)+)\}\}/g, // 

interpolate: /\{\{=([\s\S]+?)\}\}/g, // 

encode:

/\{\{!([\s\S]+?)\}\}/g, //  {{ 



use:

/\{\{#([\s\S]+?)\}\}/g,

useParams: /(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\

s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,

define:

/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,// 

defineParams:/^\s*([\w$]+):([\s\S]+)/, // 

conditional: /\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g, // 

iterate:

/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\

w$]+))?\s*\}\})/g, // 

varname: "it", // 

strip: true,

append:

true,

selfcontained: false, doNotSkipEncoded: false // 

}

  doT.js   tmpl   doT. js  
doT.js  

38>2017 
 2new Function() 
 Function  JavaScript Function Object  Array Date 
var funcName = new Function(p1,p2,...,pn,body);
p1  pn body funcName  
 
//  function func1(a,b){
return a+b; } //  var func2 = new Function('a,b','return a+b'); //  var func3 = new Function('a','b','return a+b'); //  console.log(func1(1,2)); console.log(func2(2,3)); console.log(func3(1,3)); //  3 // func1 5 // func2 4 // func3
Function   eval eval   XSS  eval new Function()   doT  "new Function(c.varname, str)"  varname  str 
 new Fcuntion  Function 

<39

doT.js 

jQuery-tmpl
function buildTmplFn( markup ) { return new Function("jQuery","$item", // Use the variable __ to hold a string array while building the
compiled template. (See https://github.com/jquery/jquery-tmpl/issues#issue/10). "var $=jQuery,call,__=[],$data=$item.data;" +
// Introduce the data as local variables using with(){} "with($data){__.push('" +
// Convert the template into pure JavaScript jQuery.trim(markup)
.replace( /([\\'])/g, "\\$1" ) .replace( /[\r\t\n]/g, " " ) .replace( /\$\{([^\}]*)\}/g, "{{= $1}}" ) .replace( /\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?) ?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g, function( all, slash, type, fnargs, target, parens, args ) {
//  ,  : https://github.com/BorisMoore/jquery-tmpl
}) + "');}return __;" ); }
jQuery-teml  new Function() 
 jQuery-teml  doT.js 
 with 
with 
var datas = {persons:['  ','  ','  ','  ','  ','  ','  '], gifts:['  ','  ','  ','  ','  ']}; function go(){
with(datas){ var personIndex = 0,giftIndex = 0,i=100000; while(i){ personIndex = Math.floor(Math.random()*persons.length); giftIndex = Math.floor(Math.random()*gifts.length)

40>2017 
console.log(persons[personIndex] +'  :'+ gifts[giftIndex]); i--; } } }
 with  datas  with   JavaScript     with      datas   
 GitHub  Boris Moore 

<41 1. 
 String    Dom   jQuerytmpl   with  2.      
 with  
 Boris Moore 

42>2017 

function buildTmplFn( markup ) {
if(!compledStr){ // Convert the template into pure JavaScript compledStr = jQuery.trim(markup) .replace( /([\\'])/g, "\\$1" ) .replace( /[\r\t\n]/g, " " ) .replace( /\$\{([^\}]*)\}/g, "{{= $1}}" ) .replace( /\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?
(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g, // 
}
return new Function("jQuery","$item", // Use the variable __ to hold a string array while building the
compiled template. (See https://github.com/jquery/jquery-tmpl/issues#issue/10). "var $=jQuery,call,__=[],$data=$item.data;" +
// Introduce the data as local variables using with(){} "__.push('" + compledStr + "');return __;" ) }
 doT.js  with  doT.js   
 25 tmpl
(function(){ var cache = {};
this.tmpl = function (str, data){ var fn = !/\W/.test(str) ? cache[str] = cache[str] || tmpl(document.getElementById(str).innerHTML) :
new Function("obj", "var p=[],print=function(){p.push.apply(p,arguments);};" + "with(obj){p.push('" +
str

<43
.replace(/[\r\t\n]/g, " ") .split("<%").join("\t") .replace(/((^|%>)[^\t]*)'/g, "$1\r") .replace(/\t=(.*?)%>/g, "',$1,'") .split("\t").join("');") .split("%>").join("p.push('") .split("\r").join("\\'") + "');}return p.join('');"); return data ? fn( data ) : fn; }; })();
 baiduTemplate  baiduTemplate  baiduTemplate   doT.js    with 
 tmpl  with  

 https://github.com/chen2009277025/TemplateTest

44>2017 

 doT.js 
1. doT.js   
2. doT.js  baiduTemplate   baiduTemplate  
 ""     

2015    Hi-FE

WebView 


<45

 App  WebView  AndroidiOS  Web 
WebView  
  WebView   WebView 

 WebView  native   WebView  loading     WebView 
1.  2.  3.  loading  4. 
WebView 

46>2017 
 WebView  
WebView 
 App  WebView  WebView 
App  WebView  


 WebView                      WebView     
WebView              WebView    WebView     
WebView WebView    1iOS Titans 10.0.7  2OPPO R829T Android 4.2.2  10   App ms

<47

*Android  WebView  WebView 

 
WebView  70~700ms " WebView "     WebView 
  WebView   WebView 

48>2017 

 ?
 native  
 WebView 
  WebView    WebView  WebView 
 WebView  App   WebView 

     -  CN106250434A  
  WebView  native    native 
 WebView  WebView  
70%  H5  QQ Hybrid  

<49
1.  WebView 2.  Native  WebView

 / 
  DNS  connection  

  n% ms


 
DNS  API  DNS             WebView            native  API  DNS   api.meituan.com WebView  i.meituan.com

50>2017 
 App 
  api.meituan.com DNS        WebView                   
i.meituan.com  IP
 10%  WebView  60ms  DNS   WebView  App  API  WebView  DNS  1.3ms 

 chunk   chunk   flush -->Web API--> API Web API  Web API 
1.  2.  API 
  API 
  HTTP  header  transfer-encoding:chunked  head   body   Web API  API  API   chunk 

<51
  API   API 
  chunk-encoding: chunked  API  API  
   API 

 CSS  

 http://i.meituan.com/firework/meituanxianshifengqiang  Mac  4G  

52>2017 

1

<53
 HTML 
2
  1
Dom  Layout  rem 
 2  HTML  HTML  DOM  JSJavaScript 90ms......  header 
..... <link href="//ms0.meituan.net/css/eve.9d9eee71.css" rel="stylesheet" onload="MT.pageData.eveTime=Date.now()"/> <script> window.fk = function (callback) { require(['util/native/risk.js'], function (risk) {
risk.getFk(callback); }); } </script> </head> ....
 link  script  

54>2017   CSS    JS    CSS  JS  JS  HTML  CSS  HTML  CSS  JS
 JS  CSS  JS  HTML  

 14   JS 
1. CSS  HTML  CSS  CSS  
2. CSS  JS  JS  HTML 
3.  CSS 
JS 
   JS 

<55
  JS    JS  "  " + "  " 
    
  BPM
JS 
 PC  JS   kb JS  
 CPU  PC JS   JS 

 JS  / 
<script> window.t1 = performance.now()
</script> <script>
window.test = function () { // test code
} </script> <script>
window.t2 = performance.now() test(); window.t3 = performance.now();
alert(" " + (t2 - t1)); alert(" " + (t3 - t2)); </script>

56>2017  test code   t1~t2 JS     t2~t3  test   WebView  iPhone6 iOS 10.2.1 OPPO R829T Android 4.2.2 ms/ ms
 WebView  


   React 50ms ~ 350ms


<57
  App  
JS   +  +  KB  Web 

   React   JS  App 
WebView 
nativeCPU   
 WebView    trunk 
      WebView  WebView   DNS   

58>2017 
WebView 

 WebView  1.  2.  3.  4.  5.  6.   iOS Titans 10.0.7 OPPO R829T Android 4.2.2  10 
 WKWebView  UIWebView  Android  WebView 
 WebView  UIWebView  WebView  Web-
View  

<59
 WKWebView    WebView 
WebView 
WebView  native  

 WebView  WebView  
 body  CSS 

 WebView click  300ms  
         metaviewpoint       Chrome     Android 
 fastclick 
 / 
 
 PC  native  WebView 
Scroll Event 
WebView 
 setTimeout  setInterval   GIF 

60>2017 
   background-position: fixed    WebView 
 
  iOS  position: sticky    Android  touchmove  position   crash  WebView  API  App  
 2M   WebGL
WebView 
WebView 
 WebView    WiFi

   header     

<61
  iframe   HTTPS   DNS 
 
 CSPContent Security Policy CSP   
  inline  
  HTML+CSS  CSP     
 CSP  
HTTPS HTTPS   HTTPS  HTTPS  HTTPS   CSP  HTTPS   HTTPS 

62>2017 
App  Socket   HTTP  App  Socket   WebView   WiFi  HTTPS  Socket 
  HTML   HTML  ...... WebView   HTML  HTML  WebView 
  CDN ......
 MD5  
 WebView
 WebView  schema   URL  URL 
 URL  

  App  WebView schema  appxx://web?url={weburl}  App  schema    appxx://web?url={some_
hack_weburl}

<63
  some_hack_weburl   some_hack_weburl 

 WebView  WebView  

      native                     WebView 
 WebView  App  
ReactNativeWeek  
WebView  App  App  

64>2017 
 SDK 


 
    
       
  SDK  

   
   

<65          DNS    JavaScript 
 crossorigin       

  


66>2017 
  

PMBD  RD PM RD shopId  PMxxx RD   
 
 

<67  HUNT  SDK  


68>2017 
 HUNT SDKWeb  
  SDK   Web   
 SDK  
 SDK  
   EventData  ErrorData  DNS       API         
  
   Node 
  LocalStorage

<69

SDK    

Web JsBridge  
 UAISP  Web  Web   init  getEnv 
 init   getEnv  URL env  freeze 

70>2017 

 
 Localstorage  Localstorage Localstorage 
 Localstorage   

<71

72>2017 
 DNS 
HTTPS  
  HTTPS  HTTP  Node   HTML  JavaScript     
 
1. onloadwindow.onload  2. onload_timeout: onload 5 

<73
3. asyncwindow.onload 5  4. hash_changeonhashchange 5 


 Window  error  Window  error src  href   JavaScript  crossorigin 
API   XMLHttpRequest  hook  open  URLsend  status 
XMLHttpRequest.prototype.open = function open(method, url, bool) { monitor.originXHR.open.apply(this, [method, url, bool]); // get something... // this.ajaxUrl = url;
}
XMLHttpRequest.prototype.send = function send(_data) { const self = this;
this.addEventListener('readystatechange', () => { if (self.readyState === 4) { if (self.status !== 200 && self.status !== 304 && this.ajaxUrl
!== REPORT_URL) { // filter urls // report error info // ... // monitor.reporter.report(dataTypes.API_ERROR, error);
} } }, false);
monitor.originXHR.send.apply(this, [_data]); };
 SDK  

74>2017 
 URL  domain   Window  error  error   Window  click   data   DOMPath   

SDK 
1.  SDK     head 
2.  SDK    
 v1  SDK   head   webpack 
 +loaders/plugins   SDK  head 

HUNT  Web 

<75
 
 
  API  
  
 SDK   

76>2017 



 9  UI   

     DNS 
 
 

    GMV 

<77

   JS 
         WebView Hybrid  
   NGINXNode   CDN  SSL 

  DNS 
 DNS  
 

 (rank) "

78>2017  "  "too young too simple, some times naive"
   ""
  bug       

<79
      
      
""""        ......
""""      Web           
"""" 

80>2017 

 
"" 
  ReactAngularEmber  SPA  
" "React  Angular     
" "  
 SPA   Cocoa View Controller  " Cyra"                           



<81


     SSR

82>2017 
 
SSR  JavaScript"JS" CSSHTML 
  SSR JSP ASP  SSR   ASP.NET Web Form  
   
  CSS JS HTML  JS  HTML  JS  HTML   JS 
 SSR Node   

<83
Node Node   Node ""  Node 
"" ""

84>2017 
 Node   Node
 "" "" ""   

""JS   2015  TypeScript"TS" Facebook  Flow  Flow 
 TS  TS   99%  TS  

<85

""case  "Web "
Web  case   case  
 Web "Freekite"  case  case  case  Mock  Mock   case  
 case  Freekite   case  Freekite   Freekite  Case 

86>2017 

""  95%    
 div   
 NGINX  CDN   SRE  SRE  
 DNS  DNS   DNS   HTTP   
 HTTPS HTTP  HTTPS  HTTP  HTTP  DNS   HTTP   HTTPS  DNS  HTTPS   SSL   HTTPS   99.96%  96% 


<87
 JS Error   Performance  CAT   DNS 



88>2017 


   
 
1.  
2.  "" Mixpanel
3. ""  GrowingIO

1.  
2.  
3.  

<89
     

   

 

EventInfo eventInfo = new EventInfo(); eventInfo.nm = EventName.MGE; eventInfo.val_bid = "xxx";

//  MGE // 

90>2017 
eventInfo.val_lab = new HashMap<>(); //  eventInfo.val_lab.put(Constants.Business.xx,"xxx"); Statistics.getChannel("hotel").writeEvent(eventInfo);
  ""

 
Android
 Android  UI  TextViewLinearLayoutListViewViewPager   ----
 Android v7  AppCompatDelegate  UI 
public class GAAppCompatDelegateV14 extends AppCompatDelegateImplV14 { @Override View callActivityOnCreateView(View parent, String name, Context context,
AttributeSet attrs) { switch (name) { case "TextView": return new NovaTextView(context, attrs); } return super.callActivityOnCreateView(parent, name, context, attrs);
} }
 Activity  getDelegate   AppCompatDelegate UI 

<91
@Override public AppCompatDelegate getDelegate() {
if (mDelegate == null) { mDelegate = GAAppCompatUtil.create(this, this);
} return mDelegate; }
  UI   UI  UI   Gradle    UI  UI 
apply plugin: 'com.meituan.judasplugin'
 
GAHelper.bindClick(view, bid, lab);
iOS
 iOS  Objective-C  UI  UIControl action 
- (void)nvja_setAnalyticsParams:(NVJAMGEParameter *)params mgeType: (SAKStatisticsEventMGEType)type
{ if (self.wmja_clickParams == nil && type == SAKStatisticsEventClick) { [self addTarget:self action:@selector(wmja_controlDidTapped:)
forControlEvents:UIControlEventTouchUpInside]; } [super nvja_setAnalyticsParams:params mgeType:type];
}

92>2017 
 UITableView UITableViewDelegate 
- (void)forwardInvocation:(NSInvocation *)anInvocation {
SEL selector = [anInvocation selector]; if (self.originalDelegate && [self.originalDelegate respondsToSelector: selector]) {
[anInvocation invokeWithTarget:self.originalDelegate]; } SEL nvjaSelector = [self nvjaSelector:selector]; if ([super respondsToSelector:nvjaSelector]) {
[anInvocation setSelector:nvjaSelector]; [anInvocation invokeWithTarget:self]; } }

NVJAMGEParameter *parameter = [[NVJAMGEParameter alloc] init]; parameter.bid = @"bid"; parameter.lab = @{@"poi_id":@"1"}; button.nvja_clickParams = parameter;
  

  bid 
  

<93

 ID  Index     Index 
 bid   bid   

94>2017 

  API    
 URI Scheme PV   PV 
                         "    "  ""   70%   30%  

      
 

<95
   

96>2017 
Shield


 Android  iOS     

Shield  UI  NativeAndroid&iOS UI   UI   GitHub https:// github.com/Meituan-Dianping/Shield

<97

 Shield Agent  UI   
 UI  
 MVP  MVVM Shield   MVP   Shield  MVP  MVVM  

98>2017 
 UI Shield  Context  UI   Shield 
 Agent 
public interface AgentInterface { void onCreate(Bundle savedInstanceState); void onStart(); void onResume(); void onPause(); void onStop(); void onDestroy(); Bundle saveInstanceState(); void onActivityResult(int requestCode, int resultCode, Intent data); String getIndex(); void setIndex(String index); String getHostName(); void setHostName(String hostName); SectionCellInterface getSectionCellInterface(); String getAgentCellName();
}
 Agent 
1.  2.  SectionCellInterface

<99
SectionCellInterface  Section UI Row 
public interface SectionCellInterface { int getSectionCount(); int getRowCount(int sectionPosition); int getViewType(int sectionPosition, int rowPosition); int getViewTypeCount(); View onCreateView(ViewGroup parent, int viewType); void updateView(View view, int sectionPosition, int rowPosition, ViewGroup parent);
}

Shield  Config ConfigShield  
 Shield  AgentManagerCellManager
AgentManager CellManagerSectionCellInterface

100>2017 

 
  RxJava   Shield  WhiteBoardWhiteBoard   WhiteBoard 

<101
Shield 

 App 


 Shield  Native loading   App 

ReactNative                                 JSBridge   

102>2017 

 ReactNative   

 

 Activity+Fragment+Agent  Tab   Team 
 Shield 




<103


 App  
" 3 57% " "Amazon  1  16 "
  ""  



104>2017  

   GFW   DNS          HTTP  Socket 
  HTTP   HTTP Post 
 URL  header HTTPS  

<105 App 

 HTTP 

 App  API 
search.api.dianping.com ad.api.dianping.com tuangou.api.dianping.com waimai.api.dianping.com

106>2017  movie.api.dianping.com ... App   HTTP    DNS  IP 
 
 
   SLB(Server Load Balancing) 
 URL  ""
 URL "http://ad.api.dianping.com/command?param1=123"      "http://api.dianping.com/ad/command?param1=123" 
 "ad.api.dianping.com"  "api.dianping.com"  "ad" 

<107  URL  "api.dianping.com"  path   SLB  ""  "http://api.dianping.com/ad/command?param1=123"  SLB     "http://ad.api.dianping.com/command?param1=123"  SLB    1.  DNS  DNS  2.  Keep-Alive  Http  3. 
IP 
 "api.dianping.com"  DNS 
 "api.dianping.com"  IP   IP  IP HTTPS   IP 
 "api.dianping.com"  IP  "1.23.456.789"

108>2017 
URL"http://api.dianping.com/ad/command?param1=123"      "http://1.23.456.789/ad/command?param1=123"
IP  1.  DNS DNS  2.  DNS  3. IP   App  HttpDNS    http://www.tuicool.com/articles/7nAJBb  HTTPS    HTTPS  IP   HTTPS http://blog. csdn.net/github_34613936/article/details/51490032  IP HTTP  95%   97.5% 1500  1000  

 HTTP/2  
 HTTP/2 
HTTP/2  

<109
1.  DNS DNS  2.  3. 
 4.  HTTP/2
 5.   HTTP/2  
  TCP  HTTP  TCP   HTTP  
 HTTP/2  1.  DNS  IP 
DNS  HTTP   DNS   DNS  DNS   DNS  2.  3. 

110>2017    IP   
4.  SDK    HTTP 
5.   WNS https://www.qcloud.com/product/wns 
WNS   99.6% PS  99.9% 
 WNS  


 

<111

 
 

 TCP  
 

 
  Failover 

112>2017   TCP 
  Failover  TCP   UDP   HTTP  Failover 
 
 
 SDKSDK  WNS 


<113
 SDK 
1. CIP CIP CIP  China Internet Plus App   CIP  TCP CIP Connection Server API Server  TCP  CIP   UDP  HTTP  HTTP  CIP  99.7% 350 
2. WNS  WNS  SDK CIP WNS  
3. HTTP  HTTP  API Server    CDN   HTTP  
 Push Server TCP  SDK   



114>2017 
                                81%
 99% 

 
 Failover   2015   Android  Failover  Failover 

<115  UDP  Failover  iOS Failover  

 SDK  CIP|WNS|HTTP  
 App  SDK   API 


116>2017 
 WNS   WNS   5  WNS 


   App     1.4%  160 
 TCP  HTTP/2  
  SDK   ABTest 
 iOS  Android                                             Accept-Encoding  Content-Type 
 HTTP   "Set-Cookie"   "Cookie"  header  

<117
  
       Cat Cat  http://github.com/dianping/cat    IP     HTTP/2  WNS 

 SDK 

118>2017 
iPhone X 
starzhang

iPhone X  9  13  iPhone X  App   Tabbar  App 


 1.1 App 

 1.2

<119



  1.3 

 1.4" Tab"

 1.1  1.2  "" " Tab" 1.3 1.4   UIBarButtonItem  UI  Bug 
 developer.apple.com   HIG (Human Interface Guideline) WWDC  App  


120>2017 
HIG 

 2.1 iPhone 
 iPhone X iPhone X  iPhone 8   145pt 20% 
 2.2iPhone X 

<121

 2.2  Like this
 2.3CGRectMake(0,0,100,100)
iPhone X 

122>2017 
 2.4iPhone X 
Status Bar
iPhone X  StatusBar  iPhone   20pt  frame  (tu)  (xue) iPhone X   [[UIApplication sharedApplication] statusBarFrame]  44pt
 2.5iPhone X 
" App  StatusBar iPhone X   "
 iPhone X StatusBar  

<123

 Home iPhone X  - Home Indicator 34pt

 2.6iPhone X  Home Indicator 

"       TabBar   Home Indicator  TabBar   feed   feed "
 TabBar  barTintColor  Setting  indicator    UI 

SafeArea
iOS 11    iOS 7      topLayoutGuide/bottomLayoutGuide  safeLayoutGuide   UI 

 2.7 TabBar  Home Indicator 

124>2017   barNavgationBarToolBarTabBarStatusBar
 2.8iPhone  SafeArea
 AutoLayout safeAreaLayoutGuide  safeLayoutGuide SafeArea 2.9   Guide  self.additionalSafeAreaInsets  

<125 
 2.9 SafeArea  self.additionalSafeAreaInsets = UIEdgeInsetsMake(64, 0, 0, 0)

 Aspect Ratio  iPhone X  
 App 
 Session 201 
 xib  iPhone X  UseSafeAreaLayoutGuides  iOS 9  App 
 3.1 xib 

126>2017    SearchViewController
 3.2iOS 11 UISearchViewController 
 iOS 11  NavigationBar  SearchViewController 
  UITableViewSenctionHeader 
 3.3iOS11  Tableview 
 UITableViewCell  Cell  ContentView  inset  SafeArea 
 Tableview  contentView   inset To SafeArea contentview  cell   contentView  layoutMargin  SafeArea 

<127  UITableViewHeaderFooterView.backgroundView  backgroundColor
 3.4iOS11 

        "       "           20pt     [[UIApplication sharedApplication] statusBarFrame].size.height]

128>2017 
  iOS 11   iPhone X iOS 11 


 4.1 iOS 11  NavigationBar

 4.2 iOS 11  NavigationBar

 _UIButtonBarStackView  PFBNavigationBarContainerView  X 
" Tab" Tableview  Tableview 

 4.3iOS11 " Tab" Tableview 
iOS 11  scrollview  adjustedContentInset 

 4.4iOS 11  ScrollView 
 contentoffset.y 

<129
 4.5 iPhone X 
 Tableview  frame  safeArea  adjustedContentInset  safeAreaInset  Tableview 
 4.6iPhone X  safeAreaInset 
 adjustedContentInset  readOnly   Tableview.contentInsetAdjustmentBehavior=UIScrollViewContentInsetAdjustmentNever  tableview. contentOffset 
" Tab"  AutoLayout   UIBarButtonItem  UIBarButtonItem customView  Button Button  frame   AutoLayout 
 UIBarButtonItem  UIBarButtonSystemItemFixedSpaceiOS 11   fixedspace  trick  https://forums. developer.apple.com/thread/80075
 CustomView  CustomButton CustomView  Button  lefttop  size

130>2017 
 4.7

// offset  if (@available(iOS 11.0, *)) {
self.contentViewController.tableView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever;
} // UIBarButtonItem  if (@available(iOS 11.0, *)) {
[messageButtonsContainerView mas_makeConstraints:^(MASConstraintMaker *make) {
make.size.mas_equalTo(CGSizeMake(themeButton.width + settingButton.width + messageButton.width, 44));
}]; [themeButton mas_makeConstraints:^(MASConstraintMaker *make) {
make.top.equalTo(messageButtonsContainerView); make.left.equalTo(messageButtonsContainerView); make.size.mas_offset(CGSizeMake(44, 44)); }]; [settingButton mas_makeConstraints:^(MASConstraintMaker *make) {

<131
make.top.equalTo(messageButtonsContainerView); make.left.equalTo(themeButton.mas_right); make.size.mas_offset(CGSizeMake(44, 44)); }]; [messageButton mas_makeConstraints:^(MASConstraintMaker *make) { make.top.equalTo(messageButtonsContainerView); make.left.equalTo(settingButton.mas_right).offset(-10); make.size.mas_offset(CGSizeMake(44, 44)); }]; }
UIBarButtonItem *rightBarItem = [[UIBarButtonItem alloc] initWithCustomView:messageButtonsContainerView];
self.navigationItem.rightBarButtonItems = @[rightBarItem];

 Xcode 9 GM  (9A235)  
1. StatusBar  2.  UI(titleViewUIBarButtonItem) 
iPhone 6s iOS 11  AppStore   iOS 10  SDK  3. safeAreaInset  Scrollview 
 Tabbar 

132>2017 
 KIF  iOS UI 

 UI   iOS  KIF  UI 

iOS UI  UI Automation  Apple  UI  JavaScript  UI 
 UI  UI Automation   UI Automation  UI Automation
  UI Automation  JavaScript  UI Automation   TuneupJsynm3k
  UI Automation  UI Automation  TCP  UI Automation   JavaScript  iOSDriverAppium
 API 
  API  Apple  API  UI   KIF
  Server  App  Server   UI  FrankCalabash
Xcode 7   Apple        UI          ----UI Testing XCTest 

<133  UI  API
UI AutomationAppium KIFFrankUI Testing 
 iOS  Objective--C  XCTest    UI  API  UI  UIWebView App   UI  UI  
KIF  KIF  XCTest   iOS  KIF   KIF  iOS  UI 
KIF 
KIF  Apple  accessibility attributes   Xcode  XCTest 

134>2017 
XCTest  command line build  
 KIF 
1. KIF 
KIF  KIF  Xcode 
KIF  XCTest  XCTest  XCTest   Cocoa Touch Testing Bundle  Target   Target 
"  Build Phases" Target Dependencies UI   App  Target  Test Target  Target Dependencies 
"  Build Settings": "Bundle loader"$(BUILT_PRODUCTS_DIR)/MyApp.app/MyApp "Test Host"$(BUILT_PRODUCTS_DIR) "Wrapper Extensions"xctest
 KIF  KIF  
KIF     AccessibilityLabel, AccessibilityIdentifier, AccessibilityTraits,Value... accessibility  cell  cell  accessibility "Section XX Row XX"  cell  Accessibility Inspector  

<135
KIF  accessibility  
 - (void)tapViewWithAccessibilityLabel:(NSString *)label          - (UIView *)waitForViewWithAccessibilityLa-
bel:(NSString *)label  Target  KIFTestCase  
 KIF  Product->Test   ( U) 
2.  1accessibility 
accessibility  Apple   UI   UIKit  

136>2017 
  
  Accessibility Inspector   accessibility 
  AccessibilityLabel   VoiceOver   AccessibilityIdentifier 

2  UI  ( KIFUITestActor.h  )

tapThisView:

- (void)tapViewWithAccessibilityLabel:

(NSString *)label;

waitForView:

- (UIView *)waitForViewWithAccessibilityLabel:

(NSString *)label;

 View 

enterTextIntoView:

- (void)enterText:(NSString *)text

intoViewWithAccessibilityLabel:(NSString *)label;

tapRowOnTableView:

- (void)tapRowAtIndexPath:(NSIndexPath *)

indexPath inTableViewWithAccessibilityIdentifier:(NSString *)identifier

NS_AVAILABLE_IOS(5_0);

dismisses a system alert: - (void)acknowledgeSystemAlert;

 KIFUITestActor  KIFUITestActor   AccessibilityIdentifier  Label  tapThisView  waitForView 

  ( KIFTestCase.h  )
- (void)beforeAll;  test case    test case 
 - (void)beforeEach;  test case    test case  - (void)afterEach;  test case 

<137

 App  test case   test case 
- (void)afterAll;  test case   App 

  ( KIFSystemTestActor.h 



- (void)simulateDeviceRotationToOrientation:

(UIDeviceOrientation)orientation;

- (void)captureScreenshotWithDescription:

(NSString *)description;

3  :

 a.   b.   c.  App 

ac  beforeEachafterEach  
    

 a.   b.   c.  App 

ac  beforeAllafterAll 
#import " TimerTests.h" #import " KIFUITestActor+AccessibilityLabelAddition.h" #import " KIFUITestActor+IdentifierAdditions.h"

138>2017 
#import "KIFUITestActor+TimerAdditions.h" @implementation TimerTests - (void)beforeAll {
[tester setDebugModel]; } - (void)afterAll {
[tester resetDebugModel]; [tester clearHistory]; } - (void)beforeEach { [tester setDebugModel]; } - (void)afterEach { [tester clearParams]; } - (void)testNameedTask { [tester enterText:@"myTask" intoViewWithAccessibilityLabel:@"Task Name Input"]; [tester enterWorktime:10 Breaktime:4 Repetitions:5]; [tester tapViewWithAccessibilityLabel:@"Start Working"]; [tester waitForViewWithAccessibilityLabel:@"myTask"]; [tester waitForViewWithAccessibilityLabel:@"Start Working"]; } - (void)testnoNameTask { [tester enterWorktime:10 Breaktime:4 Repetitions:5]; [tester tapViewWithAccessibilityLabel:@"Start Working"]; [tester waitForViewWithAccessibilityLabel:@"myTask"]; [tester waitForViewWithAccessibilityLabel:@"Start Working"]; } - (void)testPresetTask { [tester tapViewWithAccessibilityLabel:@"Presets"]; [tester tapRowAtIndexPath:@"Classic" inTableViewWithAccessibilityIdentifier:@"Presets List"]; [tester tapViewWithAccessibilityLabel:@"Start Working"]; [tester waitForViewWithAccessibilityLabel:@"myTask"]; [tester waitForViewWithAccessibilityLabel:@"Start Working"]; } @end
                             
selenium pageObject 

<139  a.   b.   c.   test suite   test suite additions  KIF   KIF  API  Tools 
4 retry    App   case case   retry xctool   xctool  build-tests  app app 

140>2017 
run-tests  xctool  
xctool build-tests -workspace myApp.xcworkspace -scheme myKIFTestScheme -sdk iphonesimulator -configuration Debug -destination platform='iOS Simulator',OS=8.3,name='iPhone 6 Plus'
array=( TimerTests HistoryTests )
for data in ${array[@]} do
xctool -reporter pretty -reporter junit:tmp/test-report-tmp. xml -workspace myApp.xcworkspace -scheme myKIFTestScheme run-tests -only myKIFTestTarget:${data} -sdk iphonesimulator -configuration Debug -destination platform='iOS Simulator',OS=8.3,name='iPhone 6 Plus' done
KIF 
1.  UI 
  
  
  
 
 Martin Fowler   

<141
 UI    UI  
2. Jenkins  KIF  UI 
Jenkins  
Jenkins  Job  Job   salve  maven  ant  
Job  3  "  Build after other project are build" build 
 Job  UI   "  Build periodically" Job  Daily Build 

142>2017 
 "Poll SCM" Jenkins   
"Poll SCM" pull request  Job Job   pull request  daily build Job "Build periodically" daily build 
Job  xcodebuild/xctool  Job  Job  xcodebuild/xctool   XML 
Jenkins  JUnit Plugin  XML  Cobertura plugin   XML  Job   
3. KIF  Jenkins  (1) 
 UI 

<143
 Job Job  Job  app   Job  
(2)    'beijing' Failed to get text in field; instead, it was`beiji'  KIF KIF   KIFTypist.m  (NSTimeInterval) keystrokeDelay  
(3)  KIF  acknowledgeSystemAlert    acknowledgeSystemAlert  KIF   KIF  acknowledgeSystemAlert  while  

1. Automate UI Testing in iOShttps://developer.apple.com/library/tvos/documentation/ DeveloperTools/Conceptual/InstrumentsUserGuide/UIAutomation.html
2. Appium http://appium.io/slate/cn/v1.2.0/?ruby#appium 3. Frank http://www.testingwithfrank.com/ 4. KIF https://github.com/kif-framework/KIF 5. iOS UI Testing with KIFhttp://www.raywenderlich.com/61419/ios-ui-testing-with-kif 6. The current state of iOS automated functional testinghttp://watirmelon.
com/2013/11/04/the-current-state-of-ios-automated-functional-testing/ 7. Page Objecthttp://martinfowler.com/bliki/PageObject.html 8. Test Pyramidhttp://martinfowler.com/bliki/TestPyramid.html

144>2017 
9. Continuous Integrationhttp://www.martinfowler.com/articles/continuousIntegration. html
10. xcodebuildhttps://developer.apple.com/library/mac/documentation/Darwin/ Reference/ManPages/man1/xcodebuild.1.html
11. xctoolhttps://github.com/facebook/xctool 12. Jenkins https://wiki.jenkins-ci.org/display/JENKINS/Home 13. JUnit Pluginhttps://wiki.jenkins-ci.org/display/JENKINS/JUnit+Plugin 14. Cobertura pluginhttps://wiki.jenkins-ci.org/display/JENKINS/Cobertura+Plugin 15. Xcode 7 UI Testinghttps://developer.apple.com/videos/play/wwdc2015/406/

Android 


<145

 Android " "   CPU/GPU  
  Android 6.0
 App 
 App  API   Android   PNG XML/Java


   Bitmap
  Bitmap 
 

146>2017   3D   GPU 
 
CPU  GPU 
CPUCentral Processing Unit GPUGraphics Processing Unit "" GPU
 CPU  GPU    Control  CPU 
   ALUArithmetic Logic Unit
   Cache  DRAM  RAM
 CPU  ALU  CPU    8086   16  1~3 

<147
   CPU 
   CPU FPU
  CPU  100  CPU 
   CPU GPU 
GPU  ALUGPU  ALU     CPU   GPU  GPU 
 GPU   GPU 

 
 AB C  ABC  32  CPU   32  0  1
 Clock  A  B  C

148>2017 
 8   CPU  for   7    clock   8  A1~B4      

<149
GPU 
 1GPU   GPU  1  

150>2017 
Android 
 Android  View   OpenGL ES Android 6.0  Java  View 
DisplayList
DisplayList   Canvas  drawXxx() 
Canvas(Java API) --> OpenGL(C/C++ Lib) -->  --> GPU
 Android 4.1 DisplayList  View   ScaleAlphaTranslate GPU  DisplayList
RenderNode
 RenderNode  DisplayList RenderNode  View View  View  DisplayList

<151

152>2017 
Android Android 6.0
 View  
  ViewRootImpl.performTraversals  PhoneWindow.DecroView. drawChild  View   Canvas                           Canvas  Canvas.class    DisplayListCanvas.class      isHardwareAccelerated()          falsetrue View 
 View   draw(canvas,parent,drawingTime) - draw(canvas) onDraw - dispachDraw - drawChild  Draw   Canvas.drawXxx()   DisplayList
 View   updateDisplayListIfDirty - dispatchGetDisplayList - recreateChildDisplayList          DisplayList                  View          DisplayList  DisplayList  View
Android 6.0  DisplayList  API "@hide"         draw        DisplayList        
ThreadedRenderer.nSyncAndDrawFrame()  GPU  DisplayList 

<153

154>2017 
 VS Android 6.0

  1  View  Draw  Draw  DisplayList GPU 
  2 TextView  Layout  TextView  TextView   View  View   View  draw(canvas,parent,drawingTime)    View  TextView   DisplayList Draw  View  DisplayList  GPU 
  3   DisplayList  DisplayList  

<155
  4                 RenderNode         invalidate View  View  Alpha   onSetAlpha()  true
public class View { // ... public void setAlpha(@FloatRange(from=0.0, to=1.0) float alpha) { ensureTransformationInfo(); if (mTransformationInfo.mAlpha != alpha) { mTransformationInfo.mAlpha = alpha; if (onSetAlpha((int) (alpha * 255))) { // ... invalidate(true); } else { // ... mRenderNode.setAlpha(getFinalAlpha()); // ... } } }
protected boolean onSetAlpha(int alpha) { return false;
} // ... }


     View  clipChildren    true    View       View  clipChildren  false View  View 
  View  invalidate layout    View PFLAG_DIRTY View   PFLAG_DIRTY_OPAQUE draw(canvas)   View 

156>2017 
  View View  PFLAG_DIRTY  clipChildren  true  ViewRoot  Rect  View  View  View  View  View   clipChildren  false ViewGroup.invalidateChildInParent()  View  


 CPU  GPU  ALU  
 DisplayList  CPU  DisplayList
GPU  DisplayList  CPU 
DisplayList                 DisplayList          Shape  Bitmap 

1. GPU-- 2. ""GPU  3. Matlab  GPU  4.  CPU  5. CPU  6.  7. Android  UI  Display List  8. Android  UI  Display List  9. Android Choreographer  10. Android Project Butter 

<157
 Android  Walle

 Android 7.0Nougat APK Signature Scheme v2  Android -- 
 APK Signature Scheme v2  
 APK Signature Scheme v2
Android 7.0Nougat APK Signature Scheme v2                                APK Android Gradle 2.2.0  APK Signature Scheme v2 
   APK Signature Scheme v2  build.gradle  v2SigningEnabled false  
android { ... defaultConfig { ... } signingConfigs { release { storeFile file("myreleasekey.keystore") storePassword "password" keyAlias "MyReleaseKey" keyPassword "password" v2SigningEnabled false } }
}

158>2017   Android 7.0
Nougat  
 
 ZIP  Central Directory   APK Signing Block  ZIP   APK 
 APKZIP  1. Contents of ZIP entriesfrom offset 0 until the start of APK Signing
Block 2. APK Signing Block 3. ZIP Central Directory 4. ZIP End of Central Directory
 2APK Signing Block 1Contents of ZIP entries 3ZIP Central Directory 4 ZIP End of Central Directory 134 
 META-INF 

<159
 META-INF    META-INF  META-INF  134  
Failure [INSTALL_PARSE_FAILED_NO_CERTIFICATES: Failed to collect certificates from base.apk: META-INF/CERT.SF indicates base.apk is signed using APK Signature Scheme v2, but no such signature was found. Signature stripped?]
 APK  ZIP Comment 
  APKTool   Flavor  BuildType  
  900  3  
  2----Block
 APK Signature Scheme v2 Block
 APK  134   2APK Signing Block 2APK Signing Block 2 

160>2017 
  2  APK Signing Block 2   8   APK Sig Block 42+  ID-value
 ID-value 8  4  ID V2  ID0x7109871a ID-value   ID-value  ID-value 
 

<161



1.  APK Signing Block 
2.  APK Signing Block 

 Android   Android  ID-value 

public static ByteBuffer findApkSignatureSchemeV2Block(

ByteBuffer apkSigningBlock,

Result result) throws SignatureNotFoundException {

checkByteOrderLittleEndian(apkSigningBlock);

// FORMAT:

// OFFSET

DATA TYPE DESCRIPTION

// * @+0 bytes uint64: size in bytes (excluding this field)

// * @+8 bytes pairs

// * @-24 bytes uint64: size in bytes (same as the one above)

// * @-16 bytes uint128: magic

ByteBuffer pairs = sliceFromTo(apkSigningBlock, 8, apkSigningBlock.

capacity() - 24);

int entryCount = 0; while (pairs.hasRemaining()) {
entryCount++; if (pairs.remaining() < 8) {
throw new SignatureNotFoundException( "Insufficient data to read size of APK Signing
Block entry #" + entryCount); } long lenLong = pairs.getLong(); if ((lenLong < 4) || (lenLong > Integer.MAX_VALUE)) { throw new SignatureNotFoundException( "APK Signing Block entry #" + entryCount + " size out of range: " + lenLong); } int len = (int) lenLong; int nextEntryPos = pairs.position() + len; if (len > pairs.remaining()) { throw new SignatureNotFoundException( "APK Signing Block entry #" + entryCount + " size
out of range: " + len

162>2017 
+ ", available: " + pairs.remaining()); } int id = pairs.getInt(); if (id == APK_SIGNATURE_SCHEME_V2_BLOCK_ID) {
return getByteBuffer(pairs, len - 4); } result.addWarning(Issue.APK_SIG_BLOCK_UNKNOWN_ENTRY_ID, id); pairs.position(nextEntryPos); }
throw new SignatureNotFoundException( "No APK Signature Scheme v2 block in APK Signing Block");
}
             if (id == APK_SIGNATURE_SCHEME_V2_ BLOCK_ID) {return getByteBuffer(pairs, len - 4);}    Android      ID  APK_SIGNATURE_SCHEME_V2_BLOCK_ID = 0x7109871a  ID-value APK Signature Scheme v2 Block  ID-value 
 APK Signature Scheme v2  ID 
 ID-value  
   ID-value           ZIP       APK Signing Block   APK  ID-value 
public void writeApkSigningBlock(DataOutput dataOutput) { long length = 24; for (int index = 0; index < payloads.size(); ++index) { ApkSigningPayload payload = payloads.get(index); byte[] bytes = payload.getByteBuffer(); length += 12 + bytes.length; }
ByteBuffer byteBuffer = ByteBuffer.allocate(Long.BYTES);

<163
byteBuffer.order(ByteOrder.LITTLE_ENDIAN); byteBuffer.putLong(length); dataOutput.write(byteBuffer.array());
for (int index = 0; index < payloads.size(); ++index) { ApkSigningPayload payload = payloads.get(index); byte[] bytes = payload.getByteBuffer();
byteBuffer = ByteBuffer.allocate(Integer.BYTES); byteBuffer.order(ByteOrder.LITTLE_ENDIAN); byteBuffer.putInt(payload.getId()); dataOutput.write(byteBuffer.array());
dataOutput.write(bytes); } ... }

 
1.  APK  ID-value  ID  value APK 
2.  APK  ID-value 
3.  App  ZIP  EOCD(End of central directory)Central directory  ZIP   ID-value 
 ZIP  APK Signing Block    Java  Groovy  

164>2017 
1.  ID-value  Java  2. Gradle  Android  3.  ID-value  Java  4.  com.android.application  AAR
 APK APK  ID-value  30M  APK  100   
 Walle Github https:// github.com/Meituan-Dianping/walle IssuePRStar  APK Signature Scheme V2  

  ID-value ID-value  
 
          https://source.android.com/security/apksigning/ v2.html

1. APK Signature Scheme v2 2. ApkSigner  3. apksig  4. ZIP Format

<165

  C  H5   App   App  PV 
   ThunderJS 

166>2017  Build Service 
 
ThunderJS CMD   ThunderJS  Build Service  C  
 ThunderJSThunderJS   ThunderJS  Build Service  


ThunderJS 

<167

ThunderJS  JS  LocalStorage   Diff   Patch  LocalStorage  

168>2017 

 1.  2.  3.  LocalStorage 
Diff   Patch Diff 
 Diff   Web   Web 
 JSON Patch Diff  



[ 'cmp/util.js', [0, 33], 'mn', [34, 10]
]

//  //  //  // 

 0  33  mn 34  10 
Patch Diff  
Build Service 
Build Service   CDN

<169
 CDN   CDN

 O(N^2) Build Service  Myers   O(N^2)  O(ND) Web D  Myers   O(N)

 99%  95%

PV  2017  4   30  Build Service  3s   50%

170>2017 
Build Service 

Build Service    Build Service  Build Service Mixer  Mixer  
Mixer  

Mixer   Mixer  100%  50 

Myers   O(N^2)Mixer 

<171
Node  
  Mixer  CPU   Mixer   PM2  Mixer  Mixer 

ThunderJS 

  
 Mixer  Mixer    10  30   3  10  Mixer  
 
Mixer  
 ThunderJS  createElement  

172>2017 
  createElement  XHR  LocalStorage
   WiFi4G3G2Gunknown 2G  unknown  10.35%    

<173
  50%+ 

 Mixer CLOSE_WAIT  CLOSE_WAIT   Mixer 
 Myers   
Mixer  100%    Mixer  
 
Build Serivce 
Build Service Brain  Brain 

174>2017 
Brain  MySQL  trace  trace  Brain Brain   Brain   
Brain Mixer  99.99% TP90 5800 ms  90 msBrain   10W+ Diff  50%

 ThunderJS  BuildService   3% 

<175
  Build Service  
 ThunderJS   Git  CommitId   ThunderJS CommitId  Hash  Git   Hash  

176>2017   5  5 
 1.5% 10  1.1% 
 

ThunderJS 
 90% 10%  WiFi  49.37GB 33.41GB  C  

Android 


<177


  
Bad-Case
 bug

 onDestory  receiver   bug 
 Android  Android 

178>2017 
 
 

     


 Git  pull request  
1.  2.  3.  merge  merge  commit 


<179

  Java  A    merge  commit 
 B 
  

 
 Android Studio  JDT-View  

180>2017 
 Eclipse  JDT  JDT 
    JDT 
 Java   AB MD5MD5  
 JDT  ASM   ASM  JDT  Lambda  ClassName  ClassName  ClassName  RetroLambda ClassName 
 ...$Index  ...$InnerClassName  RetroLambda ...$$Lambda$Index
 JDT  Java 
 visit(MethodDeclaration method)  visit(AnonymousDeclaration method)  endVisit(AnonymousDeclaration method)  visit(TypeDeclaration node)  endVisit(TypeDeclaration node)  visit(LambdaExpress node) Lambda 
  ClassName 

<181

 MethodInfo  

public String className;//hash package

public String md5;

public String methodName;

public List<String> paramList = new ArrayList<>();

public String methodBody; public boolean isLambda;

//  Lambda 

public int lambdaNumInClass; 1  .

//  Class  lambda  . 

public int totalLambdaInClass; //  Class  lambda 

public String lambdaParent;

//lambda 

public boolean isLambdaInAnonymous; //  lambda  public boolean isAnonymousClass; // 


 JaCoCo JaCoCo 
JaCoCo 
JaCoCo C0 coverage C1 coverage 

182>2017         

JaCoCo JaCoCo  
 Byte CodeByte Code  Offline  On-TheFly 
 Offline Class  
 On-The-FlyJVM   -javaagent      Jar    Instrumentation  ClassLoader  class   class  class  JVM  
On-The-Fly  JVM 

<183  Offline 
Offline  1.  2.  3.  class  


184>2017 
JaCoCo  ASM  Probe 
 BOOL true false 

 Probe Insertion Strategy

 JaCoCo 
JaCoCo 
ClassProbesAdapter ASM 
 visitMethod  visitMethod  ClassProbeVisitor 
visitMethod  MethodInstrumenter 
@Override public final MethodVisitor visitMethod(final int access, final String name,
final String desc, final String signature, final String[] exceptions) {
final MethodProbesVisitor methodProbes; final MethodProbesVisitor mv = cv.visitMethod(access, name, desc,
signature, exceptions); if (mv == null) {
methodProbes = EMPTY_METHOD_PROBES_VISITOR; } else {
methodProbes = mv; } return new MethodSanitizer(null, access, name, desc, signature,
exceptions) { @Override public void visitEnd() {
super.visitEnd(); LabelFlowAnalyzer.markLabels(this); final MethodProbesAdapter probesAdapter = new MethodProbesAdapter(
methodProbes, ClassProbesAdapter.this); if (trackFrames) {
final AnalyzerAdapter analyzer = new AnalyzerAdapter( ClassProbesAdapter.this.name, access, name, desc, probesAdapter);
probesAdapter.setAnalyzer(analyzer); this.accept(analyzer); } else { this.accept(probesAdapter);

<185
} } }; }
 JaCoCo  ClassIn-
strumenter  ClassProbesAdapter visitMethod 

@Override public final MethodVisitor visitMethod(final int access, final String name,
final String desc, final String signature, final String[] exceptions) {
if (Utils.shoudHackMethod(name,desc,signature,changedMethods,cv. getClassName())) {
... } else {
return cv.getCv().visitMethod(access, name, desc, signature, exceptions);
} }

 Analyzer

@Override public void analyzeClass(final ClassReader reader) {
if (Utils.shoudHackMethod(reader.getClassName(),changedMethods)) { ...
} }
 ReportClassProbesAdapter
@Override public final MethodVisitor visitMethod(final int access, final String name,
final String desc, final String signature, final String[] exceptions) {
if (Utils.shoudHackMethod(name, desc, signature, changedMethods, this.className)) {
...

186>2017 
} else { return null;
} }
                       commit     FoodPoiDetailActivity  onCreate  initCustomTitle  

<187
JDT vs ASM

 JDT  ASM  classNamemethodName
paramList 
public static boolean shoudHackMethod(String methodName, String desc, String signature, HashSet<MethodInfo> changedMethods, String className) {
Map<String, List<String>> changedLambdaMethods = getChangedLambdaMethods(changedMethods);
List<String> changedLambdaMethodNames = changedLambdaMethods. get(className.replace(" /", "."));
updateLambdaNum(methodName, className); int indexMethods = 0; outer: for (; indexMethods < changedMethods.size(); indexMethods++) {
MethodInfo methodInfo = changedMethods[indexMethods] if (methodInfo.className.replace(".","/").equals(className)) {
if (methodName.startsWith(`lambda$') && methodInfo.isLambda && changedLambdaMethodNames != null &&
changedLambdaMethodNames.size() > 0) { //  if (methodInfo.methodName.equals(methodName)) { changedLambdaMethodNames.remove(methodInfo.
methodName) return true;
} else if (!changedLambdaMethodNames. contains(methodName)) {
//  ,  lambda  ,  
int lastIndex = methodInfo.methodName. lastIndexOf(`$');
if (lastIndex <= 0) { continue;
} String tmpMethodName = methodInfo.methodName. substring(0, lastIndex); if (tmpMethodName.equals(sAsmMethodInfo.methodName)
&& (methodInfo.lambdaNumInClass == (methodInfo.totalLambdaInClass - sAsmMethodInfo.lambdaNumInClass + 1) || judgeSoleLambda(changedMethods, methodInfo, methodName, className. replace("/",".")))) {
changedLambdaMethodNames.remove(methodInfo. methodName)
return true; }

188>2017 

}

} else {

if (methodInfo.methodName.equals(methodName) || (!methodInfo.methodBody.trim().equals("{}") &&
methodName.equals("<init>") && methodInfo.methodName.equals(methodInfo. className.split("\\.|\\\$")[methodInfo.className.split("\\.|\\\$").

length - 1]))) {

if (signature == null) signature = desc;

TraceSignatureVisitor v = new

TraceSignatureVisitor(0);

new SignatureReader(signature).accept(v);

String declaration = v.getDeclaration(); int rightBrace = declaration.indexOf("("); int leftBrace = declaration.lastIndexOf(")");

if (rightBrace > 0 && leftBrace > rightBrace) { // 

declaration = declaration.substring(rightBrace +

1, leftBrace);

"");

} //  \\[\\]  ,  String paraStr = declaration.replaceAll("[(){}]",

if (paraStr.length() > 0) {

String[] parasArray = getAsmMethodParams(paraStr. split(","), className, methodInfo.paramList);

List<String> paramListAst =

getAstMethodParams(methodInfo.paramList);

if (parasArray.length == paramListAst.size()) {

for (int i = 0; i < paramListAst.size(); i++)

{ //  < > . 

String[] methodInfoParamArray = paramListAst.get(i).split("<|>|\\.");

for (String param : methodInfoParamArray)

{

if (!parasArray[i].contains(param) ||

(parasArray[i]. contains(param) && parasArray[i].contains("[]") && !param. endsWith("[]"))) {
//  ,   (   ,  class  ,  )  outer  

continue outer;

}

}

}

} else {

continue;

}

<189

!= null) {
methodName)
} } } } return false; }

} if (methodInfo.isLambda && changedLambdaMethodNames
changedLambdaMethodNames.remove(methodInfo.
} return true;



 Gradle   DEX  Debug 

 JaCoCo  
org.jacoco.agent.rt.RT.getAgent().getExecutionData(false)
 
  onDestory      task 
 

190>2017   JaCoCo  mergeTask  ClassId  merge JaCoCo  ClassId  merge  probe 
 Pre-Push 
 apply   Pre-Push  .git  push   95%

 Gradle   push   95% abort 


<191

    

1. JaCoCo-Source-Code 2. Java  JaCoCo- 

 Android 2013  7  App  2015   2016 

192>2017 



 App   
 App      [1] [2]    QA 
 
[1] smoke testing     [2] 

Android  iOS  

<193
       
  /    TDD[3]     BDD[4]    
 Android  iOS  App 
[3] Test-driven development TDD      [4] Behavior-driven development BDD  

 Calabash  BDD 

194>2017 
  test case 
Scenario:  Then I press "" When I press view with id"city" Then I see "" When I press "" And I press view with id"start_search" When I enter "" into input field number 1 Then I press list item number 1 Then I see "" When I press "" ...
  FeatureScenarioStep  BDD  
 Feature  Scenario case
 test case  Step
 Calabash   ID  UI   
 Android  iOS  iOS  Calabash  Android   apk  iOS   iOS   App  iOS  ID  iOS  ID 

<195
 xib  ID  iOS  ID Calabash  ID 
 Android                           AndroidiOSQA                         Calabash

    Calabash                QA    Appium  Appium   QA  
Calabash  BDD   Appium  Calabash   Calabash 

Calabash  BDD   Cucumber
 Calabash  Cucumber BDD  Appium  Cucumber 
 Appium Appium   Cucumber  

 QA  QA  App  Calabash 

196>2017  
 App  common_steps. rb  cucumber.yml  Android  iOS 
# config/cucumber.yml ##YAML Template --ios: IDEVICENAME='ios' android: IDEVICENAME='android'
  Android/config  iOS/config  Android  iOS           support  Appium 
 env.rb 

<197

class AppiumWorld end
if ENV[`IDEVICENAME']=='android' caps = Appium.load_appium_txt file: File.expand_path("./../android/
appium.txt", __FILE__), verbose: true elsif ENV[`IDEVICENAME']=='ios'
caps = Appium.load_appium_txt file: File.expand_path("./../ios/ appium.txt", __FILE__), verbose: true else
caps = Appium.load_appium_txt file: File.expand_path(`./', __FILE__), verbose: true end Appium::Driver.new(caps) Appium.promote_appium_methods AppiumWorld
World do AppiumWorld.new
end

 cucumber -p android/ios Cucumber  Calabash 
 Calabash  Calabash  Steps   FeatureScenarioStep  Calabash   Steps  appium_lib Steps selenium-cucumber 
 testdata.rb  


gem ` appium_lib',

`~> 9.4.2'

gem ` rest-client',

`~> 2.0.2'

gem ` rspec',

`~> 3.5.0'

gem ` cucumber',

`~> 2.4.0'

gem`rspec-expectations',`~> 3.5.0'

gem ` spec',

`~> 5.3.4'

gem`selenium-cucumber', `~> 3.1.5'



198>2017 


 RD  QA   QA  

 Appium Calabash  ID QA  Appium   Webview   Calabash  Webview  Native Appium  
iOS 
 Android  iOS Android  apk iOS  ipa  Calabash  iOS  

 Steps  App  iOS  ID   Appium  IDclassnameXPath   XPath 
 XPath
Then I press view with xpath"//android.widget.LinearLayout[1] /android.widget.FrameLayout[1]/android.widget.LinearLayout[1]

<199
/android.widget.FrameLayout[1]/android.widget.LinearLayout[2] /android.widget.FrameLayout[1]/android.widget.ListView[1] /android.widget.LinearLayout[1]/android.widget.LinearLayout[1]"
 XPath  Appium-inspector  XPath  

 Calabash  Steps   Calabash  Appium BDD 
Calabash  homepage 
 homepage 

200>2017 

 Jenkins
Cucumber  --format html --out reports.html --format pretty HTML  JSON 
 Jenkins  


<201

 
Calabash 
 Calabash  


202>2017 
  7 
 30   Scenario 
 +  20  QA   

 scroll or swipe 
   UIAutomation   Android             scroll_ uiselector 
Then /^I scroll to view with text"([^\"]*)"$/ do |value| text = %Q("#{value}") args = scroll_uiselector("new UiSelector().textContains(#{text})") find_element :uiautomator, args
end
 UI    App  UIAutomation2  swipe 
swipe start_x: start_x, start_y: start_y, end_x: start_x, end_y: start_y - pixel.to_i
 Appium  v1.6.5  UIAutomation2  swipe  scroll 

<203
  UIAutomation2  Toast  UIAutomation2
Scenario   test case  Scenario  test case  Scenario  Scenario   App   App  
 
 Jenkins job  job  App  
   

1. Appium Doc 2. appium/ruby_lib docs 3. selenium-cucumber-ruby Canned Steps

 Android  Android   

204>2017 
 App  Spider


 3  1. Spider  2.  3. Spider 
Spider 
1.  API  2.  3. 



<205


 App   MOCK API  
 API 

206>2017    
 Spider  1  

App  App  Web  API ServerAPI Server  App  App   DB  App  

 Spider 

<207

 App  API "Spider " App  App  SpiderSpider   App Spider  API API   App


208>2017   App  API 
    Spider  

Spider  QA 
 


<209
Spider 
 Spider Spider  App   App  API  Spider 
 App  APP Debug   App  Spider .com   Spider  Spider 

210>2017   App  Spider  Spider 
 Spider  URLScheme  URLScheme  App 
 SpiderSpider   Spider  Spider  "" 
  Spider   MOCK 
 Spider  
 App   UI 

<211
Spider  UI  
 UI  Spider  Spider   

