VULNERABILITY EXPLOITATION IN DOCKER CONTAINER ENVIRONMENTS ANTHONY BETTINI FLAWCHECK

ABOUT ANTHONY BETTINI
Working in cybersecurity since 1996 (Netect, Bindview Team RAZOR, Guardent, Foundstone Labs, McAfee Avert Labs, Intel, Appthority, FlawCheck) Original vulnerabilities discovered in products by PGP, ISS, Symantec, McAfee, Microsoft, Apple, etc. Founded Appthority, which did static & dynamic analysis of mobile apps and was named the Most Innovative Company of the Year at RSA Conference 2012 Most recently, founded FlawCheck, the only scalable malware & vulnerability inspection platform for containers

MODERN HISTORY OF LINUX CONTAINERS CONTAINERS CONTAIN ... UNTIL THEY DON'T

CHROOT

1979

For ftpd, not security

UNCHROOT

CHROOT ESCAPE

CONTROL GROUPS

2007

CONTROL GROUPS (CGROUPS)
"Control Groups provide a mechanism for aggregating/partitioning sets of tasks, and all their future children, into hierarchical groups with specialized [behavior]." Started in 2006 as "process containers" Released in 2007 in Linux kernel 2.6.24 as control groups (due to containers being an overloaded term) Primarily authored by Google engineers for scaling out isolated workloads Basis for at least: systemd, CoreOS, Docker, lmctfy, LXC, etc. cgroups resource: https://www.kernel.org/doc/Documentation/cgroups/cgroups.txt

LXC

2008

Runs in userspace
Provides interface to all of the kernel containment features
 Kernel namespaces  Control Groups  Apparmour & SELinux  Policies
Learn more at: https://linuxcontainers.org/lxc/introduction/

2013
Solomon Hykes on "The future of Linux Containers" PyCon US 2013: https://www.youtube.com/watch?v=wW9CAH9nSLs

DOCKER VS. LXC

DOCKER BASICS

DOCKER REMOTE API EVENTS (ARCHITECTURE)

LINUX NAMESPACES

namespaces(7)

"A namespace wraps a global system resource in an abstraction that makes it appear to the processes within the namespace that they have their own isolated instance of the global resource. Changes to the global resource are visible to other processes that are members of the namespace, but are invisible to other processes. One use of namespaces is to implement containers."
Six namespaces:
1. mnt (filesystems & mount points) 2. PID (processes) 3. net (network stack) 4. UTS (hostname) 5. IPC (Linux implementation of System V IPC) 6. user (more on this later...)

USER NAMESPACES
Introduced in Linux kernel 3.8

2013

user_namespaces(7)
Docker uses kernel namespaces and does not yet fully implement user namespaces
More on namespaces (from Plan 9):
 http://www.cs.bell-labs.com/sys/doc/names.html
More on user namespaces:
 https://lwn.net/Articles/532593/

STATE OF THE UNION: CONTAINERS IN THE ENTERPRISE

JANUARY 2015
ENTERPRISES SLOW TO ADOPT CONTAINERS DUE TO CYBERSECURITY CONCERNS

JULY 2015

VULNERABILITIES & MALWARE

RECENT ENTERPRISE SURVEY BY FLAWCHECK

Vulnerabilities & Malware Policy Enforcement Isolation Auditability Network Perimeter Security

45%

42%

40%

35%

AUGUST 2015

30%

25% 20% 15% 10%

21%

16%

11%

11%

5%

0% Top Security Concern

CONTAINERS ARE EPHEMERAL

VULNERABILITIES

DOCKER INSTALLATION

| sh

DAEMON RUNS AS ROOT

DOCKER NETWORKING

ENUMERATE CONTAINERS

DOCKER NETWORKING

SHUTDOWN CONTAINER HOST

DOCKER ESCAPE (FIXED)

AFFECTED < 0.11.1

Problem stemmed from blacklisting kernel capabilities (Docker missed CAP_DAC_READ_SEARCH, allowing open_by_handle_at() to succeed)
In Docker 0.12.0, Docker switched to a whitelist model for kernel capabilities
Docker kernel capabilities whitelist:
 https://github.com/docker/docker/blob/master/daemon/execdriver/native/template/default_templ ate.go

DECOMPRESSION HIGHEST ROI ATTACK VECTOR
Docker needs to decompress (recursively) container images (and currently does this as root on the container host) ­ Docker supports at least XZ, GZ, TAR Cloud Service Providers (CSP) particularly at risk if not validating container images
T. TIIGI WORKS AT DOCKER NOW

BASH IN A DOCKER CONTAINER?
CVE-2014-6271
Present in >50% of popular containers on Docker Hub
Commonly present in most or very few of homegrown containers, dependent upon how automated builds are done in the CI/CD process automation /bin/bash typically not related to the actively running process but could be

ELASTICSEARCH

CVE-2014-3120

CVE-2014-3120 is a RCE bug in ElasticSearch (prior to 1.2.0)
Ben Hall @ Ocelot Uproar was running ElasticSearch in a Docker container and it was breached via CVE-2014-3120 (probably first publicly-admitted breach of a Docker container environment in-the-wild (ITW))
Actively exploited in the wild and MetaSploit plugin available (works against Dockerized ElasticSearch):
 https://github.com/rapid7/metasploitframework/blob/master/modules/exploits/multi/elasticsearch/script_mvel_rce.rb

TEARING APART CONTAINERS What did we find?

DOCKER HUB

Docker Hub Overall
>15,000 pre-built containers >500 million downloads >30% of containers have vulnerabilities No security inspection by Docker

Docker Hub Official Images
~100 official images (tag: latest) Blue-ribbon from Docker >90% of official images have vulnerabilities No security inspection by Docker

THANK YOU
ANTHONY BETTINI ABETTINI@FLAWCHECK.COM

