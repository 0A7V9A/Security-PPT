[Pwn2Own 2016] Flash Player

@

About Us
Tencent 


ØFlash -  - object - 
ØFlash -  - object - CFG
ØFlash - GCHeap -  FiexedMalloc/GCAlloc/GCLargeAlloc
Ø -  -  - CFG

Tencent 

Flash ­ 
GCHeap
-GCHeapActionScript -GCHeap -
Tencent 

Flash ­ 
3
-
Tencent 

Flash ­ object
Vector/Array/ByteArray/...
 
Tencent 

Flash ­ object
Vector.<uint>

 

Tencent 

Flash 
Tencent 



Tencent 


Tencent 

 - 

-1---> 8 -3--->9
Tencent 

 - 

-  - 
Tencent 

 - object
Security Cookie
-object - -GCHeap -flash.ocx.data
Tencent 

 - object
ByteArray
Tencent 

 - object
Vector
-vector objectlength -vector datalength
Tencent 

 - CFG(Control Flow Guard)

Tencent 


Tencent 

Flash -GCHeap 



Memory type Managed memory
Unmanaged memory
System memory





GCGarbage Collect Managed object  ScriptObjects

Flash 

Unmanaged object Bitmap DataVideo Data Sound Data...

GCHeap GCHeap memory 

Tencent 

Flash - GCHeap
Tencent 

Flash - GCHeap
Tencent 

Flash -FreeList
Tencent 

Flash - GCHeap
GCHeapHeapBlock
1. freeList[30] 2. Regionuncommitted 3. Region
Tencent 

Flash - FixedMalloc
Tencent 

Flash - GCAlloc
Tencent 

Flash - GCLargeAlloc
Tencent 

 - 
FixedBlockfirstFree
FixedBlockfirstFreeGCHeap_3
Tencent 

 - 





 

GCHeap_0 GCHeap_1 GCHeap_2

ScriptObjectStringArrayetc buffer object of ByteArray data of Arraydata of Vector.<Object>

GCHeap_3 GCHeap_4

data of Vector.<int>data of ByteArray data of Stringdata of loaderdata of BitmapData

Tencent 

 - 
  ObjectA
ObjectA  ObjectA
ObjectA 
Tencent 

 - 
Tencent 

 - 

1. 2000Object A 2. HeapBlock Area 3. 1000Object A
Tencent 

 - CFG
CFG
JIT
CFGGuard Check Function
 Zhang YunhaiByPass Control Flow Guard Comprehensively

GSSAFESEHSEHOP
Tencent 

3Adobe Flash Player
Tencent 

Q&A
Tencent 

 
Tencent 

