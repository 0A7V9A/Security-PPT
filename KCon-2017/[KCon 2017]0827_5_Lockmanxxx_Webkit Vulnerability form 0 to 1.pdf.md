KCon
Webkit Vulnerability form 0 to 1 Lockmanxxx

who

·Work for  · · ·
@weibo:Lockmanxxx @twitter:lockmanxxx


From 0 to 1

PART 01  PART 02 Why WebKit PART 03  PART 04  PART 05  PART 06  PART 07 To Do Soon


CONTENTS

01 

https://www.flexerasoftware.com/enterprise/resources/research/vulnerability-review/

Browsers
· Webkit
­ Blink(chrome)Apple Safari
· Gecko
­ Fireforx
· Trident
­ Internet Explorer
· JavaScript Engine

02 Why Webkit?


·  · "Chrome",safari, Ucbrowser, QQ Browser......
· Android+windows+linux · WebKitGTK

WebKitGtk

oMiniborwser oWebKitWebProcess oWebKitNetworkProcess oJSC
Webkitgtk
Webkit
WebCore

JavaScriptCore(jsc)

03 


+ (E=mc2)=>




· 
­ ""
· fuzz
­ "E=mc2"
·  ·  · 

04

J




WebKit parser
· Html - -DOM
· JavaScript - -------

HTML parser
Code Flow WebKitWebView WebCore::Page WebCore::FrameLoader WebCore::MainFrame WebCore::DocumentLoader WebCore::HTMLDocument WebCore::DOMWindow WebCore::HTMLDocumentParser WebCore::HTMLScriptRunner

page
Main Frame

Sub Frame

HTML parser
· HTMLàHTMLToken ()
­ https://html.spec.whatwg.org/ ­ Token
HTMLDocumentParser::pumpTokenizerLoop HTMLTokenizer::processToken
­ vector

HTML parser
· processToken

HTML parser
· HTMLTokenàDOMTree
­  HTMLTreeBuilder::processToken
· HTMLTokenàDOM Node
WebCore::HTMLConstructionSite


· HTML parser
­  ­  ­ HTML
HTML Parser L

JavaScript Parser
· JavaScript
­ ./source/JavaScriptCore/parser ­ JavaScript parser

JavaScript Parser
· 
VM,SourceCode... TreeBuilder->vector(AST tree)

Parser.cpp 

ASTBuilder.h
makeMultNode makeDivNode ...

Node.h ...

JavaScript Parser

· 

 (lexer)
(parser) (Syntax)
SourceElement ASTTree Stack Parser Class

 

JavaScript Parser

· 

Parser

ASTBuilder

Nodes.h Node

ExpressionNode StatementNode

ArrayNode VoidNode NewExprNod e ......
ForNode IfElseNode ......

JavaScript Parser
· 
source.provider()Class SourceProvider source.provider()->source()StringView

JavaScript Parser
· 
StringViewwebkit
<script>

JavaScript Parser

· Js Parser
SourceCodeParser::m_lexer
m_lexer->setCode(source, &m_parserArena);

js
<script> []; </script>
JS Parser

\n [ ] ; \n

Next()

JavaScript Parser
· Js Parser
NextJS Parser

JavaScript Parser
· Js Parser
(type)

JavaScript Parser
· Js Parser
lexJSTokenType

JavaScript Parser
· Js Parser
JSTokenTypeparser
JS"[];"JSTokenType parseArrayLiteral 

JavaScript Parser
· Js Parser


· Javascript Parser
ü  ü  ü JavaScript ü 
JavaScript Parser J



<Script>

Parser.cpp

eg: parseArrayLiteral
while (match(COMMA)) { ...... if (match(CLOSEBRACKET)) { ...... if (UNLIKELY(match(DOTDOTDOT))) { ....... while (match(COMMA)) {

Js Parser





[] [...] [,1,,1,,] [,,,,] [1,1,1]

05 



+ (E=mc2)



· JS parser
­ {0, void :*++=++%a14074,17957, void swv>><<=l%!uphs-=h213, this t, const r,3334}
­ yield !t+?=&& V={=>
­ https://bugs.webkit.org/show_bugs?id=147538
· 


· AFL is Everything! But ...... ·  · Js ·  · 

 + (E=mc2)

06 


1 2



2 weeks
++

10+Crashes
Some are interesting

3 moudles
Parser+Runtime+API

07 To Do Soon


 

QThuaensktioynou!

Thank you!

