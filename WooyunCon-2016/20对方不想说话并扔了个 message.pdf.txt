

message
By @


 
google t66ytumblr
 







  


postMessage Jsonp Cors document.domain+iframe window.name location.hash

cross-document-messaging
(Cross-document messaging) window.postMessage
 otherWindow.postMessage(message, targetOrigin, [transfer]);
 otherWindowwindowiframeother window window.parent.frames[1] message targetOriginhttp://www.wooyun.com [transfer]Channel Messaging

postMessage
Window.open Window.opener a form post
iframecontentWindow Window.frames[0] Window.parent

otherWindow.postMessage messageotherWindow

postMessage

postMessage

      

      

postMessage

postMessage onmessage  

xss    https  ......

QQ/H5/oauth/

JSSDK
https://api.weibo.com/oauth2/authorize?client_id=3063806388 &transport=html5&scope=&response_type=token&display=js&referer=http://weibo.com



http://www.wooyun.orgbugs/wooyun-20160207504

postMessageaccesstoken gsid ios iframeopenpopup blocker iosappkey cookiegsidm qqapp url



qq



 http://apis.map.qq.com/tools/geolocation?key=OB4BZD4W3U-B7VVO-4PJWW-6TKDJWPB77&referer=myapp

poc

app



*.qq.com 
url
iframebduss.src = "http://xxxxxx.qq.com/xxxxxxxxxx?url=http%3A%2F%XXX XXXXXXXXXXXXXXXindex.php%3Fcontroller%3Dclick%26 action%3Dclick%26recorddate%3D1%26mark%3D2014zms _pc_1%26url%3Dhttp%253A%252F%252Fmap.qq.com%25 2Fm%252Fcomponents%252Fgeolocation%253Fkey%253D VFUBZ-JIR3D-Z2M4H-PPAGG-G5KVQS3F2S%252526referer%253DlocationPicker";

TSRCurl
url 1url 2url

""xss




xss= postMessage+js=Cross-site scripting

httphttpsmessage......https

https://mail.qq.com/ qqjs
xss https
 

""

httpshttpjs 

event.origin

http://api.sina.com.cn/script/javascript/postmsg.html
sina.com.cnxss api.sina.com.cnajax sina.com.cnxss ......
sina.com.cnxss 
......


refererJsurlreferer window.openiframepopup blocker 
OriginindexOf("www.wooyun.org")!=-1 RegExp("^http://www.wooyun.org$")

postMessage

     

post* origin  message httpsonmessage


 postMessagejsonp+xss+csrf Chanel messageworkerh5 ............

Q&A

@



