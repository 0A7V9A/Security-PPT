#RSAC

SESSION ID: SPO2-R04
Local Malware for Local People-- The Regionalization of Malware

Dmitry Samosseiko
Director of Threat Research Sophos Inc, SophosLabs @samosseiko
Chet Wisniewski
Senior Security Advisor Sophos, Technology Office @chetwisniewski
James Wyke
Senior Threat Researcher

Malware Landscape
TARGETED ATTACKS
Limited Tailored to victim High per-victim execution cost High return on penetration

#RSAC
"TRADITIONAL" MALWARE
Omni-present Indiscriminative Low-barrier of entry, affordable Economy of scale

2

#RSAC
McDonald's Restaurants Around the World
3

#RSAC
Global Presence
4

#RSAC
Price Difference
5

#RSAC
Marketing and Advertisement

Japan
6

Saudi Arabia

#RSAC
Products
7

#RSAC
Malware Regionalization: Reasons
Financial Compatibility
Culture and local standards Language Local brands
Political and Legal
8

#RSAC
Malware Regionalization: Impact
Type and "family" prevalence Threat Exposure Rate Attack vectors Platform abuse Defenses
9

#RSAC
(Un)targeting
"Bakasoftware" Fake AV didn't execute, if one of the following was true: GetKeyboardLayout: Russia, Ukraine, Belarus, Estonia, Latvia, Lithuania,... Browser history: vkontakte.ru , google.ru and russian-speaking hacking forums
10

#RSAC
Server-side logic
https://nakedsecurity.sophos.com/2008/12/03/fakeav-promo-site-exposed/
11

#RSAC
Conficker
Filtered Ukrainian IP addresses when spreading
Conficker.A ­ downloads GeoIP DB from www.maxmind.com Conficker.B ­ embeds GeoIP DB downloads
Checked keyboard layout check during runtime
12

#RSAC
RU Screen lockers

#RSAC
Prepaid cards and cash vouchers
14

#RSAC
"Police Locker"

#RSAC
Cultural compatibility

#RSAC
Source: Google Trends

#RSAC
Ransomware + Bitcoins =

Bitcoins
Available world-wide Practically untraceable

Ransomware
Indiscriminate Openly criminal

Cryptolocker: 17,706,729.70 USD (Nov 2013)

Coincidence?
19

#RSAC
Cryptolocker search trends
Bitcoin price

#RSAC
CTB-Locker
"... customisable by the affiliate who has purchased the CTB-Locker instance, the available options have grown over time, more recently ­ English, French, German, Spanish, Latvian, Dutch and Italian."

#RSAC
TorrentLocker/Crypt0L0cker
"TorrentLocker criminals went so far as to refuse to push the Ransomware executable to victim machines whose IP addresses did not belong to the target countries."

#RSAC
TorrentLocker (Ireland)
Local currency
Local BC exchanges

#RSAC
Hot off the press (Locky demo)
23

#RSAC
Locky localization

Ransom notes obtained via encrypted C&C server connection:

id

Randomly generated number

id=66...ED5&act=gettext&lang=da

act

Action

affid

Affiliation ID

lang

Language used by computer

os

Operating system

sp

Service pack

x64

64-bit system

Languages supported: Brazilian Portuguese, Chinese, French, Japanese, Danish, German, ...

Not supported: Arabic, Czech...

24

#RSAC
Locky (un)targeting
Check system language MultiUILanguageID == 0x419 (1049 - Russian)? Terminate and delete itself
...DEMO...
25

#RSAC
Ransomware Prevalence

Cryptowall TorrentLocker CTBLocker TeslaCrypt

US, GB, CA, AU, DE and FR GB, IT, AU, ES EU and NA UK, US, CA, SG, TH

#RSAC
Geo-targeted distribution via spam

#RSAC
Geo-targeted distribution via TDS

#RSAC
Geo-targeted distribution via TDS
SutraTDS
Pic source: http://www.xylibox.com/2011/12/sutra-tds-v34.html

#RSAC
Geo-targeted delivery via Exploit Kits
CryptoWall
TeslaCrypt ...
<nothing>

#RSAC
Abuse of Geo IP services

Victim's IP address Country code

GEO IP API lookup
Indicator of compromise

#RSAC
Banking Malware

Victim

Cybercrime group

NATURALLY GEO-TARGETTED

Victim's Bank

Money mules

"Money mule" logistics Bank-specific customizations Custom web-injects

#RSAC
Vawtrak Crimeware-as-a-Service (CaaS)

/channel/{TYPE:Hb}/{PROJECT_ID:Hd}/{BOT_ID:Hd}?id={BUILD:Hw} {UPDA'TE_VER:Hw}
EXE attachment or Exploit Kit attack Connects to C&C

Injects into legitimate process

Receives configuration file

Hooks APIs to inspect network traffic

Injects code into web pages of specific URLs

Sophos paper: Vawtrak ­ International crimeware-as-a-service

#RSAC
Vawtrack web inject

#RSAC
Regional sub-botnets

/channel/{TYPE:Hb}/{PROJECT_ID:Hd}/{BOT_ID:Hd}?id=...

5

3

6

1 4

2

Target1 - German and Polish banks
Target2 ­ Japan
Target3 - USA + Australia, UK, Turkey, Slovakia, Czech Republic, India, Italy

Target4 - Saudi Arabia, UAE,

Malaysia, Portugal, Poland

3

Target5 ­ UK

Target6 - UK, Germany, Spain

#RSAC
Stats methodology
Based on "Live Protection" telemetry Mapped with Maxmind's GeoIP API Malware family recognition through dynamic analysis (sandbox) and normalized detection names
36

#RSAC
Banking Malware Targets

Z

D G

Q

Z

D
Z

Z

E
G

Dridex

US, GB

QBot

US

Yebot

HK, Japan

Br Gozi
Emotet

NA, EU, particularly Italy EU, particularly Germany

Trustezeb

DACH region

Dyreza

global, but highest in NA, EU, AU

Tinba

GB, US, CA, AU, DE

ZBot

US, GB, CA, DE, AU, IT, ES, JP

"Brazilian bankers" Brazil

ZY Y
Z

#RSAC
Global threats
Spam bots (Shapouf) Password stealers (Fareit) Downloaders (Upatre, Ruckgov)

Android Malware Monetization
Premium rate number calling and SMS

#RSAC
Ransomware

Banking Trojans

Other...

#RSAC
SMS Trojans

#RSAC
Ransomware

#RSAC
Andr/SmsThief-A (un)targeting
https://www.csis.dk/en/csis/news/4819/

#RSAC
Most exposed countries

Region
India CIS (Russia, Belarus, Kazakhstan, ...) Korea Israel China Asia (other) Eastern Europe Latin America Middle East US & Canada Africa Australia and New Zealand Western Europe Japan

% of malware reports
15.5 10.1
7.9 7.6 6.4 5.0 4.4 3.8 3.1 3.1 3.0 2.5 1.9 1.4

#RSAC
Android malware prevalence by region

Andr/Gedma Andr/Ztorg Andr/Axent Andr/DroidRt Andr/PornLock Andr/FakeIns Andr/Rootnik Andr/CNSMS Andr/Dloadr Andr/SmsSend Andr/FkDbgrd Andr/HiddenAd Andr/Sivu Andr/Ransom Andr/Ogel Andr/PornClk Andr/TowRoot Andr/Clicker Andr/SmsSpy Andr/StartApp Andr/TekWon

West US & CA MiddleEa LatAm Korea

Europe

st

Japan

Israel

16

9

7

27

21

6

5

26

20

17

3

10

7

20

19

9

8

8

6

11

10

4

8

5

4

15

12

4

1

3

1

6

2

4

4

3

2

8

8

4

2

2

9

3

9

4

4

3

6

5

17

4

3

2

4

2

9

2

1

7

4

2

2

5

5

4

3

3

4

5

4

3

14

16

1

1

1

4

4

13

2

1

4

2

4

5

9

1

4

4

3

1

1

6

3

1

1

0

1

0

9

1

1

4

3

1

0

0

0

0

4

3

India 19 11 22 15 7 22 7
4
7
4

Eastern CIS Europe

15

24

29

14

22

15

4

10

9

7

2

26

8

6

1

2

6

2

12

5

6

6

5

3

2

4

0

0

2

2

3

1

1

4

6

2

0

0

6

2

0

0

China AU/NZ Asia

Africa

26

7

13

16

20

13

3

4

31

29

13

13

9

22

18

10

6

12

9

9

4

3

6

13

13

6

1

3

10

9

5

1

3

8

5

10

17

2

4

3

3

4

2

8

3

4

12

1

8

2

4

1

4

8

8

2

1

4

8

5

3

1

3

5

4

3

1

7

0

1

3

2

2

4

2

2

4

3

4

4

1

5

2

3

1

1

2

6

5

3

1

10

1

3

2

1

0

4

6

16

1

1

#RSAC
In summary
Tip of the iceberg The trend is growing - more players are taking advantage of metadata about victims to maximize returns Commodity malware gangs have learnt from APT groups
45

#RSAC
Impact
Defenses
Analysis (geo-distributed sensors, proxies,...) Forensic is difficult 3rd party tests
User education
Their English is better! (freelance job boards?)

#RSAC
Advice
Threat awareness, user education and security measures
.. should all be targeting threats that are prevalent in your region
47

#RSAC
Questions?
@chetwisniewski @samosseiko
48

