SESSION ID: CRWD-W13
The Secrets of Malware Success on Google Play Store
#RSAC

Rowland Yu
Senior Threat Researcher SOPHOS #rowlandy

#RSAC
AGENDA
THE TAKEAWAYS GOOGLE PLAY FACTS GOOGLE PLAY SECURITY MEASURES MALWARE HISTORY ON GOOGLE PLAY
2

#RSAC
AGENDA
THE MISSION OF MALWARE THE SECRET WEAPONS OF CYBERCRIMINALS ANDROID APPLICATION PACKAGE (APK) CASE STUDIES LESSONS & CONCLUSIONS
3

#RSAC
THE TAKEAWAYS
The security measures in Google Play The social engineering techniques employed by malware A practical knowledge of how malware bypasses Google Play security
4

#RSAC
GOOGLE PLAY FACTS

#RSAC
LAUNCH AN APP ON GOOGLE PLAY
How to launch Android App on Google Play Store Register ($25 USD) Prepare and upload your App Store Listing Pricing & Distribution Publishing your App (takes up to 24 hours to go live)
6

#RSAC
NUMBER OF APPS ON GOOGLE PLAY
Number of available Apps on the Google Play
7

#RSAC
GOOGLE PLAY SECURITY MEASURES

#RSAC
GOOGLE PLAY SECURITY MEASURES
Android White Paper 2016 February
9

#RSAC
GOOGLE PLAY SECURITY MEASURES
10

#RSAC
GOOGLE PLAY SECURITY MEASURES
Two Changes to Google Play Apps Reviews From March 2015
Move to real human reviewers Introduce age-based rating system
11

#RSAC
MALWARE HISTORY ON GOOGLE PLAY

#RSAC
MALWARE HISTORY ON GOOGLE PLAY

Find and Call Carberp

Plankton

BadNews

2012-FEB

2013-FEB

DroidCleaner

FakeLookout

ZertSecurity

Android DropDialer

FakeMarket 2014-FEB

Brazilian Banker Hideicon 2015-FEB

Bumzasery BrainTest2
InstaAgent Feabme
2016-FEB

SaveMe Dubsmash

KK plugin

VirusShield

MobiDash

BrainTest TurkishClicker

DenDroid

InfectedHTML

FakeBatteryBotProSanta Claus Ngu Studios

13

#RSAC
MALWARE HISTORY ON GOOGLE PLAY
14

#RSAC
MALWARE HISTORY ON GOOGLE PLAY

Eleven

Date 2015-04-24 2015-07-06 2015-07-09 2015-07-22 2015-08-05 2015-09-21 2015-11-11 2015-11-17 2015-12-17 2016-01-06 2016-01-08

Name

Dubsmash

Fake BatteryPro

Feabme

Ngu Studio Bumzasery BrainTest

Insta Agent

KK plugin Santa Claus BrainTest2

Turkish Clicker

First Seen 2015-04-17 2015-06-17 2015-04-10 2015-07-14 2015-08-05 2015-07-28 2015-10-16 2014-09-22 2015-12-17 2015-10-01 2015-09-27

Behaviours Porn Clicker Backdoor Phishing Porn Clicker Porn Clicker Backdoor Phishing Agent Backdoor Backdoor Backdoor

Installs

100,000 - 100,000 - 501,000 - 25,000 500,000 500,000 1,005,000 50,000

27

100,000 - 100,000 - 100,000 500,000 500,000 500,000

N/A

606,000 1,335,000

500 - 1,000

~5,000,000 15

#RSAC
THE MISSION OF MALWARE

#RSAC
THE MISSION OF MALWARE
Think Like A Cybercriminal
17

#RSAC
WHAT MALWARE WANTS TO DO
SURVIVAL
18

#RSAC
WHAT MALWARE WANTS TO DO
19

#RSAC
WHAT MALWARE WANTS TO DO
20

#RSAC
THE SECRET WEAPONS OF CYBERCRIMINALS

#RSAC
THE SECRET WEAPONS OF CYBERCRIMINALS

IP Info

Timebombs

Dynamic code loading

Obfuscation/Packing

Encryption Remote payload

SURVIVAL

Behave for a while before going rogue

22

#RSAC
THE SECRET WEAPONS OF CYBERCRIMINALS
(A lot of) Games Tools
23

#RSAC
THE SECRET WEAPONS OF CYBERCRIMINALS
Social Engineering Silent mode Boundary
24

#RSAC
ANDROID APPLICATION PACKAGE (APK)

ANDROID APPLICATION PACKAGE (APK)

Blah.apk

META-INF/ MANIFEST.MF CERT_NAME.(RSA|DSA) CERT_NAME.SF

lib/ arm*/ lib*.so x86/ mips/

res/ drawable-*/ xml/ raw/ ...

*.png *.xml

assets/ *

AndroidManifest.xml

classes.dex

resources.arsc

* https://github.com/rednaga/training/tree/master/DEFCON23 26

#RSAC

#RSAC
ANDROID APPLICATION PACKAGE (APK)

Blah.apk

META-INF/ MANIFEST.MF
CERT_NAME.(RSA|DSA)
CEERTx_NtAeMnE.SsFion of ZIP / JAR
lib/ arm*/ lib*.so
x86/
maipps/plication/vnd.android.package-archive
res/ drawable-*/ *.png
xml/ *.xml
raw/
digi..t. ally signed with a certificate
assets/ *

AndroidManifest.xml
classes.dex com.package.name.apk resources.arsc unzip blah.apk

* 27

#RSAC
ANDROID APPLICATION PACKAGE (APK)

Blah.apk

META-INF/ MANIFEST.MF CERT_NAME.(RSA|DSA) CERT_NAME.SF
lib/ arm*/ lib*.so x86/ mips/

res/ drawable-*/ xml/ raw/ ...

*.png *.xml

Developerapsseuts/b*lic AndroidManifest.xml
certificatcleasseos.dfexthe APK

resources.arsc

* 28

Manifest File Text File
Signature Manifest File Text File The list of resources and SHA-1 digest of the corresponding lines in the MANIFEST.MF file

#RSAC
ANDROID APPLICATION PACKAGE (APK)

Blah.apk

META-INF/ MANIFEST.MF CERT_NAME.(RSA|DSA) CERT_NAME.SF

lib/ arm*/ lib*.so x86/
mips/

res/ drawable-*/ xml/ raw/ ...

*.png *.xml

assets/ *

AndroidManifest.xml

classes.dex

resources.arsc

* 29

Compiled shared libraries
Native ELF files
specific to a software layer of a processor

#RSAC
ANDROID APPLICATION PACKAGE (APK)

Blah.apk

META-INF/ MANIFEST.MF CERT_NAME.(RSA|DSA) CERT_NAME.SF

lib/ arm*/ lib*.so x86/ mips/

res/ drawable-*/ xml/ raw/ ...

*.png *.xml

assets/ *

AndroidManifest.xml

classes.dex

resources.arsc

* 30

Resources files
Non-compiled resources: images xml files raw binary files media files ...
May contain malicious payloads

#RSAC
ANDROID APPLICATION PACKAGE (APK)

Blah.apk

META-INF/ MANIFEST.MF CERT_NAME.(RSA|DSA) CERT_NAME.SF

lib/ arm*/ lib*.so x86/ mips/

res/ drawable-*/ xml/ raw/ ...

*.png *.xml

assets/ *

AndroidManifest.xml

classes.dex

resources.arsc

* 31

Assets files
can be retrieved by AssetManager
Another good place to hide payloads

#RSAC
ANDROID APPLICATION PACKAGE (APK)

Blah.apk

Android Manifest META-INF/ MANIFEST.MF CERT_NAME.(RSA|DSA)

Compiled binary xml CERT_NAME.SF

lib/ arm*/ lib*.so

entry points for apx8p6/

Executable Dalvik

mips/

res/ drawable-*/ *.pngcode for Dalvik

xml/ raw/

*.xmvl irtual machine

...

assets/ * AndroidManifest.xml

Precompiled resources

classes.dex resources.arsc

Random files

* 32

#RSAC
CASE STUDY ­ PHISHING

#RSAC
CASE STUDY ­ PHISHING

Report Date Name
First Seen Period

2015-07-09 Feabme
2015-04-10 90 days

2015-11-11 InstaAgent 2015-10-16
26 days

Installs 501,000 - 1,005,000 100,000 - 500,000

34

#RSAC
CASE STUDY ­ PHISHING
35

#RSAC
PHISHING TEST
36

#RSAC
PHISHING TEST
37

#RSAC
PHISHING TEST
38

#RSAC
PHISHING TEST
39

WHICH ONE IS MALICIOUS?
A
C
40

#RSAC
B D

#RSAC
PHISHING ­ FEABME

Popular Games on Google Play

Cowboy Adventure
500,000 ­ 1,000,000 installs from Google Play

Jump Chess

Images from: http://www.welivesecurity.com/2015/07/09/apps-google-play-steal-facebook-credentials/
41

#RSAC
MONOGAME FRAMEWORK
C# Based on .net framework
42

#RSAC
FEABME PAYLOAD
Main activity
Fake Facebook payload
43

#RSAC
FEABME WORKFLOW
CowboyAdventure.dll Activity1
TinkerAccountLibrary.dll Payload from remote Phishing Activity Submit to remote
44

#RSAC
FEABME WORKFLOW
CowboyAdventure.dll Activity1
TinkerAccountLibrary.dll Payload from remote Phishing Activity Submit to remote
45

#RSAC
FEABME WORKFLOW
CowboyAdventure.dll Activity1
TinkerAccountLibrary.dll Payload from remote Phishing Activity Submit to remote
46

#RSAC
FEABME WORKFLOW
CowboyAdventure.dll Activity1
TinkerAccountLibrary.dll Payload from remote Phishing Activity Submit to remote
47

#RSAC
FEABME WORKFLOW
CowboyAdventure.dll Activity1
TinkerAccountLibrary.dll Payload from remote Phishing Activity Submit to remote
48

#RSAC
CASE STUDY ­ BRAINTEST

#RSAC
CASE STUDY ­ BRAINTEST
http://blog.checkpoint.com/2015/09/21/braintest-a-new-level-of-sophistication-in-mobile-malware/
50

CASE STUDY ­ BRAINTEST

Report Date Name
First Seen Period

2015-09-21 BrainTest 2015-07-28 55 days

Installs

100,000 - 500,000

51

#RSAC
2016-01-06 BrainTest2 2015-10-01
97 days 606,000 1,335,000

#RSAC
CASE STUDY ­ BRAINTEST
IP Info Timebombs Dynamic code loading Encryption Remote payload packing/obfuscation
52

IP INFO

#RSAC
Bypass Google Bouncer via ipinfo.io

53

#RSAC
IP INFO HTTP://IPINFO.IO/JSON
{ "ip": "91.109.247.173", "hostname": "tor-exit2-readme.puckey.org", "city": "", "region": "", "country": "GB", "loc": "51.5000,-0.1300", "org": "AS13213 UK2 - Ltd"
}
54

IP INFO

#RSAC
Verify the IP doesn't belong to: 216.58.192.0 - 216.58.223.255 209.85.128.0 - 209.85.255.255 104.132.0.0 - 104.135.255.255 173.194.0.0 - 173.194.255.255
74.125.0.0 - 74.125.255.255
hostname or org doesn't contain google, android, or
1e100
55

#RSAC
FIRST TIMEBOMB
malicious flow will run every 2 hours
56

DROPPER
call DD-> d(context) to decrypt assets/start.ogg and drop it as
do.jar.
57

#RSAC
Dynamic code
a.a.a.a.b() loading via Android Reflection

#RSAC
DROPPED PAYLOAD ­ SECOND TIMEBOMB
Wait for 8 hours before running payload
58

#RSAC
BRAINTEST CONT.

#RSAC
CASE STUDY ­ BOUNDARY

#RSAC
GOOD APP? BAD APP?
High popularity Long history Multiple version of App Different Apps under the same developer Spoof Grey behaviors
61

#RSAC
FAKE BATTERYBOT PRO

Paid version

Malicious App

Free version

Legit App
62

#RSAC
FAKE BATTERYBOT PRO
Airpush Mobile Ad Network
63

#RSAC
KK PLUGIN
64

KK PLUGIN
Fake alert

#RSAC
Frequent pop-ups
http://www.cmcm.com/blog/en/security/2015-11-17/857.html
65

#RSAC
KK PLUGIN
Install app silently
66

#RSAC
KK PLUGIN
First App seen on 2013-12-09 More than 48 different Apps 100,000 - 500,000 Installs
67

#RSAC
LESSONS & CONCLUSIONS

#RSAC
LESSONS & CONCLUSIONS
Google Play
Safe? Breakable?
The secret weapons
Social engineering IPinfo Timebomb Remote payload ...
69

#RSAC
LESSONS & CONCLUSIONS
Google Play
Challenge task Developer policy Punishment
Security providers
Cooperation
Customers
Minimize your apps No more games 
70

#RSAC
ROWLAND.YU@SOPHOS.COM.AU

