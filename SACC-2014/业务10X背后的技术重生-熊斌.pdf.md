10X
 


1 
·  ·  · 
2 
·  ·  · KPI
3 SQL REVIEW in Ctrip
· SQLREVIEW · SQLREVIEW · SQLREVIEW



5  700+ DB 2000+ 
1%

WWW.CTRIP.COM 40%





·

· 

All in One



· 


· 



4DBDB 3DB 2  1DB

1 

2 

3 

4 

--

DB

·  API WSMQ







   ......

 



......









......







......







......

 











--




 

API WebserviceMQ


1 
·  ·  · 
2 
·  ·  · KPI
3 SQL REVIEW in Ctrip
· SQLREVIEW · SQLREVIEW · SQLREVIEW



 


· · ·


·DB · · ·SMS,MAIL...

DB Monitor


· · ·T-SQL ·

DB Monitor

Data Source

Monitor System

Data Analysis

CPU Disk Memory IOPS ......

ZABBIX

DB Performance / 1min

DB Performance/ 1day

DB Status

DB Monitor / 1min

DB Monitor / 1day SQLPerfmonDB

SQL Agent

Cluster

Process

Replication Mirror

DB Monitor

DB Monitor Baseline / 1day

JOB Block SQL

Master

Slave

DW

......

DB T-SQL Performance (DMV) / 5min

DB Error log DB size
Index size

Product Database

T-SQL Performance / 1min

SQLAnalysis T-SQL Performance / 1min

Table size

......

Trace Scan

TraceDB

Event Processing

DB Monitor Mail & SMS

DB Monitor Site

Maintenance Management Platform



Step 1

Step 2

Step 3

Step 4

   

 

  

 or 
1  2  3 1

SMS E-MAIL NOC



1



 1011 900CPU

4×20

   CPU    

913() 920() 927() 104()

1011() 8:00

9:00

10:00


3

2




4


DB Monitor Platform


Report

Alert
&
DB Service
&

DataBase

Server Performance


SQL

T-SQL Performance



HA Data


DBKPI

· KPI · KPI ·  · DB

CPU Disk Memory IOPS Bandwidth

QPS TPS SESSION

BLOCK TEMPDB

  DB


1 
·  ·  · 
2 
·  ·  · KPI
3 SQL REVIEW in Ctrip
· SQLREVIEW · SQLREVIEW · SQLREVIEW

SQL Review

· SQLDB

· +

SQL Review

 

SQL 36  1. Nolock  2. Join<5 3.  4. xxxxx 5. xxxxx
SQL  1. 10/min:
CPU<100ms IO<1000 2. xxxxx 3. xxxxx

· Review

SQL Review

Data Source

Review System

SQL Rules Check

Backup & Restore weekly

Execute SQL

SQL Review Database

SQL Output SQL Performance Performance Evaluation

Product Database

SQL Performance
Daily

TraceDB

SQL Performance
weekly

Productive SQL
Reevaluation

Input Report

SQL Review 

PD Code Dev PD SQL 1

PD 
PD 
7

success failed

PD DB Dev

SQL  SQL REVIEW
2


4

SQL 
6

DBA

SQL  1. Nolock  2. Join<5 3.  4. Xxxxx 5. xxxxx

SQL REVIEW  
3
DBA  SQL  SQL Review 

 T-SQL
5

SQL  1. CPU 2. IO 3.  4.  5. xxxxx

DBA  SQL

Q&A

