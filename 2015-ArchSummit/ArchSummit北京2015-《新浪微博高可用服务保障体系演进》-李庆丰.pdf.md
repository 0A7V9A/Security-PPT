ArchSummit2015

 


·  · 
       
· 








DAU

 

10000W 2015





6100W 2013 3600W 2012



2010 2009

 


 




  



SLA

:10 :T :  99.99%

DAU:1

:600 : 5min/ 100ms






2009-2010   




 

bug 

 

CMD

10

 

Bug





Bug

 



varnish

tomcat

503 svn up restart
agent
tail ­f access.log 200



Jpool

svn:url https://...... IPs 10.73.1.50,10.73.1.51
Result 10.73.1.50 is ok
10.73.1.51 is ok





dispatch


 

Jpool 

 

 


2011-2013   
 1



 

 

 





##

#Duang#

##



##



Feed





PC 

Feed API

Mysql



2012

SLA

What · Service-Level Agreement · 

Why

· Apimemcachedredis mysqlnetwork
· one request

How

· 999 · 99.9%<100ms · QPS



 

Scribe

 

kafka

Storm  



  Hbase



Dashboard DaDsahsbhobaoradrd


Dashboard

Jpool

Jpool

  Nginx  



Dispatch

Puppet master

&





totmotmoctamcottamcottamcotamctacttaottmotmcotamcottamcottamcotamctactattotmotmcotamcottamcottamcotamctactat totmotmcotamcottamcottamcotamctactat

 

MC MC MC MC

MC MC MC MC

MC MC MC MC

 MC MC MC MC

MMysMyqsylqslql MMysMyqsylqslql MMysMyqsylqslql  ReRdeRidseidsis

 




Mysql

Connector1Pool

Connector1Pool



Connector1  10s 30s 1min 3min 10min

PoolConnector1 Connector1Server

Connector1 Yes
Slowcount > 3

No

Yes

500ms

Connector1slowcount++




SLA   


2013-2014   
 2



 

 

 









·  · 



· 

 

 ·  · 

 

 ·  · 






Jpool

    



Dispatch

Puppet master

&





DNS

Nginx
Tomcat 
A



Nginx
Tomcat 
B


2015   
 <5min/





 

 

Docker

 



  

 


Svn/Git 
1/


5min/

2015

FeFeedFeeded

FeFeedFeeded

FeFeedFeeded

OtOhtOehrtehrer

OtOhtOehrtehrer

Jpool

Docker 3

Docker Registry

FeFeedFeeded

FeFeedFeeded

FeFeedFeeded

FeFeedFeeded

OtOhtOehrtehrer

Docker2015













  

  

 

  

















 · Docker  · SwarmKubernetesMesos

 

· Google10 · 12306 · DaoCloud

 · 



· AWS




Compose

JPool

 





Swarm

Roam

Machine

Pluto














LVS

SLB

 

Nginx Web RPC



Nginx Web RPC



MC/Redis



MC/Redis



Mysql/Hbase

Mysql/Hbase

2016



 

  


  SLA

Jpool



  




· 
 · 
· 
 · 
· 
 · : Scribe, WTool
· 
 · 



· 

 @Fingki_Li

