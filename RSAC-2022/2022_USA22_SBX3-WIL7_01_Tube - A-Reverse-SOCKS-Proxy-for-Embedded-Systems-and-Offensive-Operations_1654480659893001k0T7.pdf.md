#RSAC
SESSION ID: SBX3-WIL7
Tube ­ A Reverse SOCKS Proxy for Embedded Systems and Offensive Operations
Evan Anderson
Principal Technologist Randori @syndrowm

#RSAC
Disclaimer
Presentations are intended for educational purposes only and do not replace independent professional judgment. Statements of fact and opinions expressed are those of the presenters individually and, unless expressly stated to the contrary, are not the opinion or position of RSA Conference LLC or any other cosponsors. RSA Conference does not endorse or approve, and assumes no responsibility for, the content, accuracy or completeness of the information presented. Attendees should note that sessions may be audio- or video-recorded and may be published in various media, including print, audio and video formats without further notice. The presentation template and any media capture are subject to copyright protection.
©2022 RSA Conference LLC or its affiliates. The RSA Conference logo and other trademarks are proprietary. All rights reserved.
2

#RSAC
Agenda
Context Why Target Embedded Systems? Attack Scenario Tube Overview Defending Against Tube
3

Introduction

#RSAC
Evan Anderson
Founding Team & Principal Technologist, Randori
More than 15 years of experience in red teaming, vulnerability research, exploit development and is a founding member of the NCCDC Red Team. Prior to co-founding Randori, he worked at Kyrus Technologies supporting commercial and federal projects.

4

#RSAC
Let's Start With Some Context

#RSAC
Embedded System Attacks Are Not New
2017
"Somebody got into the fish tank and used it to move around into other areas of the network and sent out data... 10Gb were sent to a device in Finland" - DarkTrace
6

#RSAC
JPL Breached by RasberryPi
2019
"The attacker went undetected...for approximately 10 months...the attacker successfully accessed two of the three primary JPL networks. Accordingly, NASA...temporarily disconnected several space flightrelated systems from the JPL network.
- NASA Inspector General Report
7

Mandiant UNC3524

#RSAC
2021
"Part of the group's success...can be credited to their choice to install backdoors on appliances within victim environments that do not support security tools...The high level of operational security, low malware footprint, adept evasive skills, and large IoT botnet set this group apart"
- Mandiant
8

Techniques
­ Initial Access (?) ­ Establish C2 ­ Persist ­ Move Laterally ­ Exfil

#RSAC
Confidential

New Actors, Old Techniques
­ tsocks/proxychains ­ Metasploit ­ SSH ­ Cobalt Strike ­ socat ­ Tube

#RSAC
Confidential

#RSAC
Researchers Have Been Pointing Out For Years

Link to Talk: https://www.youtube.com/watch?v=TpYRQOA3WLc

Confidential

Folks Worth Following
https://twitter.com/michaelossmann https://twitter.com/travisgoodspeed https://twitter.com/devttys0 https://twitter.com/joegrand https://twitter.com/_MG_ https://twitter.com/mubix https://twitter.com/n00py1 https://twitter.com/sho_luv

#RSAC
Confidential

#RSAC
Why Target Embedded Systems?

#RSAC
What Are Embedded Systems?
An embedded system is a computer system--a combination of a computer processor, computer memory, and input/output peripheral devices--that has a dedicated function within a larger mechanical or electronic system.
14

#RSAC
What Are Embedded Systems?
Examples:
­ Security Cameras ­ VoIP Phones ­ Printers ­ Card Readers ­ HVAC Controllers...
15

#RSAC
Why Target Embedded Systems?
Embedded systems are just network-attached computers.
But you don't treat them like that.
16

#RSAC
Why Target Embedded Systems?
Attributes:
­ Unlikely to have EDR ­ Often setup and forgotten
Unpatched No Updates
­ Typically use default passwords ­ Contain interesting data
17

#RSAC
Why Target Embedded Systems?
An embedded system is a fantastic place to persist. Why:
­ Limited monitoring ­ Static environments ­ Access to other devices ­ Admin privileges
18

#RSAC
Attack Scenario

Example Kill Chain

Compromised System
(HOST0001)
Passive Credential Harvest

Active Directory Catalog
Stolen Credentials

contoso.com/service_account

Active Directory Analysis +
Stolen Credentials

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

20

#RSAC
Tube Overview

Example Kill Chain

Compromised System
(HOST0001)
Passive Credential Harvest

Active Directory Catalog
Stolen Credentials

contoso.com/service_account

Active Directory Analysis +
Stolen Credentials

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

22

Example Kill Chain

Compromised System
(HOST0001)
Passive Credential Harvest

Active Directory Catalog
Stolen Credentials

contoso.com/service_account

Active Directory Analysis +
Stolen Credentials

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

23

#RSAC
Tube ­ Reverse SOCKS4a Proxy
24

#RSAC
Tube ­ Reverse SOCKS4a Proxy
25

#RSAC
Tube ­ Overview
­ Reverse SOCKS proxy for use on embedded systems ­ Component of Randori's CART platform ­ Similar too existing toolsets
26

#RSAC
Tube ­ Problem We Were Solving
Operational Requirements ­ Low memory footprint ­ Cross-platform OS support ­ Small binary ­ Works without privileged access ­ Stand alone ­ Multi-protocol support
27

#RSAC
Tube ­ How We Use at Randori
What We Can Do:
­ Exfiltrate data through embedded systems ­ Gain network access and establish C2 ­ Bypass firewalls ­ Pivot across networks ­ Route traffic ­ Escalate privileges
28

#RSAC
Defending Against Embedded System Attacks

#RSAC
Defending Against Embedded System Attacks
1. Monitor your attack surface 2. Segment your networks 3. Implement default-deny 4. Know what normal looks and alert on abnormal traffic 5. Check for default credentials 6. Manage and patch your embedded devices 7. Set Honey pots / tokens
30

Monitor Your Attack Surface

Compromised System
(HOST0001)

Active Directory Catalog

contoso.com/service_account

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

31

Segment Your Network

Compromised System
(HOST0001)

Active Directory Catalog

contoso.com/service_account

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

32

Implement Default Deny

Compromised System
(HOST0001)

Active Directory Catalog

contoso.com/service_account

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

33

Know What Normal Looks Like

Compromised System
(HOST0001)

Active Directory Catalog

contoso.com/service_account

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

34

Check for Default Credentials

Compromised System
(HOST0001)

Active Directory Catalog

contoso.com/service_account

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

35

Manage & Patch Embedded Devices

Compromised System
(HOST0001)

Active Directory Catalog

contoso.com/service_account

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

36

Set Honey Pots

Compromised System
(HOST0001)

Active Directory Catalog

contoso.com/service_account

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

37

Set A Minefield for Attackers

Compromised System
(HOST0001)

Active Directory Catalog

contoso.com/service_account

Microsoft Kerberos

Microsoft Exchange (HOST0002)

#RSAC
Account Domain Credentials
obtained from HOST0003

38

#RSAC
Get Your Tube [SOCKS] On!
Visit the Randori Booths to Get Your Pair #5363 North Hall #3202 South Hall

