SESSION ID: DSO-W02
CI/CD: Top 10 Security Risks

Daniel Krivelevich
Co-Founder & CTO Cider Security @dkrivelev

Omer Gil
Head Of Research Cider Security @omer_gil

#RSAC

#RSAC
Disclaimer
Presentations are intended for educational purposes only and do not replace independent professional judgment. Statements of fact and opinions expressed are those of the presenters individually and, unless expressly stated to the contrary, are not the opinion or position of RSA Conference LLC or any other cosponsors. RSA Conference does not endorse or approve, and assumes no responsibility for, the content, accuracy or completeness of the information presented. Attendees should note that sessions may be audio- or video-recorded and may be published in various media, including print, audio and video formats without further notice. The presentation template and any media capture are subject to copyright protection.
©2022 RSA Conference LLC or its affiliates. The RSA Conference logo and other trademarks are proprietary. All rights reserved.
2

#RSAC
December 2020 ­ A Pivotal Moment
3

#RSAC
What we will talk about
1. What is CI/CD security? 2. "Top 10 CI/CD Security Risks" initiative 3. Analysis of breach anatomies 4. Takeaways

#RSAC
What is CI/CD security?

The engineering train moves faster and faster...

Shorter

time to release

Larger diversity in tech stack

Rapid adoption of

new tech

IaC

Automation

CI/CD

The Engineering Ecosystem

#RSAC
Secrets/Tokens 3rd Parties
7

The Challenge

#RSAC
Secrets/Tokens 3rd Parties
8

The Security Perspective

GitHub
Devops Repo Terraform Pulumi Jenkinsfile
Service 1 Repo Python JavaScript Jenkinsfile
Service 2 Repo Ruby JavaScript Jenkinsfile

Jenkins

Artifactory_Read_Key AWS_Access_Key_1

Pipeline 1 (CI) Build {...}
R
Test {...}

Pipeline 2 (CI + CD)

Build {...}

Test {...}

RW

Deploy{...}

Artifactory_write_key

Pipeline 3 (CD) Deploy{...}
R

AWS_Access_Key_2

#RSAC

Artifactory
Artifact 1

Artifact 2

Artifact 3

Artifact 4

ECR
Container 1

Container 2

EKS
Pod 1

Pod 2

9

#RSAC
CI/CD Security
Building visibility over the engineering ecosystem
Mapping risks and attack paths
Securing the engineering ecosystem ­ all the way from code to deployment

#RSAC
2021 - The Year of CI/CD Security
· Engineering environments have become the new attacker's turf
· A single insecure step in the CI, or insecure package import - can expose the organization to critical risks
11

#RSAC
"Top 10 CI/CD Security Risks" initiative

https://www.cidersecurity.io/ top-10-cicd-security-risks/

#RSAC

#RSAC
Top 10 CI/CD Security Risks

CICD-SEC-1
Insufficient Flow Control Mechanisms

CICD-SEC-2
Inadequate Identity and Access Management

CICD-SEC-3
Dependency Chain Abuse

CICD-SEC-4
Poisoned Pipeline Execution (PPE)

CICD-SEC-5
Insufficient PBAC (Pipeline-Based Access Controls)

CICD-SEC-6
Insufficient Credential Hygiene

CICD-SEC-7
Insecure System Configuration

CICD-SEC-8
Ungoverned Usage of 3rd Party Services

CICD-SEC-9
Improper Artifact Integrity Validation

CICD-SEC-10
Insufficient Logging and Visibility

14

Reviewers
Iftach Ian Amit CSO at Rapid7
Jonathan Claudius Director of Security Assurance at Mozilla
Michael Coates CEO & Co-Founder at Altitude Networks, Former CISO at Twitter
Jonathan Jaffe CISO at Lemonade Insurance
Adrian Ludwig Chief Trust Officer at Atlassian

Travis McPeak Head of Product Security at Databricks
Ron Peled Founder & CEO at ProtectOps, Former CISO at LivePerson
Ty Sbano CISO at Vercel
Astha Singhal Director, Information Security at Netflix
Hiroki Suezawa Security Engineer at Mercari, inc.

#RSAC
Tyler Welton Principal Security Engineer at Built Technologies, Owner at Untamed Theory Tyler Young Head of Security at Relativity Noa Ginzbursky DevOps Engineer at Cider Security Asi Greenholts Security Researcher at Cider Security
15

#RSAC
Analysis of breach anatomies

#RSAC
PHP Git infrastructure compromise
Case Study #1

PHP Git infrastructure compromise

Attacker

Gains access
1
2
Signs commit as legitimate PHP maintainer

3 Commit doesn't require
additional approval
Self-Hosted Git Server

Developers Consumers

https://news-web.php.net/php.internals/113838 https://news-web.php.net/php.internals/113842

4
Malicious PHP version distributed to consumers

#RSAC
18

#RSAC
Top 10 CI/CD Security Risks

CICD-SEC-1
Insufficient Flow Control Mechanisms

CICD-SEC-2
Inadequate Identity and Access Management

CICD-SEC-3
Dependency Chain Abuse

CICD-SEC-4
Poisoned Pipeline Execution (PPE)

CICD-SEC-5
Insufficient PBAC (Pipeline-Based Access Controls)

CICD-SEC-6
Insufficient Credential Hygiene

CICD-SEC-7
Insecure System Configuration

CICD-SEC-8
Ungoverned Usage of 3rd Party Services

CICD-SEC-9
Improper Artifact Integrity Validation

CICD-SEC-10
Insufficient Logging and Visibility

19

#RSAC
CICD-SEC-1 Insufficient Flow Control Mechanisms
Abusing CI/CD misconfigurations to single handedly push unreviewed code or artifacts down the pipeline.
· Prevention / Detection of merging unapproved code
20

#RSAC
CICD-SEC-7 Insecure System Configuration
Flaws in the security settings, configuration and hardening of the different systems across the pipeline (e.g. SCM, CI, Artifact repository).
· Self-hosted Git with insufficient security hardening
21

#RSAC
CICD-SEC-9 Improper Artifact Integrity Validation
Access to one of the systems in the CI/CD environment can push malicious code or artifacts down the pipeline, due to a lack in mechanisms for validating for the integrity of the code/artifact.
· Signed commits
22

#RSAC
CICD-SEC-10 Insufficient Logging and Visibility
Malicious activities can be carried out within the CI/CD environment without any correlating detective and investigative capabilities.
·EfosrCvseeocrmnositppoirnainolpmgbuiwasshesieetddhelataeylcelterd after new CI/CD security risks
· Partial visibility on attacker's actions
23

#RSAC
Stack Overflow breach
Case Study #2

Stack Overflow breach

Unsuccessful attempt to access GitHub
5
Uses stolen SSH Key to steal code
7

GitHub

Attacker

Obtains service

account password stored in cleartext

2

Accesses Dev tier
1

https://stackoverflow.blog/2021/01/25/a-deeperdive-into-our-may-2019-security-incident/

Dev tier

Firewall

Steals SSH key
6

3
Interactive login to TeamCity behind firewall

#RSAC
4
Insecure setting grants Admin permissions
25

#RSAC
Top 10 CI/CD Security Risks

CICD-SEC-1
Insufficient Flow Control Mechanisms

CICD-SEC-2
Inadequate Identity and Access Management

CICD-SEC-3
Dependency Chain Abuse

CICD-SEC-4
Poisoned Pipeline Execution (PPE)

CICD-SEC-5
Insufficient PBAC (Pipeline-Based Access Controls)

CICD-SEC-6
Insufficient Credential Hygiene

CICD-SEC-7
Insecure System Configuration

CICD-SEC-8
Ungoverned Usage of 3rd Party Services

CICD-SEC-9
Improper Artifact Integrity Validation

CICD-SEC-10
Insufficient Logging and Visibility

26

#RSAC
CICD-SEC-2 Inadequate Identity and Access Management
Poorly managed/governed identities ­ both human and programmatic ­ across the different systems in the engineering ecosystem.
· Inactive account not revoked · Service account logs in
interactively · Admin privileges as a base
permission
27

#RSAC
CICD-SEC-6 Insufficient Credential Hygiene
Obtaining and abusing secrets and tokens spread throughout the CI/CD ecosystem due to poor access controls, insecure secret management and overly permissive credentials.
· Static credentials stored in cleartext in the codebase, build system, and configuration files
28

Additional Risks
CICD-SEC-7
Insecure System Configuration
·· SSetlaf-thiocstcerdeSdCeMntials stored &tichnoeCdcIineleetxbeparaornstseeeetdx, ttboiuniltdhseystem, and configuration files

#RSAC
29

#RSAC
Environment variables exfiltration through Codecov
Case Study #3

#RSAC
Environment variables exfiltration through Codecov

Developer

Repo

Build { ... ... ... }
Test { ...

Pipeline

bash <(curl -s https://codecov.io/bash)
... }

2
Pipeline fetches malicious script

GCS Bucket
Compromises Codecov's cloud
1 infra and adds
malicious code to the script

https://about.codecov.io/security-update/

3
Environment variables are sent to the attacker

Attacker

31

#RSAC
Top 10 CI/CD Security Risks

CICD-SEC-1
Insufficient Flow Control Mechanisms

CICD-SEC-2
Inadequate Identity and Access Management

CICD-SEC-3
Dependency Chain Abuse

CICD-SEC-4
Poisoned Pipeline Execution (PPE)

CICD-SEC-5
Insufficient PBAC (Pipeline-Based Access Controls)

CICD-SEC-6
Insufficient Credential Hygiene

CICD-SEC-7
Insecure System Configuration

CICD-SEC-8
Ungoverned usage of 3rd Party Services

CICD-SEC-9
Improper Artifact Integrity Validation

CICD-SEC-10
Insufficient Logging and Visibility

32

#RSAC
CICD-SEC-5 Insufficient PBAC (Pipeline-Based Access Controls)
Abusing the excessive permissions/access granted to the pipeline execution nodes for moving laterally within or outside the CI/CD environment.
· Overly permissive pipeline execution environments
33

#RSAC
CICD-SEC-8 Ungoverned Usage of 3rd Party Services
Risks which rely on the extreme ease with which a 3rd party service can be granted access to resources in CI/CD systems, effectively expanding the attack surface of the organization.
· Minimal investigative capabilities around existence/permissions of Codecov
34

Additional risks

CICD-SEC-56
Insufficient Credential Hygiene

CCCICIICCDDD--S-SSEEECCC--5-190
Improper Artifact Integrity Validation

· Overly · pSetrmatisicsivceredentials stored
saveicasncroeirandecbvtlesleierbsoastanromtsreeeedx,ntbt iuniltdhseystem, and configuration files

· Integrity checks
not performed prior to executing Codecov script

CICD-SEC-10
Insufficient Logging and Visibility
· ###

#RSAC
35

#RSAC
Travis CI secrets exposure
Case Study #4

Travis CI secrets exposure

MEMBER
1
Forks public repo with encrypted secret in travis.yml

GitHub Ogranization
Public Repos Private Repos

Issues PR from fork
2
Attacker
https://travis-ci.community/t/security-bulletin/12081

#RSAC

Travis.yml

Secrets exposed to members

Travis CI

3
PR contains malicious command to expose secret

4
Secrets exposed to attackers
37

#RSAC
Top 10 CI/CD Security Risks

CICD-SEC-1
Insufficient Flow Control Mechanisms

CICD-SEC-2
Inadequate Identity and Access Management

CICD-SEC-3
Dependency Chain Abuse

CICD-SEC-4
Poisoned Pipeline Execution (PPE)

CICD-SEC-5
Insufficient PBAC (Pipeline-Based Access Controls)

CICD-SEC-6
Insufficient Credential Hygiene

CICD-SEC-7
Insecure System Configuration

CICD-SEC-8
Ungoverned Usage of 3rd Party Services

CICD-SEC-9
Improper Artifact Integrity Validation

CICD-SEC-10
Insufficient Logging and Visibility

38

#RSAC
CICD-SEC-4 Poisoned Pipeline Execution (PPE)
The ability of an attacker that has obtained access to an SCM repository, to run malicious code in the CI - despite not having access to it - by manipulating the pipeline configuration.
· Execution of a PPE attack to exfiltrate pipeline secrets
39

Additional Risks

CICD-SEC-6
Insufficient Credential Hygiene

CICD-SEC-10
Insufficient Logging and Visibility

· Secrets the · pSiptealitniec schroeudldenn'ttials stored

· Identify
potentially

###

CICD-aSEicCnc-1e0cslseartext in the · Pceormdiessbivaese, build system,
craenddenctioalnsfiguration files

vulnerable repos
· Identify an actual
breach

#RSAC
40

#RSAC
Dependency Confusion
Case Study #5

Dependency Confusion

Internal Repository

... Internal_package_one:1.0.1 Internal_package_two:1.0.3 Internal_package_three:1.0.4

Internal_package_three:1.0.4

#RSAC

Fetches the malicious package
2
Internal_package_three:8.0.1

lodash chalk ... Internal_package_three:8.0.1

1

Uploads a malicious package with the same name as an

internal package and

a higher version

https://medium.com/@alex.birsan/dependency -confusion-4a5d60fec610

Developer

Pipeline

Clients configured to fetch latest version

Attacker
42

#RSAC
Top 10 CI/CD Security Risks

CICD-SEC-1
Insufficient Flow Control Mechanisms

CICD-SEC-2
Inadequate Identity and Access Management

CICD-SEC-3
Dependency Chain Abuse

CICD-SEC-4
Poisoned Pipeline Execution (PPE)

CICD-SEC-5
Insufficient PBAC (Pipeline-Based Access Controls)

CICD-SEC-6
Insufficient Credential Hygiene

CICD-SEC-7
Insecure System Configuration

CICD-SEC-8
Ungoverned Usage of 3rd Party Services

CICD-SEC-9
Improper Artifact Integrity Validation

CICD-SEC-10
Insufficient Logging and Visibility

43

#RSAC
CICD-SEC-3 Dependency Chain Abuse
Abusing code dependency fetching configuration ­ to cause an unsuspecting client to fetch and execute a malicious package.
· Dependency confusion abuses the dependency chain by taking advantage of misconfigured package fetching processes
44

Additional Risks

CICD-SEC-5
Insufficient PBAC (PipelineBased Access Controls)

CICD-SEC-10
Insufficient Logging and Visibility

· Packages installed · aoeSinxvneedtcarceluytlxtieeipcocaenucrrtmrnteeeoidsddxsoeteivnsnientitahlsestored
codebase, build system, and configuration files

· ???

#RSAC
45

#RSAC
Takeaways

#RSAC
Apply to your day-to-day
A shift in mindset ­
­ The changes in the engineering ecosystem have reshaped our attack surface. Engineering environments, systems and processes have become a big part of our attack surface.
A different approach to AppSec ­
­ Application Security extends far beyond securing the code. We need to build an overarching security umbrella over all systems and processes all the way from code to deployment.
Comprehensive mapping of your engineering ecosystem ­
­ Security teams must develop practices and controls to allow them to continuously map the technical elements that comprise their engineering ecosystem. A full mapping of the ecosystem ­ including all 3rd party access ­ is the only way to have a true understanding of our attack surface.
Continuous analysis against the attacker's perspective ­
­ Once strong visibility over the engineering ecosystem is achieved, an analysis against the attacker's perspective ­ using the Top 10 CI/CD security risks - is required.
Build and optimize CI/CD security programs ­
­ A continuous effort to optimize CI/CD posture is required to ensure that the velocity and dynamic nature of engineering ecosystem to not increase risk.
47

#RSAC
Thank you!

