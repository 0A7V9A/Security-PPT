#RSAC
SESSION ID: TECH-M02
Securing Entry Points and Active Directory to Prevent Ransomware Attacks
Derek Melber
Chief Technology and Security Strategist Tenable @derekmelber

#RSAC
Disclaimer
Presentations are intended for educational purposes only and do not replace independent professional judgment. Statements of fact and opinions expressed are those of the presenters individually and, unless expressly stated to the contrary, are not the opinion or position of RSA Conference LLC or any other cosponsors. RSA Conference does not endorse or approve, and assumes no responsibility for, the content, accuracy or completeness of the information presented. Attendees should note that sessions may be audio- or video-recorded and may be published in various media, including print, audio and video formats without further notice. The presentation template and any media capture are subject to copyright protection.
©2022 RSA Conference LLC or its affiliates. The RSA Conference logo and other trademarks are proprietary. All rights reserved.
2

#RSAC
18%
3

#RSAC
Attackers Know AD is not Secure
FireEye Analysis of SolarWinds Attack Code
"The backdoor also determines if the system is joined to an Active Directory (AD) domain and, if so, retrieves the domain name. Execution ceases if the system is not joined to an AD domain."

#RSAC
Attackers Know AD is not Secure
FireEye Analysis of SolarWinds Attack Code
"The backdoor also determines if the system is joined to an Active Directory (AD) domain and, if so, retrieves the domain name. Execution ceases if the system is not joined to an AD domain."

#RSAC
Attackers Know AD is not Secure

FireEye Analysis of SolarWinds Attack Code
"The backdoor also determines if the system is joined to an Active Directory (AD) domain and, if so, retrieves the domain name. Execution ceases if the system is not joined to an AD domain."

MountLocker new variant:
XingLocker
"In essence, the new ransomware will query the compromised computer to see if it is joined to an Active Directory domain. If the computer is not joined to AD, the ransomware will fail and move to another device to perform the same query."

#RSAC
Attackers Know AD is not Secure

FireEye Analysis of SolarWinds Attack Code
"The backdoor also determines if the system is joined to an Active Directory (AD) domain and, if so, retrieves the domain name. Execution ceases if the system is not joined to an AD domain."

MountLocker new variant:
XingLocker
"In essence, the new ransomware will query the compromised computer to see if it is joined to an Active Directory domain. If the computer is not joined to AD, the ransomware will fail and move to another device to perform the same query."

#RSAC
Goals for Today
Attacker Tactics Makeup of an Attack Steps to Secure Active Directory
8

#RSAC
Attacker Tactics

Attacker Tactics

#RSAC
Vulnerabilities Misconfigurations Privileged accounts Password attacks Advanced attacks Persistence Backdoors
10

#RSAC
Makeup of an Attack

1 ­ Entry Points
Phishing

Vulnerability

Misconfiguration

2 ­ Post Entry Point Tactics

Lateral Movement

Obtain Local Privileges

Privilege Escalation

3 - Active Directory Attack Tactics

Enumeration of AD and all settings

Analysis of AD to find easiest target

Evading log analysis

#RSAC
Steps to Secure Active Directory

SECURE YOUR ACTIVE DIRECTORY
AND DISRUPT ATTACK PATHS

#RSAC
MITIGATE EXISTING THREATS
MAINTAIN HARDENED SECURITY

DETECT ADVANCED ATTACKS IN REAL TIME
16

#RSAC
Lateral Movement

What Attackers Do
 Mine cached credentials
 Attack passwords  Determine if mined
credentials have privileges
17

How to Protect and Deny
 Use LAPS  Don't reuse passwords  Don't use common
passwords  Strong password policy  Implement MFA

#RSAC
Enumeration ­ Obtain Privileged Accounts

What Attackers Do  Enumerate AD (read-only)  Analyze ACLs, group
members, user rights, etc.  Compare mined
credentials
18

How to Protect and Deny
 Secure privileged users  Secure service accounts  Secure computers  Clean up old settings

#RSAC
Enumeration ­ Attack Accounts

What Attackers Do
 Enumerate AD (read-only)  Discover users and
computers with misconfigurations  Exploit users and computers
19

How to Protect and Deny
 No users with SPN have privileges
 No users with delegations have privileges
 No computers with weak Kerberos delegations

#RSAC
Attack AD Users and Their Passwords

What Attackers Do  Password spraying  Password brute force
20

How to Protect and Deny  Strong password policy  Detect password
spraying  Detect brute force
P@ssw0rd!

#RSAC
Advanced Attacks ­ Persistence and Backdoors

What Attackers Do  DCSync  DCShadow  Golden Ticket  Process Injection
21

How to Protect and Deny
 DCSync detect  DCShadow detect  Golden Ticket detect  LSASS detect  SIDHistory modification  Primary Group ID
modification

#RSAC
Apply What You Have Learned Today
When you get back to work you should:
­ Verify exploitable configurations are secured
Ensure that you get alerts to any new exploitable configurations:
­ Real time automatic analysis is required ­ Alert both SOC and IT
Attack detection is essential:
­ Basic attacks: password related ­ Advanced attacks: DCSync and DCShadow ­ Vulnerability attacks: ZeroLogon and SAMAccountName
22

#RSAC

SESSION ID: TECH-M02

Thank you!

Securing Entry Points and Active Directory to Prevent Ransomware Attacks

Derek Melber
dmelber@tenable.com @derekmelber

