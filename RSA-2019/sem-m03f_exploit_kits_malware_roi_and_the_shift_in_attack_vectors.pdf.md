SESSION ID: SEM-M03F
Exploit Kits, Malware ROI and the Shift in Attack Vectors

Lior Ben-Porat
Senior Security Researcher Microsoft @lior_bp

Daniel Frank
Security Researcher F5 Networks @dani3lfrank

Christopher Elisan
Director of Intelligence Flashpoint @tophs

#RSAC

@whoarewe?

Lior Ben-Porat · Senior Security Researcher
Microsoft · WDATP group

Daniel Frank · Security Researcher
F5 Networks · F5 research team

#RSAC
Christopher Elisan · Director of Intelligence
Flashpoint · Hunt team

2

#RSAC
Agenda
The Exploit Kits market, trends and more Costs and potential revenues Shift in attack vectors Supply chain, miners and Ransomware Detection and mitigation
3

What is an exploit kit and how does it work?

#RSAC
What is an Exploit Kit?
A toolkit used to exploit client side vulnerabilities of commonly used software and the browsers who run them
Flash Java Silverlight etc. Ability to deliver any malicious payload to victim's machine Ransomware Cryptocurrency miners Banking Trojans etc. Control panel
5

#RSAC
How does it work?

Accessing the victim
Social engineering
Spam campaigns

Landing page

Exploitation Infection

Ransomware

Profiling and redirection

Vulnerable software

Cryptocurrency miners

Banking Trojans

Post infection
C&C
Control of the new bot

6

Exploit kits market in recent years

#RSAC
EK History
First one seen in 2006, sold for $20 with tech-support SaaS ~10K$ per month
Skybox Security
8

EK History
Market share in 2015 by family

#RSAC
Most affected countries in 2016

TrendMicro
9

#RSAC
2017
RIG is the most popular EK No "classic" Sundown EK anymore - Now GreenFlash Sundown Magnitude EK - Still focuses on South Korea Shift from Ransomware to cryptocurrency miners
Malwarebytes
10

#RSAC
2018
In overall less popular, and less development of new Exploit Kits RIG, Magnitude, and more sophisticated GreenFlash Sundown Grandsoft EK delivers Ursnif/Gozi banking Trojan Awakening from March 2018 due to new RCE vulnerabilities in VBScript and Flash
Malwarebytes
11

#RSAC
Use Case
Magnitude Exploit Kit Payload: Cerber Ransomware A Case from 2016
­ Why?
o No obfuscation o Profiling of the victim
12

#RSAC
Magnitude EK
13

#RSAC
Magnitude EK
14

#RSAC
Magnitude EK
15

#RSAC
Magnitude EK
16

#RSAC
Magnitude EK
17

#RSAC
Magnitude EK
18

#RSAC
Magnitude EK Panel
SpiderLabs
19

Moving away from Exploit kits

#RSAC
Moving away from EKs
21

Moving away from EKs
Rate of new vulnerabilities incorporated by exploit kit [TrendMicro]
22

#RSAC
Palo alto

#RSAC
Moving away from EKs
Why is it happening?
­ Law enforcement had successful disruptive operations ­ Several authors were persecuted by the authorities ­ Less 0-days, new ones are harder to exploits ­ Running the operation is very expensive and resource-intensive ­ New attack vectors become popular
The outcome: EKs become not profitable
23

#RSAC
Moving away from EKs
24

#RSAC
Exploit-Kits Successors

Credential phishing and brute-force attacks

Office exploits, macros, OLE

Software supply-chain attacks

25

#RSAC
Supply chain attacks
Taking advantage of the trusted relationship between software/hardware supplier and customer to install malware
­ Pre-installed malware on device storage (PC, Phones, DOK...) ­ Stolen code-signing certificate ­ Compromise of software build/update/distribution infrastructure
26

#RSAC
Coin-miner case-study
27

#RSAC
Coin-miner case-study
28

#RSAC
Coin-miner case-study
29

#RSAC
Coin-miner case-study
30

#RSAC
Coin-miner case-study
Google it...
31

#RSAC
Coin-miner case-study
Grab the installer directly from PDFescape website and analyze it During installation, a total of 9 different MSIs were downloaded and executed All of them were digitally signed by PDFescape, except for one ­ the "Asian and extended fonts pack"
32

#RSAC
Coin-miner case-study
33

#RSAC
Coin-miner case-study
34

#RSAC
Coin-miner case-study
35

#RSAC
Coin-miner case-study
36

Coin-miner case-study

#RSAC
Botnet Hash Rate:

345 * 157 = ~ $ 54,000 profit (in less than two months)
37

#RSAC
Coin-miner summary
The attack was reported to PDFescape 3rdparty vendor response: No code signing certificate was stolen The attackers were able to take advantage of the second vendor infrastructure to point the installer to their own hosting server It was also not validating the downloaded MSI files
Software partner

Target Machine

App vendor
38

Replica of software partner server

Gandcrab use case

#RSAC
GandCrab Recruitment Process
JAN, 2018
40

#RSAC
GandCrab Recruitment Process
MAR, 2018
41

GandCrab Behavior
Determines system information, usually to detect if the system is virtualized Attempts to resolve many APIs, a known technique to avoid static detection Connects to ipv4bot.whatismyipaddress.com to determine victim's IP address Executes nslookup to determine address of C2 Looks for documents. Photos, databases and other important files to encrypt Encrypts files and changes extension to .CRAB Folder where encrypted files are located contains CRAB-DECRYPT.TXT
42

#RSAC

#RSAC
The Ransom Note
43

#RSAC
Expired Ransom Note
44

#RSAC
Payment Method
45

#RSAC
24/7 Support
46

#RSAC
Try Before You Buy
47

#RSAC
Backend
48

#RSAC
Backend
49

#RSAC
Backend
50

#RSAC
Latest Report on GandCrab Profit
As of Feb 2019:
­ Statistics on the team of spammers for the week: DASH ($ 73905) + BTC ($ 182,000) = $ 255,905 of total profit
­ Statistics for the month for 1 of the teams who work on networks: DASH ($ 156800) + BTC ($ 87500) = $ 244,300 of total profit
­ And finally, the statistics of the entire affiliate program for the month : About ~ 760k unique installations DASH ( $ 860,591 )+ BTC ($ 1,990,800) = $ 2,851,391 (185,340,415 rubles)
51

Mitigation, Prevention and takeaways

#RSAC
Mitigation and Prevention
Network segmentation Least privileged principle Software whitelisting Windows 10 ­ WDAG, WDEG and secure browser Maintain secure backups Toggle anti-spam and keep macros disabled Remove unused software and browser plugins Network monitoring + EDR + Post-Breach solutions
53

#RSAC
Takeaways
Be aware of the latest trends Make sure you're always up to date Consider moving to a modern workspace - end users and infrastructure Own the tools that will help you identify, analyze and mitigate the threats
54

#RSAC
Summary
The Exploit Kits market is slowly dying New attack vectors are emerging, more cost efficient and less effort Fraudsters shift their business model Crypto miners and Ransomware make a good investment You're not doomed, you can protect yourself
55

Thank you!

