SESSION ID: HTA-W02
The Magic of Tracking Attack Campaigns using Data Science

Vicky Ray
Principal Researcher Palo Alto Networks @0xVK

#RSAC

#RSAC

#RSAC

#RSAC
Agenda
· Why Data Science? · Challenges in finding similarities in malware · Similarity analysis · Unit 42 case study · Visualizations & Jupyter Notebooks
4

#RSAC
What is Data Science?
Data Science is a field which uses scientific methods, statistics and algorithms to discern and extract insights from various types of data sets and is a critical component of Machine Learning and AI based solutions.
5

#RSAC
Data Science to me...
6

#RSAC
I am NOT a Data Scientist
But trying to use data science techniques to solve my own challenges
7

#RSAC
Unique attributes of two samples from same malware family
8

#RSAC
Similarity analysis on IDA using BinDiff
9

#RSAC
Similarity analysis on IDA using BinDiff
But this doesn't scale for large sample sets
10

#RSAC
Feature Similarity

Sample A

Sample B

#RSAC
Types of features for malware
String based features IAT PE header Instruction sequence Dynamic analysis

Jaccard Index to the rescue

#RSAC

Set A

    ,  =   
JI value range - 0 to 1 Set B
Values closer to 1 has higher similarity

#RSAC
Jaccard Index similarity value

 , 

=  = 0 to 1


Lower Similarity

Higher Similarity

0.1

0.2

0.3

0.4

0.5

0.6

0.7

0.8

0.9

1

14

Using Jaccard Index to extract similarity

Sample A

Sample B

#RSAC

  

 , 

=   

 , 

=

 

=

0

 , 

=

 

=

1

Total Attributes = 20 Common Attributes = 0 Jaccard Index = 0
Total Attributes = 10 Common Attributes = 10 Jaccard Index = 1

15

Using Jaccard Index to extract similarity

#RSAC

Sample A

    ,  =   

 , 

=

 

=

0.42

Sample B

Total Attributes = 14 Common Attributes = 6 Jaccard Index = 0.42

16

#RSAC
Case study
Implementing Jaccard-Index in real world case study and threat hunting.
17

APAC ­ A hot bed of APT activity

#RSAC

https://en.wikipedia.org/wiki/Asia-Pacific 18

#RSAC
APAC ­ A hotbed of APT activity
https://en.wikipedia.org/wiki/Territorial_disputes_in_the_South_China_Sea 19

#RSAC
OceanLotus

· OceanLotus (AKA APT32) is a threat actor group known to be one of the most sophisticated threat actors originating out of south east Asia.

· Multiple attack campaigns have been reported by number of security organizations in the last couple of years, documenting the tools and tactics used by the threat actor.

· While OceanLotus' targets are global, their operations are mostly active within

the APAC region which encompasses targeting private sectors across multiple

industries, foreign governments, activists, and dissidents connected to https://www.volexity.com/blog/2017/11/06/ocean lotus-blossoms-mass-digital-surveillance-and-

Vietnam. https://www.welivesecurity.com/2018/11/20/oceanlotus-new-watering-hole-attack-southeast-asia/

exploitation-of-asean-nations-the-media-humanrights-and-civil-society/

20

OceanLotus phishing doc file

#RSAC

21

Embedded DLL file

#RSAC

22

RAR archives used by OceanLotus

#RSAC

23

Samples in Autofocus

#RSAC

24

Steps taken to apply Jaccard-Index algorithm
Extract all suspected samples. Extract all other known OceanLotus samples (along with other malware families). Extract string features. Apply Jaccard-Index on every sample features with other samples features. Use python `networkx' library for connecting the similarities. Use python GraphViz tool to visualize the graph generated by `networkx'.

#RSAC
25

#RSAC
26

#RSAC
27

Initial campaign timeline

#RSAC

28

The "Human Element" ­ Working hours of the OceanLotus group #RSAC
29

The "Human Element" ­ Working days of the OceanLotus group #RSAC
30

#RSAC
The "Human Element" ­ Compile timestamps after publications.
NO! You ain't working 24 hours a day!
31

#RSAC
The "Human Element" ­ Manipulated timestamps
Huh! Really? So hardworking after
getting exposed?
32

#RSAC
Fractured Statue Campaign ­ Targeting US Gov Agency
33

#RSAC
The "Human element" 
34

#RSAC
Data Visualization in DataScience
35

Movies

#RSAC
36

Data from Autofocus Lenz (Reality)

#RSAC

37

Stats by malware family

#RSAC

38

#RSAC
Stats by filetype
39

#RSAC
OceanLotus malware family timelines using Matplotlib & pandas
40

#RSAC
Quick Demo
Some magic with Jupyter Notebooks..

#RSAC
Jupyter Notebook uploaded to Github
https://github.com/vicky-ray/RSAC2020-OceanLotus-JupyterNotebook
42

Learnings & future work

#RSAC

· Data Science allows us to discern insights which is otherwise difficult with traditional tools used by threat analysts & researchers.
· Learn about TTPs faster
· Explore better ways to visualize data with python libraries like pandas, matplotlib, seaborn etc.
· Essential to have a data scientist to be part of threat team, SOC etc.
· Explore more ways to extract features and apply similar algorithms-> Machine Learning

43

#RSAC
Who is the missing piece in the A team?
44

#RSAC
References & Credits
https://www.blackhat.com/docs/us-14/materials/us-14-Saxe.pdf https://www.cs.bgu.ac.il/~frankel/TechnicalReports/2017/17-05.pdf
45

#RSAC
THANK YOU!
Twitter: @0xVK
https://unit42.paloaltonetworks.com/
46

