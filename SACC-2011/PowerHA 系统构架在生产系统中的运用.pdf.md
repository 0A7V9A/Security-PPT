Advanced Technical Support ­ System p
PowerHA 

SACC2011

Advanced Technical Support ­ System p


 1995

 

­ ...

­ ...

­ ...

­ ...

­ ...

­



 

 
­ AIX UNIX  2011 ­ OracleAIX / UNIX 2010 ­ SybaseUNIXWindows  2009 ­ PowerBuilder   2001 ­ Oracle iAS 1999
SACC2011

Advanced Technical Support ­ System p

­  ­ PowerHA / HACMP ­ PowerHA / HACMP ­ PowerHA / HACMP
SACC2011

Advanced Technical Support ­ System p
PISPipeline Integrity System
  
   
 
SACC2011

Advanced Technical Support ­ System p
PISPipeline Integrity System

  
   
 

       





1 



6 

 

2 

 

 



5 

 



4

3 

SACC2011





Advanced Technical Support ­ System p
PIS 
 201141 
 4 423862700 
   ""
­ 7*24"" ­ "" ­ ""
SACC2011

Advanced Technical Support ­ System p
PIS 
SACC2011

Advanced Technical Support ­ System p
PIS 
­ IBM p · P750
­ PowerHA · PowerHA/HACMP
­ Oracle 11.2RAC · 7*24 · P&PGRIDSCANGNSASM...
SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP

­ PowerHA/HACMP
· IBM PowerHA  IBM High Availability Cluster Multiprocessing (HACMP) 
·  HACMP  IBM Power Systems Software  PowerHA for AIX V5.5  HACMP 5.4 

­ HAHigh Availability
·  · 

­ CMPmulti-processing
· cluster · .

­ PowerHA/HACMP
· (SPOF)

SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP
 Application ­ OracleSybase...
 PowerHA/HACMP ­  ­ 
 RSCT ­  ­ 
 AIX ­ 
 LVM ­ 
 TCP/IP ­ 

SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMPOracle RAC
 PowerHA
­  ­  ­ 
 Oracle11gR2
­ Grid ­ VotingDiskOCR ­ ASM
RACHACMP
SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP
 
­ 
 
­  ­ 
 
­ ... ... ­ PowerHA/HACMP
SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP
  ­ 
·  · 
­ 
· 
SACC2011

Advanced Technical Support ­ System p

­  ­ PowerHA / HACMP ­ PowerHA / HACMP ­ PowerHA / HACMP
SACC2011

Advanced Technical Support ­ System p
PowerHA / HACMP
         
­ ­  ""
 SPoF
SACC2011

Advanced Technical Support ­ System p
PowerHA / HACMP
 :
­  ­ 
   
  

SACC2011

Advanced Technical Support ­ System p
PowerHA / HACMP
   PowerHA/HACMP
Shell:
­  ­  ­  () ­  ()
   
SACC2011

Advanced Technical Support ­ System p
PowerHA / HACMP
   PowerHA/HACMP
  
­  ­ 
 :
­  ­  ­  ­ 
SACC2011

Advanced Technical Support ­ System p
PowerHA / HACMP
­  ­  (Fibre Channel ­ 
SACC2011

Advanced Technical Support ­ System p
PowerHA / HACMP
 cluster 
 PowerHA/HACMP cluster
­ Oracle10Oracle11 ­ RACDataGuardStream
 
SACC2011

Advanced Technical Support ­ System p
PowerHA / HACMPSmitty 
SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMPC-SPOC
 C-SPOCCluster-Single Point of Control HACMP  
­ users ­ file systems ­ logical volumes ­ physical volumes ­ Startstop ­ log files ­ Resource Group State ­...
SACC2011

Advanced Technical Support ­ System p

­  ­ PowerHA / HACMP ­ PowerHA / HACMP ­ PowerHA / HACMP
SACC2011

Advanced Technical Support ­ System p
PowerHA

IP 



.....39Weblogic

Oracle 11.2

Grid

p750

p750

HP EVA6400

SACC2011

Advanced Technical Support ­ System p
PowerHANFSGPFS

IP 



.....39Weblogic

p750
HP EVA6400
GPFS Oracle ArchiveLogs Oracle Backup Sets

p750
NFS Tape
SACC2011

Advanced Technical Support ­ System p
PowerHA

IP 



.....39Weblogic

p750

p750

HP EVA6400
ASMOracle Files

Backup To
SACCG2P0FS11

Advanced Technical Support ­ System p
PowerHA

 HACMP ­ IP ­ /etc/hosts ­ vg ­ 
 HACMPStandard ­ Cluster ­ Cluster ­ Cluster ­ HACMP
 HACMPExtended ­  ­ Cluster

 Grid ­ Shell Limit ­ Kernel Parameter ­ Users & Groups  ­ Disks  ­ Grid  ­ DNSVIPSCAN
 Oracle ­ 
  ­ DBCA ­ SCAN

SACC2011

Advanced Technical Support ­ System p
PowerHA
 Oracle RAC AIX PowerHA  ­ OracleAIX/UNIX 
SACC2011

Advanced Technical Support ­ System p

­  ­ PowerHA / HACMP ­ PowerHA / HACMP ­ PowerHA / HACMP
SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP
  Cluster Log Files   Cluster Daemons   Cluster:
· clstat/xclstat · check log files · check daemons by lssrc -g cluster or ps -ef · lsvg -o · ifconfig -a · netstat -in · lslpp -l cluster.*
 patches
SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP
­ /tmp/clstrmgr.debug · clstrmgrES 
­ /tmp/cspoc.log · HACMP C-SPOC 
­ /tmp/emuhacmp.out · HACMP Event  /tmp/emuhacmp.out.
­ /tmp/hacmp.out · HACMP HACMP
­ /usr/es/adm/cluster.log · HACMP 
SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP
­ I/O pacing
· I/O  I/O pacing 
­ smitty chgsys I/O pacing high-water lowwater "0"disable I/O pacinghighwater "33"low-water"24"
­ syncd 
· /sbin/rc.boot syncd 60  302010 
­ I/O I/O flush  deadman switch
SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP

­ 
·  minperm  maxperm   AIX  maxperm  
­ AIXvmominpermmaxperm
­ 
·  numperm  minperm  maxperm  lru_file_repage  1 AIX  

# vmo -p -o minperm%=3 # vmo -p -o maxperm%=90 # vmo -p -o maxclient%=90 # vmo -p -o lru_file_repage=0 # vmo -p -o strict_maxclient=1 # vmo -p -o strict_maxperm=0

-/etc/security/limits

default: fsize = -1 data = -1 core = -1

fsize_hard = -1 cpu_hard = -1 data_hard = -1 stack_hard = 65536

core_hard = -1Shell

SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP

­ 

udp_sendspace udp_recvspace tcp_sendspace tcp_recvspace rfc1323 1 sb_max 4194304 ipqmaxlen 512

65536
655360(udp_sendspace* 10) 65536
65536

­ 
 I/O pacingsyncd ­"slow"

SACC2011

Advanced Technical Support ­ System p
PowerHA/HACMP

 HACMPOracleAIXHACMP 
#iostat

Disks:

% tm_act Kbps

tps Kb_read Kb_wrtn

hdisk0

100.0 934.0 199.5

1576

292

hdisk1

100.0 1046.0 228.5

1800

292

........................

#vmo -p -o lru_file_repage=0 -o maxclient%=20 -o maxperm%=20 -o minperm%=5

# sar -d 5 2

AIX p570 3 5 00C80E6D4C00 06/09/11

System configuration: lcpu=8 drives=8

15:57:00 device %busy avque r+w/s Kbs/s avwait avserv

15:57:05 hdisk0 21

0.0

49

405

0.1

4.9

hdisk1

2

0.0

4

17

0.0

5.6

........................

SACC2011  AIX5.36.1lru_file_repage

Advanced Technical Support ­ System p
PowerHA/HACMP

 HACMPAIXIO 

864D2CE3 0226235311 P S topsvcs 864D2CE3 0213000111 P S topsvcs 864D2CE3 0213000111 P S topsvcs 864D2CE3 0213000111 P S topsvcs 12081DC6 0213000011 P S harmad 864D2CE3 0213000011 P S topsvcs DA1477B1 0203001311 P H hdisk3 DA1477B1 0203001211 P H hdisk3 C86ACB7E 0203001211 I H hdisk3 C86ACB7E 0202101811 I H hdisk2 C86ACB7E 0202101811 I H hdisk4 3C81E43F 0129235611 P U topsvcs 3C81E43F 1226000110 P U topsvcs 3C81E43F 1204235610 P U topsvcs 3C81E43F 1127235710 P U topsvcs

NIM thread blocked NIM thread blocked NIM thread blocked NIM thread blocked SOFTWARE PROGRAM ERROR NIM thread blocked REQUESTED OPERATION CANNOT BE PERFORMED REQUESTED OPERATION CANNOT BE PERFORMED ARRAY CONFIGURATION CHANGED ARRAY CONFIGURATION CHANGED ARRAY CONFIGURATION CHANGED Late in sending heartbeat Late in sending heartbeat Late in sending heartbeat Late in sending heartbeat........................
SACC2011

Advanced Technical Support ­ System p
PIS
  
 201141 
­ 7*24 ­  ­  ­  ­  ­  ­  ­ 
SACC2011

Advanced Technical Support ­ System p

­ 
· 
­ 
·  
­ 
· 
SACC2011

Advanced Technical Support ­ System p

 AIX
AIX UNIX 
SACC2011

Advanced Technical Support ­ System p

SACC2011

