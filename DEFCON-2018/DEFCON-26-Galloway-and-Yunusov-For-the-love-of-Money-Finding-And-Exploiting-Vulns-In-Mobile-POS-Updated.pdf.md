FOR THE LOVE OF MONEY
Finding and exploiting vulnerabilities in mobile point of sales systems
LEIGH-ANNE GALLOWAY & TIM YUNUSOV

Motivations

MPOS GROWTH

2010
Single vendor

2018
Four leading vendors shipping thousands of units per day

Motivations

Related Work MWR Labs "Mission mPOSsible" 2014

Related Work Mellen, Moore and Losev "Mobile Point of Scam: Attacking the Square Reader" (2015)

Research Scope

Research Scope

Research Scope

PAY PAL

SQUARE

IZETTLE

SUMUP

Research Scope
"How much security can really be embedded in a device that is free?"

Research Scope

SECONDARY FACTORS

PHONE/SERVER

DEVICE/PHONE

HARDWARE

MOBILE APP

Background

MERCHANT

ACQUIRER

CARD BRANDS

ISSUER

Background
MERCHANT

MERCHANT

MPOS PROVIDER

ACQUIRER

CARD BRANDS

ISSUER

Background

CARD RISK BY OPERATION TYPE

Chip & PIN Chip & Signature
Contactless Swiped
PAN Key Entry

Background

GLOBAL ADOPTION OF EMV - POS TERMINALS

EU EMV ACCEPTANCE
EMV enabled POS devices make up between 90-95% of POS population
90%
US EMV ACCEPTANCE
EMV enabled POS devices make up 13% of POS population and 9% of the ATM population
13%

Background

EMV CREDIT CARD ADOPTION
96% of credit cards in circulation support EMV as a protocol
96%
EMV CREDIT CARD USAGE
However less than half of all transactions are made by chip
41%

Background

EMV DEBIT CARD ADOPTION
79% of debit cards in circulation support EMV as a protocol
79%
EMV DEBIT CARD USAGE
However less than half of all transactions are made using chip
23%

Background

MPOS TIMELINE 2019

PERCENTAGE OF TRANSACTIONS

46%

52
MIL5L2IO
N

MILLIONS OF NUMBER OF UNITS

Background

SCHEMATIC OVERVIEW OF COMPONENTS

Methods & Tools

FINDINGS
SENDING ARBITRARY COMMANDS AMOUNT MODIFICATION REMOTE CODE EXECUTION HARDWARE OBSERVATIONS SECONDARY FACTORS

Methods & Tools
BLUETOOTH

Methods & Tools

CONTROLLER

HOST

BLUETOOTH PROTOCOL
SOFTWARE BT PROFILES, GATT/ATT
L2CAP
Host Controller Interface (HCI)
LINK MANAGER PROTOCOL (LMP) BASEBAND
BLUETOOTH RADIO

Methods & Tools
RFCOMM

GATT (Generic Attribute) /ATT(Attribute Protocol)

Service UUID

Characteristic UUID

Value

Methods & Tools
BLUETOOTH AS A COMMUNICATION CHANNEL

NAP

UAP

68:AA

D2

Org Unique Identifier

LAP 0D:CC:3E Unique to device

Methods & Tools

BLUETOOTH ATTACK VECTORS

Eavesdropping/MITM Manipulating characteristics

2.
MASTER
1.
SLAVE

Methods & Tools Frontline BPA 600

Ubertooth One

$20,000

$120

Methods & Tools

Findings
SENDING ARBITRARY COMMANDS

Findings

MANIPULATING CHARACTERISTICS

· Initiate a function · Display text · Turn off or on
User authentication doesn't exist in the Bluetooth protocol, it must be added by the developer at the application layer

Findings

1.

2.

3.

Findings

Findings

Findings

LEADING PART

MESSAGE

TRAILING PART

02001d06010b000000 506c656173652072656d6f76652063

010013

617264

00ff08

CRC 3c62

END 03

"Please remove card"

Findings

ATTACK VECTORS

1. Force cardholder to use a more vulnerable payment method such as mag-stripe
2. Once the first payment is complete, display "Payment declined", force cardholder to authorise additional transaction.

Findings Data: 0d0501000017010300000c00496e736572742f73776970652063617264440d0a

Findings

LEADING PART 0d0501000017

MESSAGE
010300000c00496e736572742f737769706520636172 64
"Insert/swipe card"

CRC 44

Findings
AMOUNT TAMPERING

Findings

HOW TO GET ACCESS TO TRANSACTIONS AND COMMANDS
HTTPS DEVELOPER BLUETOOTH LOGS RE OF APK ENABLE DEBUG BLUETOOTH SNIFFER

Findings
HOW TO GET ACCESS TO COMMANDS 1. 0x02ee = 7.50 USD 0x64cb = checksum

2. 0100 = 1.00 USD

0x8a = checksum

Findings

MODIFYING PAYMENT AMOUNT

1. Modified payment value

1

2. Original (lower) amount

displayed on card reader

for the customer

3. Card statement showing

2

higher authorised

transaction amount

3

Findings

MODIFYING PAYMENT AMOUNT

TYPE OF PAYMENT MAG-STRIPE CONTACTLESS
CHIP AND PIN

AMOUNT TAMPERING
TRACK2 POSSIBLE
-----

SECURITY MECHANISMS
----
AMOUNT CAN BE STORED IN
CRYPTOGRAM
AMOUNT IS STORED IN CRYPTOGRAM

LIMIT PER TRANSACTION: 50,000 USD

Findings Customer

AT TA C K

$1.00 $1.00 payment payment

50,000 payment

Fraudulent merchant Service Provider

Findings

MITIGATION ACTIONS FOR SERVICE PROVIDERS
REQUEST SOLUTION FROM VENDOR CONTROL YOUR ECOSYSTEM NO MAG-STRIPE

Findings
REMOTE CODE EXECUTION

Findings

RCE = 1 REVERSE ENGINEER + 1 FIRMWARE

@ivachyou

Findings

HOW FIRMWARE ARRIVES ON THE READER

https://frw.******.com/_prod_app_1_0_1_5.bin https://frw.******.com/_prod_app_1_0_1_5.sig

https://frw.******.com/_prod_app_1_0_1_4.bin https://frw.******.com/_prod_app_1_0_1_4.sig

Header Body

- RSA-2048 signature (0x00 - 0x100) - AES-ECB encrypted

Findings

HOW FIRMWARE ARRIVES ON THE READER

https://www.paypalobjects.com/webstatic/mobile/pph/sw_repo_app/u s/miura/m010/prod/7/M000-MPI-V1-41.tar.gz https://www.paypalobjects.com/webstatic/mobile/pph/sw_repo_app/u s/miura/m010/prod/7/M000-MPI-V1-39.tar.gz

Findings

HOW FIRMWARE ARRIVES ON THE READER

Findings

HOW FIRMWARE ARRIVES ON THE READER

RCE

Findings

INFECTED MPOS
PAYMENT ATTACKS COLLECT TRACK 2/PIN PAYMENT RESEARCH

Findings

DEVICE PERSISTENCE
REBOOT GAME OVER

Findings

AT TA C K

Device with Bluetooth
RCE

Reader

UPDATES

Service Provider

Fraudulent customer

Merchant

Findings

MITIGATIONS
NO VULNERABLE OR OUT-OF-DATE FIRMWARE NO DOWNGRADES PREVENTATIVE MONITORING

Findings

Findings

HARDWARE OBSERVATIONS

Findings
SECONDARY FACTORS
ENROLMENT PROCESS ON BOARDING CHECKS VS TRANSACTION MONITORING DIFFERENCES IN GEO ­ MSD, OFFLINE PROCESSING WHAT SHOULD BE CONSIDERED AN ACCEPTED RISK? ACCESS TO HCI LOGS/APP, LOCATION SPOOFING

:0
: (

Conclusions

Reader Square [EU]
Square [USA] Square mag-stripe
[EU + USA]

Cost reader/Fee per transaction

Enrollment process

Antifraud + Security checks

$51 1.75-2.5%

Strict ­ active monitoring of transactions

Strict ­ correlation

$50 2.5-2.75%
Free 2.5-2.75%

of "bad" readers,

Low - no anti money laundering checks but some

phones and acc info

ID checks Strict (see above)

Physical security N/A N/A Low

FW RE -

Mobile Ecosystem strict
medium (dev) low

Arbitrary commands -

Square miura [USA]

$130 2.5-2.75%

Strict (see above)

N/A

+

N/A

High - anti-money

PayPal miura

$60 1-2.75%

laundering checks + credit check (to
take out credit

Strict ­ transaction monitoring

N/A

+

low

agreement)

+ [via RCE] + [via RCE]

SumUp

$40 1.69%

Medium

-

low

+

Low ­ limited

iZettle datecs

$40 1.75%

Medium - antmoney laundering check + ID checks

monitoring, on finding suspect activity block withdrawal - acc

High

-

low

+

otherwise active

Red teaming Amount tampering

-

-

+

-

+

+ [no display]

+

+ (via RCE)

+

+ (via RCE)

+

+

-

+

Conclusions
MPOS FOR RED TEAMING
1. Carry out an assessment of reader to gather preliminary data + info from cards. 2. Use data to carry out normal transactions to obtain baseline. 3. Use info obtained during this process to identify potential weaknesses and
vulnerabilities. 4. Carry out "modified" transactions
PAYMENT PROVIDER

Conclusions
ASSESSING RISK - WHAT DOES THIS MEAN FOR YOUR BUSINESS?

: 0 : (
: |

Conclusions

Conclusions

CONCLUSIONS
RECOMMENDATIONS FOR MPOS MANUFACTURERS

Control firmware versions, encrypt & sign firmware Use Bluetooth pairing mode that provides visual confirmation of reader/phone pairing such as pass key entry

Integrate security testing into the development process Implement user authentication and input sanitisation at the application level

Conclusions

CONCLUSIONS
RECOMMENDATIONS FOR MPOS VENDORS

Protect deprecated protocols such as magstripe Use preventive monitoring as a best practice Don't allow use of vulnerable or out-of-date firmware, prohibit downgrades

Place more emphasis on enrolment checks Protect the mobile ecosystem Implement user authentication and input sanitization at application level

Conclusions

CONCLUSIONS
RECOMMENDATIONS FOR MPOS MERCHANTS

Control physical access to devices Do not use mag-stripe transactions

Assess the mPOS ecosystem Choose a vendor who places emphasis on protecting whole ecosystem

THANKS

Leigh-Anne Galloway @L_AGalloway

Hardware and firmware: Artem Ivachev

Tim Yunusov @a66at

Hardware observations: Alexey Stennikov Maxim Goryachy Mark Carney

