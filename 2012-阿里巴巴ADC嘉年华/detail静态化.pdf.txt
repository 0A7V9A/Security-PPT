Detail

---- 
1

  http://xulingbo.net http://weibo.com/u/1855869382 2009Detail
Cassandrasketch developerworks ,Java Web -- 
2

Detailhttp://item.taobao.com
3

Detail--
 90%PV  70%Detail      
4

Detail
 
 PV5/1.8w  UV31001700
 
 300vm
 
 350QPS  RT30ms
 4.03Gbps
 108k28k
5


6


·  · 11/12 · / · 
7

Detail
 
 assets  inlinejs\css  combocssjs  BigRendertextarea
 
 iframejsonp   JS  Velocitysketch  DBCTair
 
 TCP  TAB
 
8


       
    HTTP    or 
9


 URLURL URL
       Cookie
10


 QPS 1. Java · CPUJava  ·  2. Web · atpanel pvacookie · HTML(100K)Gzip
 
1.  2.  3. 11/1221w/QPS
 
11

Detail
 Detail
   CPU
 Java
 NIO    Servlet
 500QPS
12

Detail
 
 Http
 
 Web  URL
 
     
13

Detail

Detail
 LB(A10)|LVS

Nginx

90

Nginx

Varnish

Cache

Varnish

Jboss

Jboss

360Jboss Jboss

 HTML
put
 Jboss

Cache Tair

put





Cache

14


 Hash  ESI    ?  
15

 Nginx+Varnish20
 
 JavaPE    =1/(1-)
 
   CPUGzip    
16

 Nginx+Varnish+Jbossvm
 
     
 
   ·  VarnishJboss

 Nginx+Varnish+Jboss()
 
 3
 
   Varnish  Gzip  CC
 12
 VarnishCPUJavaBeacon  CSIVarnishESI
18


 URLget  post  Cookie
19


 URL/item.htm?id=xxxx  
 Atpanel  idCookie
 
   
 
 
20


 ViewData  ItemData
21

Varnish 350

300

 Nginx 250

200
 Nginx 150

 RTLoad

100

 50

0 322 436 690 390 377 260 163 126 110

 

Varnish_load

Nginx_load

Varnish_RT

96 83 48 Nginx_RT

 Http 
 HttpVarnish  ESI  Facebook 

 

 

22

----
23

----
 
 Cc  jbossctljbossvarnish  VmVarnish
 
 Varnish  3lastModify  
24

----
 
 IC4000SC50  
 Varnish
 260104w/s20CC  Keepalive6w/shttp
 CC
 Mina  load
 Varnish
 Error    Stat-out
25

----Varnish
 Purge
 Http    Varnishkeeplive
 Ban
 key  
26

Varnish
   
27


 =1/(1-)  50%2  90%10  99%100  
28


· Jboss
­  ­ JavaCPU ­ RT ­ Nginx
· Varnish
­ VarnishJboss ­ VarnishESI ­ Nginx
· Nginx/Apache
­  ­ 
29


·  · QPS2020w/s
30


· Varnish ·  · Load
31


· Detail · TMD · PE10 · 10money · 
32


    Varnish&Nginx  Tair PE scm SC IC
33

34

