WHOIS
Kris Oosthoek @f00th0ld krisk.io

Threat Intelligence Analyst rijkswaterstaat.nl/english
PhD Student cyber-threat-intelligence.com

Overview

1

What/why

2

Methodology

3

Noteworthy findings

4

APT Technique Adoption

5

CTI from Automated Analysis

Kill Chain
wikipedia.org/wiki/Delta_Works

What + why
· No articles applying ATT&CK in Google Scholar, IEEE, etc.
· Aim¹: stimulate academic adoption of ATT&CK · Aim²: prove its potential for malware analysis · By: plotting bulk analysis results on ATT&CK
Oosthoek, K., & Doerr, C. (2019). SoK: ATT&CK Techniques and Trends in Windows Malware. Proceedings of SecureComm 2019, 15th EAI International Conference on Security and Privacy in Communication Networks

TTPs

>

>

>

951 samples

match SHA256 / automated analysis

ATT&CK plotting

data analysis

Execution

1. Execution Through API  2. Rundll32 3. Command-Line Interface  4. Service Execution 

CreateProcessA / CreateProcessW functions
found in 562 families
checking for system drives
found in 175 families
popular for reverse shells; obfuscated CMDs
found in 161 families
binary, command or script
found in 115 families, but significantly decreasing from 2012-2018
creating remote processes via PsExec
Carbanak, Koadic, OlympicDestroyer, NetC

TL;DR: Execution techniques most commonly have a short lifecycle

Execution:Fileless Techniques

PowerShell  Windows Management Instrumentation 

PS command line, CreateObject for Execution
7 families, all from either 2017 or 2018 Emotet, Rozena, DNSMessenger, Ramnit, DownPaper, SnatchLoader, Empire
checking for system drives
82 families accessed WMI (configuration information), of which 7 using WMIC i.a. EternalPetya, LatentBot, ISFB, Dropshot, GhostRAT

TL;DR: Increasing proliferation of fileless Execution techniques At the expense of more established techniques

Defense Evasion

1. Obfuscated Files or Information

obfuscated instructions, .NET CreateDecryptor,
found in 593 families

2. Software Packing

zlib compression, UPX, RAR
found in 558 families

3. Deobfuscate/Decode Files or Information

string en-/decryption functions
359 families; encoding only malicious sections of file

4. Masquerading

Program Files, system32, driver directories
found in 165 families, of which 19 masquerading as 3rd party software

5. DLL Side-Loading 

using legitimate applications to load DLLs
106 families, of which 90 first observed 2016-2018

TL;DR: implement hash-based DLL import validation

Discovery

1. Query Registry 2. Security Software Discovery  3. Process Discovery 4. System Information Discovery 5. System Network Configuration Discovery

AuthenticodeEnabled, query GUID
950 samples, of which 345 lookup GUID
check for AV, local FW rules, virtualization
748 families; several subtechniques (e.g. RDTSC instruction) on the rise
CreateTool32Snapshot(), Process32First/Next()
599 families
GetVersion(), GetLocaleInfo(), VirtualQuery()
observed in 669 families
GetAdaptersInfo(), ipconfig, netsh, netstat, GeoIP
found in 97 families, of which 60 call GetAdaptersInfo()

TL;DR: well-detected but difficult to distinguish malicious from benign

Command and Control

1. Uncommonly Used Port 2. Web Service 3. Multi-hop Proxy 4. Process Injection

TCP/UDP with unexpected protocol behavior
observed in 67 families
using Facebook, Tumbler, VKontakte, Pastebin
found in 47 families (AdKoob, Empire, OnionDuke, PlugX, yty)
C&C over TOR (connects to .onion)
found in 11 families (AthenaGo, WannaCryptor, Polyglot, XBot POS)
"More sophisticated samples may perform multiple process injections (...) utilizing named pipes or other inter-process communication (IPC) mechanisms as a communication channel." https://attack.mitre.org/techniques/T1055

APT Technique Adoption

samples using named pipes

20 18 16 14 12 10
8 6 4 2 0 2010

2011

2012

2013

2014
year

2015

2016

2017

2018

In depth: krisk.io/post/attack

Lessons Learned:CTI from Automation

1

Inaccurate technique plotting

2

Partial and biased coverage of certain tactics

3

Results always depend on the capabilities of the resource used for analysis

>>

Automated analysis is an unsuited source for CTI when taken by itself
· Critical thinking is the sharpest tool in your toolbox · Always consider alternative hypotheses · Curate carefully

Conclusion
"Our cyber defense has two lives. · Don't let your sandbox fool you
· Be careful with automated ATT&CK plotting
The second begins when we realize we only have one."
Confucius, 551­479 BC

Thanks!
Kris Oosthoek @f00th0ld krisk.io

