Crea%ng Detec%on Research Opportuni%es
Leveraging ATT&CK Evalua2ons

Roberto Rodriguez @Cyb3rWard0g
· Microso' Threat Intelligence Center (MSTIC) R&D · I  Open Source
· Projects: · @HunterPlaybook  · @THE_HELK · ATTACK-Python-Client · @OSSEM_Project · @Mordor_Project + Mordor Labs  · Blacksmith & More
· Non-tech: · Blacksmithing! · Cooking Recipes: hPps://infosecwelldone.com/

Agenda
· ATT&CK Evalua,ons · APT29 Eval (Round 2)
· Network Design · Emula,on Plans · Detec,on Research Opportuni,es · Mordor Labs · Mordor Datasets · Detec,on Hackathons · Threat Hunter Playbook 

ATT&CK Evalua;ons
MITRE evaluates cybersecurity products using an open methodology based on the ATT&CK® knowledge base.
· Empowering end-users with objecCve insights into how to use specific commercial security products to address known adversary behaviors
· Providing transparency around the true capabiliCes of security products to address known adversary behaviors
· Driving the security vendor community to enhance its capability to address known adversary behaviors
hPps://aPackevals.mitre.org/

APT29 Eval (Round 2)
A threat group that reportedly compromised the DemocraCc NaConal CommiIee starCng in the summer of 2015.
Scenario 1 / Day 1 · The first scenario (executed with Pupy, Meterpreter, and
custom tooling) begins with the execuCon of a payload delivered by a widespread "spray and pray" spearphishing campaign. Scenario 2/ Day 2 · The second scenario (executed with PoshC2 and custom tooling) focuses on a very targeted and methodical breach, beginning with the execuCon of a specially craUed payload designed to scruCnize the target environment before execuCng
hPps://aPackevals.mitre.org/APT29/

APT29 Eval ­ Network Design
h"ps://a"ackevals.mitre.org/APT29/environment.html

APT29 Evals ­ Emula;on Plans
· In their broader campaigns, APT29 has conducted smash-and-grab espionage with rapid collec2on and exfiltra2on.
· In their smaller more targeted campaigns, APT29 has u2lized a different toolset incrementally modified to aIempt to evade published intelligence about their opera2ons.
h"ps://github.com/mitre-a"ack/a"ack-arsenal/tree/master/adversary_emula@on/APT29/Emula@on_Plan

APT29 Evals ­ Emula;on Plans ­ Day 1
h"ps://github.com/mitre-a"ack/a"ack-arsenal/tree/master/adversary_emula@on/APT29/Emula@on_Plan/Day%201/payloads

APT29 Evals ­ Emula;on Plans ­ Day 2
h"ps://github.com/mitre-a"ack/a"ack-arsenal/tree/master/adversary_emula@on/APT29/Emula@on_Plan/Day%202/payloads

APT29 Evals ­ DIY Plugin
h"ps://github.com/mitre-a"ack/a"ack-arsenal/tree/master/adversary_emula@on/APT29/CALDERA_DIY/evals

APT29 Evals ­ DIY Plugin
hPps://github.com/mitre-aPack/aPack-arsenal/tree/master/adversary_emulaXon/APT29/CALDERA_DIY/evals

What If I can replicate all that, collect the data generated and share it with the InfoSec community ?

Mordor Style!

Crea;ng Research Opportuni;es
Mordor Datasets Mordor Labs

Mordor Labs 
Cloud Templates and scripts to deploy network environments exclusively to generate datasets for the Mordor project. · Azure Resource Manager (ARM) Templates · AWS Cloud Forma,on Templates · Blacksmith Ini,a,ve:
· hPps://github.com/hunters-forge/Blacksmith
· Building all future ATT&CK Evals environments  (would you like to help?)
hPps://github.com/OTRF/mordor-labs

Mordor Labs ­ APT 29 Network
h"ps://medium.com/threat-hunters-forge/mordor-labs-part-1-deploying-a"-ck-apt29-evals-environments-via-arm-templates-to-create-1c6c4bc32c9a

Mordor Labs ­ Host Telemetry
h"ps://medium.com/threat-hunters-forge/mordor-labs-part-1-deploying-a"-ck-apt29-evals-environments-via-arm-templates-to-create-1c6c4bc32c9a

Mordor Labs ­ Network Telemetry
· netsh trace start capture=yes traceFile=$FILE fileMode=single persistent=yes maxSize=0 overwrite=yes
· pktmon start --etw -p 0 -l real,me (Windows 10 2004)
· Azure Network Watcher Agent extension for Windows
h"ps://medium.com/threat-hunters-forge/mordor-labs-part-1-deploying-a"-ck-apt29-evals-environments-via-arm-templates-to-create-1c6c4bc32c9a

Mordor Labs ­ Network Telemetry
· h]ps://github.com/OTRF/mordor labs/blob/master/environments/ a]ack-evals/apt29/scripts/StartPacket-Capture.sh
· h]ps://github.com/OTRF/mordor labs/blob/master/environments/ a]ack-evals/apt29/scripts/StopPacket-Capture.sh
h"ps://medium.com/threat-hunters-forge/mordor-labs-part-1-deploying-a"-ck-apt29-evals-environments-via-arm-templates-to-create-1c6c4bc32c9a

Mordor Labs ­ Emula;on Plans & Videos
h"ps://github.com/OTRF/detec@on-hackathon-apt29/tree/master/emula@on-plans

Mordor Labs ­ Emula;on Plans & Videos
h"ps://medium.com/threat-hunters-forge/mordor-labs-part-2-execu@ng-a"-ck-apt29-evals-emula@on-plan-day1-17fae7a81229

@Mordor_Project 
· The Mordor project provides pre-recorded security events generated by simulated adversarial techniques in the form of JavaScript Object Nota?on (JSON) files for easy consump?on.
· The pre-recorded data is categorized by plaEorms, adversary groups, tac?cs and techniques defined by the MITRE ATT&CK Framework.
· The pre-recorded data represents not only specific known malicious events but addi?onal context/events that occur around it.
· IthheopInefoitSbeeccCoommems uthneitoyfficial Data Repository for · Website: hWps://mordordatasets.com/introduc?on
hPps://github.com/hunters-forge/mordor

Mordor Datasets ­ APT29 Evals (Host)
h"ps://github.com/hunters-forge/mordor/tree/master/datasets/large/apt29

Mordor Datasets ­ APT29 Evals (Host)
h"ps://github.com/hunters-forge/mordor/tree/master/datasets/large/apt29

Mordor Datasets ­ APT29 Evals (Host)
h"ps://github.com/hunters-forge/mordor/tree/master/datasets/large/apt29

Mordor Datasets ­ APT29 Evals (Network)
h"ps://github.com/hunters-forge/mordor/tree/master/datasets/large/apt29

Mordor Datasets- Empowering Researchers 

Detec;on Hackathon 

· A virtual event to get together and learn about adversary techniques through data!

· Main goals
· Cteoclhlanbioquraetsetaongdetlheearrnsome basic data analysis · Explore different analyCcs plaZorms and share
feedback (what works and what doesn't)
· Contribute to other open source projects!

·

Not only help and

#moefectontribuCons,

but

how

many

people

we

· MlevaekriangginthgethdeiffaemreanzcinegbAyTpTr&ovCiKdirnegsoduartcaeasnd !

hPps://twiPer.com/Cyb3rWard0g/status/1252715463773126662

Detec;on Hackathon ­ APT29 Evals
h"ps://github.com/OTRF/detec@on-hackathon-apt29

Detec;on Hackathon ­ APT29 Evals
h"ps://github.com/OTRF/detec@on-hackathon-apt29/projects

Detec;on Hackathon ­ APT29 Evals
h"ps://github.com/OTRF/detec@on-hackathon-apt29/projects/1

Detec;on Hackathon ­ APT29 Evals 
h"ps://github.com/OTRF/detec@on-hackathon-apt29/issues/6

Detec;on Hackathon ­ APT29 Evals 
h"ps://github.com/OTRF/detec@on-hackathon-apt29/issues/1

Detec;on Hackathon ­ APT29 Evals 
h"ps://github.com/OTRF/detec@on-hackathon-apt29/issues/6 & 17

Detec;on Hackathon ­ APT29 Evals 
h"ps://github.com/OTRF/detec@on-hackathon-apt29/issues/6 & 17 & 1

What can we do with the results?
(S#ll a work in progress..)

@HunterPlaybook 
· A community-based open source project developed to share threat hun,ng concepts and aid the development of techniques and hypothesis for hun,ng campaigns by leveraging security event logs from diverse opera,ng systems.
· Sharing research via open infrastructure (@mybinderteam) with the InfoSec Community 
· Website: h]ps://threathunterplaybook.com /introduc,on.html
hPps://github.com/hunters-forge/mordor

Threat Hunter Playbook: Documen;ng..
h"ps://github.com/hunters-forge/ThreatHunter-Playbook/blob/master/docs/evals/apt29/steps/3.B.2_bypass_user_account_control.yaml

Releasing something today 

Threat Hunter Playbook: Crea;ng a Report..
h"ps://threathunterplaybook.com/evals/apt29/report.html

Threat Hunter Playbook: Crea;ng a Report..
h"ps://threathunterplaybook.com/evals/apt29/detec@ons/1.A.1_DFD6A782-9BDB-4550-AB6B-525E825B095E.html

Threat Hunter Playbook: Crea;ng a Notebook..
h"ps://threathunterplaybook.com/notebooks/campaigns/apt29Evals.html

Threat Hunter Playbook: Empowering others 

Threat Hunter Playbook: Notebook Demo
h"ps://threathunterplaybook.com/notebooks/campaigns/apt29Evals.html

Threat Hunter Playbook: Notebook Demo
h"ps://threathunterplaybook.com/notebooks/campaigns/apt29Evals.html

Threat Hunter Playbook: Notebook Demo
h"ps://threathunterplaybook.com/notebooks/campaigns/apt29Evals.html

Open Threat Research ) (A community movement
Coming soon .. 

Thank You!
@Cyb3rWard0g @Mordor_Project @HunterPlaybook h:ps://launchpass.com/threathunAng

