  
      yaogang@sogou-inc.com                                       2015-04-25  

  

""""     

  

  

  

  

""""     

  

Volume  
95%  
10+  
10T/...  

Variety  
  
LBS  
...  

Velocity  
.........  
......  
...  

Veracity  
User...  
Advertiser...   Publisher...  

  

   Ø    Ø   

Ø    Ø   

      Ø      

Ø /  

Ø    Ø   

    

Ø    Ø    Ø   



Ø      
Ø      

   Ø      Ø 

Ø CRM  
 Ø       Ø BO  



Ø   

Ø   

  

Ø ...  ...  



                                   



   Ø    Ø    Ø    Ø    Ø    Ø    Ø    Ø   



   



PV/  



UV  





  

Ø    Ø CTR   Ø    Ø    Ø    Ø    Ø    Ø   

  
 Ø    Ø       Ø    Ø   
   Ø    Ø ETL      Ø   

   DDos  









  

  

              

  

  

  

     

  

  

  

           

     
   /  

  
  
   
  

      /     

  

u   
Ø   

u   
Ø   

u      

u   
Ø    Ø   
  

  

ZooKeeper








 


i noti f y

 




LSN 

  
push 
   

 

 

 

pul l


Pul l

sync

 



 

 

 



 


 
 

. . .



  

 Agent

 


LRU  

  

 Agent

 

SQL 
SQL 

SQL
   
SQL

 LRU

  
u   
Ø                    ·  ·  /·    
Ø                      ·  ·    
Ø                        ·    
u   
Ø Scribe   Ø Flume-NG  

  

u   
Ø LSN   

u   
Ø      Ø   

u   
Ø push  +     

u   
            
Ø %h  %v  %V  %l  %u  %t   \"%r\"  %>s  %b  \"%{Referer}i \"  \"%{User-Agent}i\"  %D  
Ø %{X-Forwarded-For} i  %h  %l  %u  %t  "%r"  %s  %b   "%{Referer}i"  "%{User-Agent} i"  %D  

  
u   
Ø Topic,     Ø    Ø         ·    
  ·  topic  
u   
Ø Nginx   Ø ZKTopic->Node   Ø   

(Contd)  

master   slave  

watch  

Zookeeper  
     

u   
Ø    Ø leader   Ø Node
Failover  

slave   slave  

     

u   
Ø   

ü   

ü ZK

ZK  

Ø Topic  

  
u Kafka      
Ø O(1)   Ø    Ø   
ü Replicas   ü zkoffset  
u   
Ø    ü exactly  once   ü ISR   Ø   

  
u   
Ø iptables   Ø   
ü ProducerRequest   ü AppSecret:  client.id
+request.ip+topic  
u   
Ø MsgID   

(Contd)  
u   
Ø    Ø /     
u   
Ø broker (young  gc  bug)   JDK  

  
u Storm  
Ø    Ø Acker   Ø    ·     Ø   
u   
Ø    Ø    Ø   

  

Ø Cgroups,   worker cpu,  memory cpuset   

  

Ø Trident  Topology     Ø Transac1onalTride
ntKa3aSpout/ OpaqueTridentKa 3aSpout  

     

Ø Worker CPUVS/
   Ø Spout
max.spout.pending   Ø   
bolt  

Contd  

u   
AC   

u   
Bloom  Filter
  

u UV               
Hyper  LogLog  UV   

u 
DGIM,       

  

u  

Ø SQL  

  

Ø memory  efficient     

  

Ø   

  

Ø   

ZooKeeper   HeartBea t   

  

Agen t    

    

SQL    

HeartBeat  

   LRU  

SQL    

    

  

  

     

Agen t   

    

SQL    

  

   LRU  

SQL    

  
u   
Ø partitionhash   Ø Partition  
u   
Ø Cache+   Ø    Ø   

Contd  
u SQL  
Ø    Ø    Ø Value  
u   
Ø ZK/                 cache  
Ø +  
u   
Ø ,    

Use  Case  

  

   zabbix  
Storm  UI  
Hadoop   UI  
Hbase  UI  
ZK       
  



   

  

NoSQL  

  





storm  

  

MR  

pig   hive  

impala  

hadoop  

hbase  





kafka  

  

  

Flume-NG     

       

  

  

  

     

  
   

ZK   Yarn  

   

cgroup  

  

  

  

  

  

  

  

  

  

  

u   
Ø storm-on-yarn   Ø Kafka-on-yarn  

   &  


u   
Ø /  

u   

u   

THANK  YOU  

FOR  YOUR  TIME

  

yaogang@sogou-inc.com  

