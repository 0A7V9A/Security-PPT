DEF CON 19
Malware Freakshow 3: They're pwning er'body out there!
Nicholas J. Percoco & Jibran Ilyas

Agenda
· Introduction · Evolution of Malware · Sample Analysis + Victim + Demo
· Sample SL2010-161 ­ Kameo (Grocery Store) · Sample SL2011-014 ­ Memory Dumper (Bar) · Sample SL2011-026 ­ Webcheck.dll (Work) · Sample SL2011-039 ­ Android Malware (Phone)
· Conclusions
Copyright Trustwave 2011

Inspiration ­ "System Intruder"
"Well... There's malware on the interwebs. They're pwning all your systems, snatching your data up. So hide your cards, hide your docs, and hide your phone, 'cause they're pwning er'body out there!" ­ Zero Cool
Copyright Trustwave 2011

Introduction ­ Who are these guys?
Nicholas J. Percoco (@c7five) · Head of SpiderLabs at Trustwave · Started my InfoSec career in the 90s · 4th DEF CON talk (2 more this weekend ­ Droid & SSL) · Primary author of Trustwave's Global Security Report
Jibran Ilyas (@jibranilyas) · Senior Forensic Investigator, Spiderlabs at Trustwave · 9 Years of InfoSec Experience · Speaker at several Global Security Conferences like Black Hat, DEF CON, SecTor, Source Barcelona, etc. · Masters degree from Northwestern University
Copyright Trustwave 2011

Introduction ­ Why give a "Freakshow"?
        
Exploits  are  commodi0es.       Malware  fuels  the  business  of  crime*.    
     
*"They're pwning er'body out there!"   
  
Copyright Trustwave 2011

Introduction ­ What's this about?
This  the  3rd  Itera0on  of  this  Talk     · 2009  ­  KeyLogger,  MemDumper,  Video  Poker,  Sniffer   · 2010  ­  MemDumper,  Logon  Creden=als  Stealer,  Sniffer,   Client--Side  (PDF  Malware)     
New  Targets  This  Year  -->  YOU   · Your  Grocery  Store   · Your  Favorite  Bar   · Your  Work   · Your  Smart  Phone  
  
Copyright Trustwave 2011

Evolution of Malware - 2009
· Sloppy  malware  developers   · Just  "tes=ng  the  waters"   · No  covert  file  system  placement   · Noisy  output  files   · Easily  detected  using  "Task  Manager"  
Copyright Trustwave 2011

Evolution of Malware - 2010
· Started  to  use  "tricky"  names  for  executable   · Located  in  "system"  folders   · Output  s=ll  mainly  in  plain--text  and  wriYen  to  disk   · Advanced  tools  can  easily  detect  them   · Automated  exfiltra=on  in  certain  instances  
Copyright Trustwave 2011

Evolution of Malware - 2011
· Malware  developers  have  grown  up  
· Completely  subver=ng  process  analysis  tools  
· Many  instances  of  ZERO  data  storage  
· When  data  is  stored  it  is  ENCRYPTED  
· More  efficient  methods  resul=ng  in  small  footprint  
· Automa=on  is  "everywhere  they  want  to  be"  
  
Copyright Trustwave 2011

Evolution of Malware ­ Network Sniffers

Year   2009  
2010  
2011  

Notables  
· Obvious  filenames   · Output  was  plain  text  (.cap  extension)   · AYacker's  FTP  creden=als  in  executable    
· Filenames  matched  Windows  system  files   · Output  compress  and  password  protected   · Nightly  auto--exfiltra=on  func=onality  appeared  
· No  output  on  disk   · Malware  u=lizes  buffers  (one  to  sniff,  one  to  
export)   · Real--=me  data  exfiltra=on     · Encryp=on/Encoding  of  output  data  

Copyright Trustwave 2011

Evolution of Malware ­ Memory Dumper

Year   2009  
2010  
2011  

Notables  
· Malware  kit  required  3  executable  files   · No  an=--forensics  capabili=es   · Plain  text  output  in  "system"  folders  
· Single  executable   · Kernel  rootkit   · Plain  text  output  in  "system  folders"  
· Return  of  3  executable  files,  but  output  file:     · Time  stomped  aeer  each  update   · Encrypted  

Copyright Trustwave 2011

Evolution of Malware ­ Advanced Techniques
Malware  Landscape  Today  
· An0--forensic  features  are  built  into  malware.   · Stolen  data  is  stored  encrypted  and  encryp=on  
algorithms  are  gefng  advanced.   · Automated  Exfiltra0on  features  are  built  in  so  
aYackers  don't  have  to  keep  coming  back  to  get  the   data.     · Data  commonly  being  exported  on  port  80  which  is   usually  allowed  for  outbound  access  in  most   organiza=ons.     · Time  stomping  is  common.     · Malware  is  a  DLL  --  injected  into  cri=cal  processes  
Copyright Trustwave 2011

Sample SL2010-161 ­ Kameo

Vitals  
Key   Features   Vic0m  

Code  Name:   Best  Suppor0ng  Actor  
Filename:   Kameo.exe  
File  Type:   PE  32--bit  
Target  Plahorm:   Windows  
·   Malware  has  minimal  file  and  registry  ac=vity.     ·   Malware  sniffs  magne=c  stripe  data  of  credit  cards  
and  puts  it  in  a  buffer  XYZ.     ·   In  a  separate  thread,  malware  sends  the  data  in  
buffer  XYZ  to  hacker  server  via  port  80.     ·   Exported  data  is  encoded  to  defeat  monitoring  tools   ·   There  is  no  storage  of  intercepted  data  on  disk  at  
any=me.    
Your  Grocery  Store  

Copyright Trustwave 2011

Sample SL2010-161 ­ Kameo
Demo Demo Demo!
Copyright Trustwave 2011

Sample SL2011-014 ­ Memory Dumper

Vitals  
Key   Features  
Vic=m  

Code  Name:   Son  of  Brain  Drain  
Filename:   Winboot.exe  
File  Type:   PE  32--bit  
Target  Plahorm:   Windows  
·   Malware  is  installed  as  Windows  service.   ·   Winboot.exe  invokes  two  other  processes:  One  
dumps  memory  of  processes,  other  parses  data.     ·   Malware  executables  are  =me  stomped  to  OS  Install  
=me.   · Output  file  is  =me  stomped  despite  regular  read/
writes.   ·   Output  file  is  encrypted.    
Your  Favorite  Bar  

Copyright Trustwave 2011

Sample SL2011-014 ­ Memory Dumper
Demo Please!
Copyright Trustwave 2011

Sample SL2011-026 ­ Webcheck.dll

Vitals  
Key   Features  

Code  Name:   Napoleon's  Victory  
Filename:   Webcheck.dll  
File  Type:   Win32  DLL  
Target  Plahorm:   Windows  
·   10KB  DLL  gets  injected  into  explorer.exe   ·   Malware  is  packed  so  strings  can't  be  read.     ·   Monitors  a  specific  process  and  records  data  
processed  by  it  in  a  hidden  and  encrypted  file.     ·   At  2am,  data  is  FTP'ed  to  aYacker's  server.     ·   Outgoing  file  is  encrypted  has  extension  of  zip  file  
but  is  not  actually  a  zip  file.  

Vic0m  

Your  Work  

Copyright Trustwave 2011

Sample SL2011-026 ­ Webcheck.dll
This Sh*t is Live (Demo)
Copyright Trustwave 2011

Sample SL2011-039 ­ Android Malware

Vitals  
Key   Features  

Code  Name:   ZiTFO  (aka  Zitmo)  
Filename:   zitmo.apk  
File  Type:   Android  Package  
Target  Plahorm:   Android  
· Registers  an  intent  filter  looking  for  SMS_RECEIVED  events   · Sets  this  filter  with  a  priority  of  1000  (highest)   · Prevents  everything  else  from  seeing  SMS  messages   · Send  the  content  of  the  message  to  the  aYacker's  website   · It  does  NOT  do  any  form  of  content  analysis  
· AYackers  are  likely  collec=ng  a  lot  junk  texts   · It  ironically  appears  on  the  phone  as  a  package  by  Trusteer  
called  "Rapport"  which  is  used  by  banks  to  specifically   prevent  this  type  of  SMS  intercep=on  aYack  

Vic0m  

You  

Copyright Trustwave 2011

Sample SL2011-039 ­ Android Malware
Oh No3s! (Android Demo)
Copyright Trustwave 2011

Conclusions
Windows Malware is All Grown Up · We have seen the same type of malware advance over the last three years.
Mobile Malware is Just Taking it First Steps · This is a new, but interesting area where we will likely see the most growth. · Attacks are PLENTY of targets
Where will be next year? · Predictions:
- iOS/Android Malware w/ Advanced Features - Mobile DDoS and Spam Bots - Malware Focused on Stealing Corporate Credentials
   Copyright Trustwave 2011

Special Thanks
Eric Monti Ryan Merritt Sean Schulte
Zack Fasel Zero Cool
Copyright Trustwave 2011

Contact Us:
Nicholas J. Percoco / npercoco@trustwave.com / @c7five Jibran Ilyas / jilyas@trustwave.com / @jibranilyas

